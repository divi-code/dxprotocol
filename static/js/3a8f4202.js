import{_ as a,c as e,u as l,T as s,s as t,g as i,F as u,e as v,o as n,U as o,C as c,x as r}from"./35bc27a3.js";import{s as d}from"./ee7ce8fe.js";import{B as m}from"./1e98e625.js";import{r as p,i as b}from"./9b9cf7db.js";import{r as f,j as g,w as k,G as w,q as y,H as h,I as V,N as x,O as j,y as $,L as _,u as I,x as S,ab as N,ac as T}from"./5bdea638.js";import"./2b425f2d.js";import"./c229d341.js";import"./9737f36b.js";const D=a=>(N("data-v-4af272dc"),a=a(),T(),a),C={class:"deposit-content"},R={class:"tips"},z={class:"title"},A={class:"list-item"},F=D((()=>$("span",{class:"dot"},null,-1))),U={class:"context"},Y={class:"list-item"},H=D((()=>$("span",{class:"dot"},null,-1))),M={class:"context"},B={class:"deposit"},P={class:"title"},q={class:"input-label"},G={class:"left"},K={class:"suffix"},L=["src"],O={class:"receive"},Q={class:"label"},W={class:"value"},X={key:1},E=["src"],J={class:"price-rate"},Z={class:"remind"},aa=["src"],ea={class:"notify"},la={class:"item"},sa={class:"label"},ta={class:"value"},ia={class:"footer"},ua=a({__name:"Withdraw",props:{visible:{type:Boolean,default:!1},priceRate:{type:String,default:""},stakeValue:{type:String,default:"0"},callback:{type:Function,default:()=>{}}},emits:["update:visible"],setup(a,{emit:N}){const T=a,{t:D}=e(),ua=l(),va=s(),{currentQuote:na,walletInfo:oa,chainId:ca}=d(ua),{symbol:ra,decimal:da}=d(va),{getContractAddress:ma,openPositionAction:pa}=v(),{vaultStakeRewardAddr:ba}=ma(),fa=f(!1),ga=f(""),ka=f(),wa=f(!1),ya=f(""),ha=f(""),Va=g((()=>{if(ha.value){const a=new m(ha.value.toString()).div(60),e=new m(ha.value.toString()).div(60).div(60);return e.lt(1)?a+D("public.minutes"):e+D("public.hours")}return"-"+D("public.minutes")})),xa=f(!1),ja=f(!0),$a=f(),_a=f("");k((()=>T.visible),(a=>{a&&(_a.value=T.priceRate)}));const Ia=f(!1),Sa=(a,e)=>{const l=n(a,2)||"";Ia.value="max"==e,new m(l||0).lt(T.stakeValue)?ga.value=l:(Ia.value=!0,ga.value=t(T.stakeValue)),clearTimeout($a.value),$a.value=setTimeout((()=>{ka.value="",wa.value=!0,Na()}),500)},Na=async()=>{if(ga.value){const a=await p({address:ba,abi:o.abi,chainId:ca.value,functionName:"previewRedeem",args:[c(Ia.value?T.stakeValue:ga.value,da.value)]});ka.value=r(a,da.value),wa.value=!1}else ka.value="",wa.value=!1},Ta=async()=>{if(!ga.value)return;if(Ia.value?!T.stakeValue||0==T.stakeValue:!ga.value||0==ga.value)return void(fa.value=!0);fa.value=!1,xa.value=!0;const a=new m(Ia.value?T.stakeValue:ga.value).toFixed(8,0),e=await pa([c(a),oa.value.account,oa.value.account],"redeem",4,"","","");xa.value=!1,e&&(ga.value="",ka.value="",Da(),T.callback())},Da=()=>{ga.value="",ka.value="",clearTimeout($a.value),N("update:visible",!1)};return k([()=>{var a;return null==(a=oa.value)?void 0:a.account},()=>T.visible],(([a])=>{a&&T.visible&&(async()=>{var a,e,l,s,t;const i=await b({contracts:[{address:ba,abi:o.abi,chainId:ca.value,functionName:"stakingPeriod"},{address:ba,abi:o.abi,chainId:ca.value,functionName:"getStake",args:[null==(a=oa.value)?void 0:a.account]}]});ya.value=1e3*(Number(null==(l=null==(e=i[1])?void 0:e.result)?void 0:l.timestamp)+Number(null==(s=i[0])?void 0:s.result)),ha.value=Number(null==(t=i[0])?void 0:t.result);const u=Date.now();ja.value=!ya.value||m(u).lte(ya.value)})()}),{immediate:!0}),(e,l)=>{const s=w("a-input"),v=w("a-spin"),n=w("a-button"),o=w("a-space"),c=w("a-modal");return y(),h(c,{visible:a.visible,onCancel:Da,"modal-class":"kilo-vault-modal","render-to-body":!0,footer:!1,width:"650px","title-align":"start","unmount-on-close":""},{title:V((()=>[x(j(e.$t("vault.withdraw")),1)])),default:V((()=>[$("div",C,[_(o,{size:[0,0],align:"start",fill:""},{default:V((()=>[$("div",R,[$("div",z,j(e.$t("vault.tips")),1),$("div",A,[F,$("div",U,j(e.$t("vault.withdrawTips1",{a:I(Va)})),1)]),$("div",Y,[H,$("div",M,j(e.$t("vault.withdrawTips2")),1)])]),$("div",B,[$("div",null,[$("div",P,j(e.$t("vault.withdraw")),1),$("div",q,[$("div",G,j(e.$t("public.balance"))+": "+j(I(t)(a.stakeValue||0))+" "+j(I(ra)),1),$("div",{class:"right",onClick:l[0]||(l[0]=e=>Sa(a.stakeValue||0,"max"))},"MAX")]),_(s,{class:"kilo-input-order",modelValue:ga.value,"onUpdate:modelValue":l[1]||(l[1]=a=>ga.value=a),placeholder:"0",size:"large",onFocus:l[2]||(l[2]=a=>fa.value=!1),error:fa.value,onInput:l[3]||(l[3]=a=>Sa(ga.value,"pricevalue"))},{suffix:V((()=>[$("span",K,[x(j(I(ra))+" ",1),$("img",{class:"token-img",src:I(i)("token/KUSD.svg"),alt:"",srcset:""},null,8,L)])])),_:1},8,["modelValue","error"]),$("div",O,[$("span",Q,j(e.$t("vault.receive")),1),$("span",W,[wa.value?(y(),h(v,{key:0,size:12})):(y(),S("span",X,j(ka.value?I(t)(ka.value):"--"),1)),x(" "+j(I(na)),1)]),$("img",{class:"token-img",src:I(i)("token/USDT.svg"),alt:"",srcset:""},null,8,E)]),$("div",J," (1 "+j(I(na))+" = "+j(I(t)(a.priceRate,2)||"--")+" "+j(I(ra))+") ",1),$("div",Z,[$("img",{src:I(i)("svg/notification.svg"),alt:"",srcset:""},null,8,aa),$("div",ea,[$("div",la,[$("div",sa,j(e.$t("vault.withdrawDate")),1),$("div",ta,j(ya.value?I(u)(ya.value,"YYYY/MM/DD HH:mm:ss"):"--"),1)])])])]),$("div",ia,[_(n,{type:"primary",size:"large",long:"",onClick:Ta,loading:xa.value,disabled:ja.value||xa.value||!ga.value},{default:V((()=>[x(j(e.$t("vault.submit")),1)])),_:1},8,["loading","disabled"])])])])),_:1})])])),_:1},8,["visible"])}}},[["__scopeId","data-v-4af272dc"]]);export{ua as default};
