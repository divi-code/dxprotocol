import{c as e,a as t,g as r,u as n}from"./9b9cf7db.js";import{e as i,x as s,_ as o,y as a,z as c,A as u,C as h,D as l,E as p,J as f,F as d,G as g,H as y,N as v,I as m,K as _,M as w,O as b,P as E}from"./1e98e625.js";import{ac as I,ad as S,ae as P,af as O,ag as x,ah as C,ai as R,aj as A,ak as T,al as j,am as N,an as L,ao as z,ap as M,aq as D,ar as k,as as q,at as U,au as $,av as V,aw as H,ax as K,ay as G,az as B,aA as F,aB as W,aC as Y,aD as J,aE as Q,aF as Z,aG as X,aH as ee,aI as te,aJ as re,aK as ne,aL as ie,aM as se,aN as oe,aO as ae,aP as ce,aQ as ue,aR as he,aS as le,aT as pe,aU as fe,aV as de,aW as ge,aX as ye,aY as ve,aZ as me,a_ as _e,a$ as we,b0 as be,b1 as Ee,b2 as Ie,b3 as Se,b4 as Pe,b5 as Oe,b6 as xe,b7 as Ce,b8 as Re,b9 as Ae,ba as Te,bb as je,bc as Ne,bd as Le,be as ze,bf as Me,bg as De,bh as ke,bi as qe,bj as Ue}from"./35bc27a3.js";import"./5bdea638.js";import"./ee7ce8fe.js";import"./2b425f2d.js";import"./c229d341.js";import"./9737f36b.js";var $e,Ve,He,Ke,Ge,Be,Fe,We,Ye,Je,Qe,Ze,Xe,et,tt,rt,nt,it,st,ot,at,ct,ut,ht,lt={},pt={exports:{}};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
$e=pt,function(t){var r,n,i="object"==typeof e?e:"object"==typeof self?self:"object"==typeof this?this:{};function s(e,t){return e!==i&&("function"==typeof Object.create?Object.defineProperty(e,"__esModule",{value:!0}):e.__esModule=!0),function(r,n){return e[r]=t?t(r,n):n}}r=s(i,s($e.exports)),n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},Ve=function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},He=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Ke=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r},Ge=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},Be=function(e,t){return function(r,n){t(r,n,e)}},Fe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},We=function(e,t,r,n){function i(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,s){function o(e){try{c(n.next(e))}catch(t){s(t)}}function a(e){try{c(n.throw(e))}catch(t){s(t)}}function c(e){e.done?r(e.value):i(e.value).then(o,a)}c((n=n.apply(e,t||[])).next())}))},Ye=function(e,t){var r,n,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(e){return function(t){return c([e,t])}}function c(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(a){s=[6,a],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},ht=function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},Je=function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||(t[r]=e[r])},Qe=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ze=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,s=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)o.push(n.value)}catch(a){i={error:a}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return o},Xe=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Ze(arguments[t]));return e},et=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n},tt=function(e){return this instanceof tt?(this.v=e,this):new tt(e)},rt=function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(e){i[e]&&(n[e]=function(t){return new Promise((function(r,n){s.push([e,t,r,n])>1||a(e,t)}))})}function a(e,t){try{c(i[e](t))}catch(r){l(s[0][3],r)}}function c(e){e.value instanceof tt?Promise.resolve(e.value.v).then(u,h):l(s[0][2],e)}function u(e){a("next",e)}function h(e){a("throw",e)}function l(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}},nt=function(e){var t,r;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,i){t[n]=e[n]?function(t){return(r=!r)?{value:tt(e[n](t)),done:"return"===n}:i?i(t):t}:i}},it=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=Qe(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,s){i(n,s,(t=e[r](t)).done,t.value)}))}}function i(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)}},st=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},ot=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},at=function(e){return e&&e.__esModule?e:{default:e}},ct=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},ut=function(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r},r("__extends",Ve),r("__assign",He),r("__rest",Ke),r("__decorate",Ge),r("__param",Be),r("__metadata",Fe),r("__awaiter",We),r("__generator",Ye),r("__exportStar",Je),r("__createBinding",ht),r("__values",Qe),r("__read",Ze),r("__spread",Xe),r("__spreadArrays",et),r("__await",tt),r("__asyncGenerator",rt),r("__asyncDelegator",nt),r("__asyncValues",it),r("__makeTemplateObject",st),r("__importStar",ot),r("__importDefault",at),r("__classPrivateFieldGet",ct),r("__classPrivateFieldSet",ut)}();var ft=pt.exports,dt={};Object.defineProperty(dt,"__esModule",{value:!0}),dt.safeJsonParse=function(e){if("string"!=typeof e)throw new Error("Cannot safe json parse value of type "+typeof e);try{return JSON.parse(e)}catch(t){return e}},dt.safeJsonStringify=function(e){return"string"==typeof e?e:JSON.stringify(e,((e,t)=>void 0===t?null:t))};var gt,yt={exports:{}};var vt,mt={},_t={};var wt,bt,Et={};Object.defineProperty(lt,"__esModule",{value:!0}),lt.KeyValueStorage=void 0;const It=ft,St=dt,Pt=It.__importDefault((gt||(gt=1,function(){let t;function r(){}t=r,t.prototype.getItem=function(e){return this.hasOwnProperty(e)?String(this[e]):null},t.prototype.setItem=function(e,t){this[e]=String(t)},t.prototype.removeItem=function(e){delete this[e]},t.prototype.clear=function(){const e=this;Object.keys(e).forEach((function(t){e[t]=void 0,delete e[t]}))},t.prototype.key=function(e){return e=e||0,Object.keys(this)[e]},t.prototype.__defineGetter__("length",(function(){return Object.keys(this).length})),void 0!==e&&e.localStorage?yt.exports=e.localStorage:"undefined"!=typeof window&&window.localStorage?yt.exports=window.localStorage:yt.exports=new r}()),yt.exports)),Ot=(bt||(bt=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=ft;t.__exportStar((vt||(vt=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.IKeyValueStorage=void 0,_t.IKeyValueStorage=class{}),_t),e),t.__exportStar(function(){if(wt)return Et;wt=1,Object.defineProperty(Et,"__esModule",{value:!0}),Et.parseEntry=void 0;const e=dt;return Et.parseEntry=function(t){var r;return[t[0],e.safeJsonParse(null!==(r=t[1])&&void 0!==r?r:"")]},Et}(),e)}(mt)),mt);class xt{constructor(){this.localStorage=Pt.default}getKeys(){return It.__awaiter(this,void 0,void 0,(function*(){return Object.keys(this.localStorage)}))}getEntries(){return It.__awaiter(this,void 0,void 0,(function*(){return Object.entries(this.localStorage).map(Ot.parseEntry)}))}getItem(e){return It.__awaiter(this,void 0,void 0,(function*(){const t=this.localStorage.getItem(e);if(null!==t)return St.safeJsonParse(t)}))}setItem(e,t){return It.__awaiter(this,void 0,void 0,(function*(){this.localStorage.setItem(e,St.safeJsonStringify(t))}))}removeItem(e){return It.__awaiter(this,void 0,void 0,(function*(){this.localStorage.removeItem(e)}))}}lt.KeyValueStorage=xt;var Ct=lt.default=xt,Rt={},At={exports:{}};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
!function(t){var r,n,i,s,o,a,c,u,h,l,p,f,d,g,y,v,m,_,w,b,E,I,S;!function(P){var O,x,C="object"==typeof e?e:"object"==typeof self?self:"object"==typeof this?this:{};function R(e,t){return e!==C&&("function"==typeof Object.create?Object.defineProperty(e,"__esModule",{value:!0}):e.__esModule=!0),function(r,n){return e[r]=t?t(r,n):n}}O=R(C,R(t.exports)),x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},r=function(e,t){function r(){this.constructor=e}x(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r},s=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},o=function(e,t){return function(r,n){t(r,n,e)}},a=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(e,t,r,n){function i(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,s){function o(e){try{c(n.next(e))}catch(t){s(t)}}function a(e){try{c(n.throw(e))}catch(t){s(t)}}function c(e){e.done?r(e.value):i(e.value).then(o,a)}c((n=n.apply(e,t||[])).next())}))},u=function(e,t){var r,n,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(e){return function(t){return c([e,t])}}function c(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(a){s=[6,a],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},S=function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},h=function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||(t[r]=e[r])},l=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},p=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,s=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)o.push(n.value)}catch(a){i={error:a}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return o},f=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e},d=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n},g=function(e){return this instanceof g?(this.v=e,this):new g(e)},y=function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(e){i[e]&&(n[e]=function(t){return new Promise((function(r,n){s.push([e,t,r,n])>1||a(e,t)}))})}function a(e,t){try{c(i[e](t))}catch(r){l(s[0][3],r)}}function c(e){e.value instanceof g?Promise.resolve(e.value.v).then(u,h):l(s[0][2],e)}function u(e){a("next",e)}function h(e){a("throw",e)}function l(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}},v=function(e){var t,r;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,i){t[n]=e[n]?function(t){return(r=!r)?{value:g(e[n](t)),done:"return"===n}:i?i(t):t}:i}},m=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=l(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,s){i(n,s,(t=e[r](t)).done,t.value)}))}}function i(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)}},_=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},w=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},b=function(e){return e&&e.__esModule?e:{default:e}},E=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},I=function(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r},O("__extends",r),O("__assign",n),O("__rest",i),O("__decorate",s),O("__param",o),O("__metadata",a),O("__awaiter",c),O("__generator",u),O("__exportStar",h),O("__createBinding",S),O("__values",l),O("__read",p),O("__spread",f),O("__spreadArrays",d),O("__await",g),O("__asyncGenerator",y),O("__asyncDelegator",v),O("__asyncValues",m),O("__makeTemplateObject",_),O("__importStar",w),O("__importDefault",b),O("__classPrivateFieldGet",E),O("__classPrivateFieldSet",I)}()}(At);var Tt=At.exports,jt={},Nt={},Lt={};class zt{}const Mt=t(Object.freeze(Object.defineProperty({__proto__:null,IEvents:zt},Symbol.toStringTag,{value:"Module"})));var Dt,kt;function qt(){return kt||(kt=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});Tt.__exportStar(function(){if(Dt)return Lt;Dt=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.IHeartBeat=void 0;const e=Mt;class t extends e.IEvents{constructor(e){super()}}return Lt.IHeartBeat=t,Lt}(),e)}(Nt)),Nt}var Ut,$t,Vt,Ht={},Kt={};function Gt(){return $t||($t=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});Tt.__exportStar(function(){if(Ut)return Kt;Ut=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.HEARTBEAT_EVENTS=Kt.HEARTBEAT_INTERVAL=void 0;const e=I;return Kt.HEARTBEAT_INTERVAL=e.FIVE_SECONDS,Kt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Kt}(),e)}(Ht)),Ht}!function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=Tt;t.__exportStar(function(){if(Vt)return jt;Vt=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.HeartBeat=void 0;const e=Tt,t=i,r=I,n=qt(),s=Gt();class o extends n.IHeartBeat{constructor(e){super(e),this.events=new t.EventEmitter,this.interval=s.HEARTBEAT_INTERVAL,this.interval=(null==e?void 0:e.interval)||s.HEARTBEAT_INTERVAL}static init(t){return e.__awaiter(this,void 0,void 0,(function*(){const e=new o(t);return yield e.init(),e}))}init(){return e.__awaiter(this,void 0,void 0,(function*(){yield this.initialize()}))}stop(){clearInterval(this.intervalRef)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}initialize(){return e.__awaiter(this,void 0,void 0,(function*(){this.intervalRef=setInterval((()=>this.pulse()),r.toMiliseconds(this.interval))}))}pulse(){this.events.emit(s.HEARTBEAT_EVENTS.pulse)}}return jt.HeartBeat=o,jt}(),e),t.__exportStar(qt(),e),t.__exportStar(Gt(),e)}(Rt);var Bt={},Ft={exports:{}};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
!function(t){var r,n,i,s,o,a,c,u,h,l,p,f,d,g,y,v,m,_,w,b,E,I,S;!function(P){var O,x,C="object"==typeof e?e:"object"==typeof self?self:"object"==typeof this?this:{};function R(e,t){return e!==C&&("function"==typeof Object.create?Object.defineProperty(e,"__esModule",{value:!0}):e.__esModule=!0),function(r,n){return e[r]=t?t(r,n):n}}O=R(C,R(t.exports)),x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},r=function(e,t){function r(){this.constructor=e}x(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r},s=function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},o=function(e,t){return function(r,n){t(r,n,e)}},a=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(e,t,r,n){function i(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,s){function o(e){try{c(n.next(e))}catch(t){s(t)}}function a(e){try{c(n.throw(e))}catch(t){s(t)}}function c(e){e.done?r(e.value):i(e.value).then(o,a)}c((n=n.apply(e,t||[])).next())}))},u=function(e,t){var r,n,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(e){return function(t){return c([e,t])}}function c(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(a){s=[6,a],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},S=function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},h=function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||(t[r]=e[r])},l=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},p=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,s=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)o.push(n.value)}catch(a){i={error:a}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return o},f=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e},d=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n},g=function(e){return this instanceof g?(this.v=e,this):new g(e)},y=function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(e){i[e]&&(n[e]=function(t){return new Promise((function(r,n){s.push([e,t,r,n])>1||a(e,t)}))})}function a(e,t){try{c(i[e](t))}catch(r){l(s[0][3],r)}}function c(e){e.value instanceof g?Promise.resolve(e.value.v).then(u,h):l(s[0][2],e)}function u(e){a("next",e)}function h(e){a("throw",e)}function l(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}},v=function(e){var t,r;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,i){t[n]=e[n]?function(t){return(r=!r)?{value:g(e[n](t)),done:"return"===n}:i?i(t):t}:i}},m=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=l(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,s){i(n,s,(t=e[r](t)).done,t.value)}))}}function i(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)}},_=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},w=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},b=function(e){return e&&e.__esModule?e:{default:e}},E=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},I=function(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r},O("__extends",r),O("__assign",n),O("__rest",i),O("__decorate",s),O("__param",o),O("__metadata",a),O("__awaiter",c),O("__generator",u),O("__exportStar",h),O("__createBinding",S),O("__values",l),O("__read",p),O("__spread",f),O("__spreadArrays",d),O("__await",g),O("__asyncGenerator",y),O("__asyncDelegator",v),O("__asyncValues",m),O("__makeTemplateObject",_),O("__importStar",w),O("__importDefault",b),O("__classPrivateFieldGet",E),O("__classPrivateFieldSet",I)}()}(Ft);var Wt,Yt,Jt,Qt,Zt=Ft.exports;function Xt(){if(Qt)return Jt;Qt=1;const e=function(){if(Yt)return Wt;function e(e){try{return JSON.stringify(e)}catch(t){return'"[Circular]"'}}return Yt=1,Wt=function(t,r,n){var i=n&&n.stringify||e;if("object"==typeof t&&null!==t){var s=r.length+1;if(1===s)return t;var o=new Array(s);o[0]=i(t);for(var a=1;a<s;a++)o[a]=i(r[a]);return o.join(" ")}if("string"!=typeof t)return t;var c=r.length;if(0===c)return t;for(var u="",h=0,l=-1,p=t&&t.length||0,f=0;f<p;){if(37===t.charCodeAt(f)&&f+1<p){switch(l=l>-1?l:0,t.charCodeAt(f+1)){case 100:case 102:if(h>=c)break;if(null==r[h])break;l<f&&(u+=t.slice(l,f)),u+=Number(r[h]),l=f+2,f++;break;case 105:if(h>=c)break;if(null==r[h])break;l<f&&(u+=t.slice(l,f)),u+=Math.floor(Number(r[h])),l=f+2,f++;break;case 79:case 111:case 106:if(h>=c)break;if(void 0===r[h])break;l<f&&(u+=t.slice(l,f));var d=typeof r[h];if("string"===d){u+="'"+r[h]+"'",l=f+2,f++;break}if("function"===d){u+=r[h].name||"<anonymous>",l=f+2,f++;break}u+=i(r[h]),l=f+2,f++;break;case 115:if(h>=c)break;l<f&&(u+=t.slice(l,f)),u+=String(r[h]),l=f+2,f++;break;case 37:l<f&&(u+=t.slice(l,f)),u+="%",l=f+2,f++,h--}++h}++f}return-1===l?t:(l<p&&(u+=t.slice(l)),u)}}();Jt=n;const t=function(){function e(e){return void 0!==e&&e}try{return"undefined"!=typeof globalThis||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch(t){return e(self)||e(window)||e(this)||{}}}().console||{},r={mapHttpRequest:u,mapHttpResponse:u,wrapRequestSerializer:h,wrapResponseSerializer:h,wrapErrorSerializer:h,req:u,res:u,err:function(e){const t={type:e.constructor.name,msg:e.message,stack:e.stack};for(const r in e)void 0===t[r]&&(t[r]=e[r]);return t}};function n(e){(e=e||{}).browser=e.browser||{};const r=e.browser.transmit;if(r&&"function"!=typeof r.send)throw Error("pino: transmit option must have a send function");const u=e.browser.write||t;e.browser.write&&(e.browser.asObject=!0);const h=e.serializers||{},p=function(e,t){if(Array.isArray(e))return e.filter((function(e){return"!stdSerializers.err"!==e}));return!0===e&&Object.keys(t)}(e.browser.serialize,h);let f=e.browser.serialize;Array.isArray(e.browser.serialize)&&e.browser.serialize.indexOf("!stdSerializers.err")>-1&&(f=!1);"function"==typeof u&&(u.error=u.fatal=u.warn=u.info=u.debug=u.trace=u),!1===e.enabled&&(e.level="silent");const d=e.level||"info",g=Object.create(u);g.log||(g.log=l),Object.defineProperty(g,"levelVal",{get:function(){return"silent"===this.level?1/0:this.levels.values[this.level]}}),Object.defineProperty(g,"level",{get:function(){return this._level},set:function(e){if("silent"!==e&&!this.levels.values[e])throw Error("unknown level "+e);this._level=e,i(y,g,"error","log"),i(y,g,"fatal","error"),i(y,g,"warn","error"),i(y,g,"info","log"),i(y,g,"debug","log"),i(y,g,"trace","log")}});const y={transmit:r,serialize:p,asObject:e.browser.asObject,levels:["error","fatal","warn","info","debug","trace"],timestamp:c(e)};return g.levels=n.levels,g.level=d,g.setMaxListeners=g.getMaxListeners=g.emit=g.addListener=g.on=g.prependListener=g.once=g.prependOnceListener=g.removeListener=g.removeAllListeners=g.listeners=g.listenerCount=g.eventNames=g.write=g.flush=l,g.serializers=h,g._serialize=p,g._stdErrSerialize=f,g.child=function(t,n){if(!t)throw new Error("missing bindings for child Pino");n=n||{},p&&t.serializers&&(n.serializers=t.serializers);const i=n.serializers;if(p&&i){var c=Object.assign({},h,i),u=!0===e.browser.serialize?Object.keys(c):p;delete t.serializers,s([t],u,c,this._stdErrSerialize)}function l(e){this._childLevel=1+(0|e._childLevel),this.error=o(e,t,"error"),this.fatal=o(e,t,"fatal"),this.warn=o(e,t,"warn"),this.info=o(e,t,"info"),this.debug=o(e,t,"debug"),this.trace=o(e,t,"trace"),c&&(this.serializers=c,this._serialize=u),r&&(this._logEvent=a([].concat(e._logEvent.bindings,t)))}return l.prototype=this,new l(this)},r&&(g._logEvent=a()),g}function i(r,i,o,c){const u=Object.getPrototypeOf(i);i[o]=i.levelVal>i.levels.values[o]?l:u[o]?u[o]:t[o]||t[c]||l,function(r,i,o){if(!r.transmit&&i[o]===l)return;i[o]=(c=i[o],function(){const u=r.timestamp(),h=new Array(arguments.length),l=Object.getPrototypeOf&&Object.getPrototypeOf(this)===t?t:this;for(var p=0;p<h.length;p++)h[p]=arguments[p];if(r.serialize&&!r.asObject&&s(h,this._serialize,this.serializers,this._stdErrSerialize),r.asObject?c.call(l,function(t,r,i,o){t._serialize&&s(i,t._serialize,t.serializers,t._stdErrSerialize);const a=i.slice();let c=a[0];const u={};o&&(u.time=o),u.level=n.levels.values[r];let h=1+(0|t._childLevel);if(h<1&&(h=1),null!==c&&"object"==typeof c){for(;h--&&"object"==typeof a[0];)Object.assign(u,a.shift());c=a.length?e(a.shift(),a):void 0}else"string"==typeof c&&(c=e(a.shift(),a));return void 0!==c&&(u.msg=c),u}(this,o,h,u)):c.apply(l,h),r.transmit){const e=r.transmit.level||i.level,t=n.levels.values[e],c=n.levels.values[o];if(c<t)return;!function(e,t,r){const n=t.send,i=t.ts,o=t.methodLevel,c=t.methodValue,u=t.val,h=e._logEvent.bindings;s(r,e._serialize||Object.keys(e.serializers),e.serializers,void 0===e._stdErrSerialize||e._stdErrSerialize),e._logEvent.ts=i,e._logEvent.messages=r.filter((function(e){return-1===h.indexOf(e)})),e._logEvent.level.label=o,e._logEvent.level.value=c,n(o,e._logEvent,u),e._logEvent=a(h)}(this,{ts:u,methodLevel:o,methodValue:c,transmitLevel:e,transmitValue:n.levels.values[r.transmit.level||i.level],send:r.transmit.send,val:i.levelVal},h)}});var c}(r,i,o)}function s(e,t,r,i){for(const s in e)if(i&&e[s]instanceof Error)e[s]=n.stdSerializers.err(e[s]);else if("object"==typeof e[s]&&!Array.isArray(e[s]))for(const n in e[s])t&&t.indexOf(n)>-1&&n in r&&(e[s][n]=r[n](e[s][n]))}function o(e,t,r){return function(){const n=new Array(1+arguments.length);n[0]=t;for(var i=1;i<n.length;i++)n[i]=arguments[i-1];return e[r].apply(this,n)}}function a(e){return{ts:0,messages:[],bindings:e||[],level:{label:"",value:0}}}function c(e){return"function"==typeof e.timestamp?e.timestamp:!1===e.timestamp?p:f}function u(){return{}}function h(e){return e}function l(){}function p(){return!1}function f(){return Date.now()}return n.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},n.stdSerializers=r,n.stdTimeFunctions=Object.assign({},{nullTime:p,epochTime:f,unixTime:function(){return Math.round(Date.now()/1e3)},isoTime:function(){return new Date(Date.now()).toISOString()}}),Jt}var er,tr={};function rr(){return er||(er=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.PINO_CUSTOM_CONTEXT_KEY=tr.PINO_LOGGER_DEFAULTS=void 0,tr.PINO_LOGGER_DEFAULTS={level:"info"},tr.PINO_CUSTOM_CONTEXT_KEY="custom_context"),tr}var nr,ir={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.pino=void 0;const t=Zt,r=t.__importDefault(Xt());Object.defineProperty(e,"pino",{enumerable:!0,get:function(){return r.default}}),t.__exportStar(rr(),e),t.__exportStar(function(){if(nr)return ir;nr=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.generateChildLogger=ir.formatChildLoggerContext=ir.getLoggerContext=ir.setBrowserLoggerContext=ir.getBrowserLoggerContext=ir.getDefaultLoggerOptions=void 0;const e=rr();function t(t,r=e.PINO_CUSTOM_CONTEXT_KEY){return t[r]||""}function r(t,r,n=e.PINO_CUSTOM_CONTEXT_KEY){return t[n]=r,t}function n(r,n=e.PINO_CUSTOM_CONTEXT_KEY){let i="";return i=void 0===r.bindings?t(r,n):r.bindings().context||"",i}function i(t,r,i=e.PINO_CUSTOM_CONTEXT_KEY){const s=n(t,i);return s.trim()?`${s}/${r}`:r}return ir.getDefaultLoggerOptions=function(t){return Object.assign(Object.assign({},t),{level:(null==t?void 0:t.level)||e.PINO_LOGGER_DEFAULTS.level})},ir.getBrowserLoggerContext=t,ir.setBrowserLoggerContext=r,ir.getLoggerContext=n,ir.formatChildLoggerContext=i,ir.generateChildLogger=function(t,n,s=e.PINO_CUSTOM_CONTEXT_KEY){const o=i(t,n,s);return r(t.child({context:o}),o,s)},ir}(),e)}(Bt);class sr extends zt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}class or extends zt{constructor(e,t){super(),this.core=e,this.logger=t,this.records=new Map}}class ar{constructor(e,t){this.logger=e,this.core=t}}let cr=class extends zt{constructor(e,t){super(),this.relayer=e,this.logger=t}},ur=class extends zt{constructor(e){super()}},hr=class{constructor(e,t,r,n){this.core=e,this.logger=t,this.name=r}};class lr extends zt{constructor(e,t){super(),this.relayer=e,this.logger=t}}let pr=class extends zt{constructor(e,t){super(),this.core=e,this.logger=t}},fr=class{constructor(e,t){this.projectId=e,this.logger=t}};class dr{constructor(e){this.opts=e,this.protocol="wc",this.version=2}}let gr=class{constructor(e){this.client=e}};var yr={},vr={};!function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=S,r=P;e.DIGEST_LENGTH=64,e.BLOCK_SIZE=128;var n=function(){function n(){this.digestLength=e.DIGEST_LENGTH,this.blockSize=e.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return n.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},n.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},n.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},n.prototype.update=function(t,r){if(void 0===r&&(r=t.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var n=0;if(this._bytesHashed+=r,this._bufferLength>0){for(;this._bufferLength<e.BLOCK_SIZE&&r>0;)this._buffer[this._bufferLength++]=t[n++],r--;this._bufferLength===this.blockSize&&(s(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(r>=this.blockSize&&(n=s(this._tempHi,this._tempLo,this._stateHi,this._stateLo,t,n,r),r%=this.blockSize);r>0;)this._buffer[this._bufferLength++]=t[n++],r--;return this},n.prototype.finish=function(e){if(!this._finished){var r=this._bytesHashed,n=this._bufferLength,i=r/536870912|0,o=r<<3,a=r%128<112?128:256;this._buffer[n]=128;for(var c=n+1;c<a-8;c++)this._buffer[c]=0;t.writeUint32BE(i,this._buffer,a-8),t.writeUint32BE(o,this._buffer,a-4),s(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,a),this._finished=!0}for(c=0;c<this.digestLength/8;c++)t.writeUint32BE(this._stateHi[c],e,8*c),t.writeUint32BE(this._stateLo[c],e,8*c+4);return this},n.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},n.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},n.prototype.restoreState=function(e){return this._stateHi.set(e.stateHi),this._stateLo.set(e.stateLo),this._bufferLength=e.bufferLength,e.buffer&&this._buffer.set(e.buffer),this._bytesHashed=e.bytesHashed,this._finished=!1,this},n.prototype.cleanSavedState=function(e){r.wipe(e.stateHi),r.wipe(e.stateLo),e.buffer&&r.wipe(e.buffer),e.bufferLength=0,e.bytesHashed=0},n}();e.SHA512=n;var i=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function s(e,r,n,s,o,a,c){for(var u,h,l,p,f,d,g,y,v=n[0],m=n[1],_=n[2],w=n[3],b=n[4],E=n[5],I=n[6],S=n[7],P=s[0],O=s[1],x=s[2],C=s[3],R=s[4],A=s[5],T=s[6],j=s[7];c>=128;){for(var N=0;N<16;N++){var L=8*N+a;e[N]=t.readUint32BE(o,L),r[N]=t.readUint32BE(o,L+4)}for(N=0;N<80;N++){var z,M,D=v,k=m,q=_,U=w,$=b,V=E,H=I,K=P,G=O,B=x,F=C,W=R,Y=A,J=T;if(f=65535&(h=j),d=h>>>16,g=65535&(u=S),y=u>>>16,f+=65535&(h=(R>>>14|b<<18)^(R>>>18|b<<14)^(b>>>9|R<<23)),d+=h>>>16,g+=65535&(u=(b>>>14|R<<18)^(b>>>18|R<<14)^(R>>>9|b<<23)),y+=u>>>16,f+=65535&(h=R&A^~R&T),d+=h>>>16,g+=65535&(u=b&E^~b&I),y+=u>>>16,u=i[2*N],f+=65535&(h=i[2*N+1]),d+=h>>>16,g+=65535&u,y+=u>>>16,u=e[N%16],d+=(h=r[N%16])>>>16,g+=65535&u,y+=u>>>16,g+=(d+=(f+=65535&h)>>>16)>>>16,f=65535&(h=p=65535&f|d<<16),d=h>>>16,g=65535&(u=l=65535&g|(y+=g>>>16)<<16),y=u>>>16,f+=65535&(h=(P>>>28|v<<4)^(v>>>2|P<<30)^(v>>>7|P<<25)),d+=h>>>16,g+=65535&(u=(v>>>28|P<<4)^(P>>>2|v<<30)^(P>>>7|v<<25)),y+=u>>>16,d+=(h=P&O^P&x^O&x)>>>16,g+=65535&(u=v&m^v&_^m&_),y+=u>>>16,z=65535&(g+=(d+=(f+=65535&h)>>>16)>>>16)|(y+=g>>>16)<<16,M=65535&f|d<<16,f=65535&(h=F),d=h>>>16,g=65535&(u=U),y=u>>>16,d+=(h=p)>>>16,g+=65535&(u=l),y+=u>>>16,m=D,_=k,w=q,b=U=65535&(g+=(d+=(f+=65535&h)>>>16)>>>16)|(y+=g>>>16)<<16,E=$,I=V,S=H,v=z,O=K,x=G,C=B,R=F=65535&f|d<<16,A=W,T=Y,j=J,P=M,N%16==15)for(L=0;L<16;L++)u=e[L],f=65535&(h=r[L]),d=h>>>16,g=65535&u,y=u>>>16,u=e[(L+9)%16],f+=65535&(h=r[(L+9)%16]),d+=h>>>16,g+=65535&u,y+=u>>>16,l=e[(L+1)%16],f+=65535&(h=((p=r[(L+1)%16])>>>1|l<<31)^(p>>>8|l<<24)^(p>>>7|l<<25)),d+=h>>>16,g+=65535&(u=(l>>>1|p<<31)^(l>>>8|p<<24)^l>>>7),y+=u>>>16,l=e[(L+14)%16],d+=(h=((p=r[(L+14)%16])>>>19|l<<13)^(l>>>29|p<<3)^(p>>>6|l<<26))>>>16,g+=65535&(u=(l>>>19|p<<13)^(p>>>29|l<<3)^l>>>6),y+=u>>>16,y+=(g+=(d+=(f+=65535&h)>>>16)>>>16)>>>16,e[L]=65535&g|y<<16,r[L]=65535&f|d<<16}f=65535&(h=P),d=h>>>16,g=65535&(u=v),y=u>>>16,u=n[0],d+=(h=s[0])>>>16,g+=65535&u,y+=u>>>16,y+=(g+=(d+=(f+=65535&h)>>>16)>>>16)>>>16,n[0]=v=65535&g|y<<16,s[0]=P=65535&f|d<<16,f=65535&(h=O),d=h>>>16,g=65535&(u=m),y=u>>>16,u=n[1],d+=(h=s[1])>>>16,g+=65535&u,y+=u>>>16,y+=(g+=(d+=(f+=65535&h)>>>16)>>>16)>>>16,n[1]=m=65535&g|y<<16,s[1]=O=65535&f|d<<16,f=65535&(h=x),d=h>>>16,g=65535&(u=_),y=u>>>16,u=n[2],d+=(h=s[2])>>>16,g+=65535&u,y+=u>>>16,y+=(g+=(d+=(f+=65535&h)>>>16)>>>16)>>>16,n[2]=_=65535&g|y<<16,s[2]=x=65535&f|d<<16,f=65535&(h=C),d=h>>>16,g=65535&(u=w),y=u>>>16,u=n[3],d+=(h=s[3])>>>16,g+=65535&u,y+=u>>>16,y+=(g+=(d+=(f+=65535&h)>>>16)>>>16)>>>16,n[3]=w=65535&g|y<<16,s[3]=C=65535&f|d<<16,f=65535&(h=R),d=h>>>16,g=65535&(u=b),y=u>>>16,u=n[4],d+=(h=s[4])>>>16,g+=65535&u,y+=u>>>16,y+=(g+=(d+=(f+=65535&h)>>>16)>>>16)>>>16,n[4]=b=65535&g|y<<16,s[4]=R=65535&f|d<<16,f=65535&(h=A),d=h>>>16,g=65535&(u=E),y=u>>>16,u=n[5],d+=(h=s[5])>>>16,g+=65535&u,y+=u>>>16,y+=(g+=(d+=(f+=65535&h)>>>16)>>>16)>>>16,n[5]=E=65535&g|y<<16,s[5]=A=65535&f|d<<16,f=65535&(h=T),d=h>>>16,g=65535&(u=I),y=u>>>16,u=n[6],d+=(h=s[6])>>>16,g+=65535&u,y+=u>>>16,y+=(g+=(d+=(f+=65535&h)>>>16)>>>16)>>>16,n[6]=I=65535&g|y<<16,s[6]=T=65535&f|d<<16,f=65535&(h=j),d=h>>>16,g=65535&(u=S),y=u>>>16,u=n[7],d+=(h=s[7])>>>16,g+=65535&u,y+=u>>>16,y+=(g+=(d+=(f+=65535&h)>>>16)>>>16)>>>16,n[7]=S=65535&g|y<<16,s[7]=j=65535&f|d<<16,a+=128,c-=128}return a}e.hash=function(e){var t=new n;t.update(e);var r=t.digest();return t.clean(),r}}(vr),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.convertSecretKeyToX25519=e.convertPublicKeyToX25519=e.verify=e.sign=e.extractPublicKeyFromSecretKey=e.generateKeyPair=e.generateKeyPairFromSeed=e.SEED_LENGTH=e.SECRET_KEY_LENGTH=e.PUBLIC_KEY_LENGTH=e.SIGNATURE_LENGTH=void 0;const t=O,r=vr,n=P;function i(e){const t=new Float64Array(16);if(e)for(let r=0;r<e.length;r++)t[r]=e[r];return t}e.SIGNATURE_LENGTH=64,e.PUBLIC_KEY_LENGTH=32,e.SECRET_KEY_LENGTH=64,e.SEED_LENGTH=32;new Uint8Array(32)[0]=9;const s=i(),o=i([1]),a=i([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),c=i([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),u=i([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),h=i([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),l=i([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function p(e,t){for(let r=0;r<16;r++)e[r]=0|t[r]}function f(e){let t=1;for(let r=0;r<16;r++){let n=e[r]+t+65535;t=Math.floor(n/65536),e[r]=n-65536*t}e[0]+=t-1+37*(t-1)}function d(e,t,r){const n=~(r-1);for(let i=0;i<16;i++){const r=n&(e[i]^t[i]);e[i]^=r,t[i]^=r}}function g(e,t){const r=i(),n=i();for(let i=0;i<16;i++)n[i]=t[i];f(n),f(n),f(n);for(let i=0;i<2;i++){r[0]=n[0]-65517;for(let t=1;t<15;t++)r[t]=n[t]-65535-(r[t-1]>>16&1),r[t-1]&=65535;r[15]=n[15]-32767-(r[14]>>16&1);const e=r[15]>>16&1;r[14]&=65535,d(n,r,1-e)}for(let i=0;i<16;i++)e[2*i]=255&n[i],e[2*i+1]=n[i]>>8}function y(e,t){let r=0;for(let n=0;n<32;n++)r|=e[n]^t[n];return(1&r-1>>>8)-1}function v(e,t){const r=new Uint8Array(32),n=new Uint8Array(32);return g(r,e),g(n,t),y(r,n)}function m(e){const t=new Uint8Array(32);return g(t,e),1&t[0]}function _(e,t,r){for(let n=0;n<16;n++)e[n]=t[n]+r[n]}function w(e,t,r){for(let n=0;n<16;n++)e[n]=t[n]-r[n]}function b(e,t,r){let n,i,s=0,o=0,a=0,c=0,u=0,h=0,l=0,p=0,f=0,d=0,g=0,y=0,v=0,m=0,_=0,w=0,b=0,E=0,I=0,S=0,P=0,O=0,x=0,C=0,R=0,A=0,T=0,j=0,N=0,L=0,z=0,M=r[0],D=r[1],k=r[2],q=r[3],U=r[4],$=r[5],V=r[6],H=r[7],K=r[8],G=r[9],B=r[10],F=r[11],W=r[12],Y=r[13],J=r[14],Q=r[15];n=t[0],s+=n*M,o+=n*D,a+=n*k,c+=n*q,u+=n*U,h+=n*$,l+=n*V,p+=n*H,f+=n*K,d+=n*G,g+=n*B,y+=n*F,v+=n*W,m+=n*Y,_+=n*J,w+=n*Q,n=t[1],o+=n*M,a+=n*D,c+=n*k,u+=n*q,h+=n*U,l+=n*$,p+=n*V,f+=n*H,d+=n*K,g+=n*G,y+=n*B,v+=n*F,m+=n*W,_+=n*Y,w+=n*J,b+=n*Q,n=t[2],a+=n*M,c+=n*D,u+=n*k,h+=n*q,l+=n*U,p+=n*$,f+=n*V,d+=n*H,g+=n*K,y+=n*G,v+=n*B,m+=n*F,_+=n*W,w+=n*Y,b+=n*J,E+=n*Q,n=t[3],c+=n*M,u+=n*D,h+=n*k,l+=n*q,p+=n*U,f+=n*$,d+=n*V,g+=n*H,y+=n*K,v+=n*G,m+=n*B,_+=n*F,w+=n*W,b+=n*Y,E+=n*J,I+=n*Q,n=t[4],u+=n*M,h+=n*D,l+=n*k,p+=n*q,f+=n*U,d+=n*$,g+=n*V,y+=n*H,v+=n*K,m+=n*G,_+=n*B,w+=n*F,b+=n*W,E+=n*Y,I+=n*J,S+=n*Q,n=t[5],h+=n*M,l+=n*D,p+=n*k,f+=n*q,d+=n*U,g+=n*$,y+=n*V,v+=n*H,m+=n*K,_+=n*G,w+=n*B,b+=n*F,E+=n*W,I+=n*Y,S+=n*J,P+=n*Q,n=t[6],l+=n*M,p+=n*D,f+=n*k,d+=n*q,g+=n*U,y+=n*$,v+=n*V,m+=n*H,_+=n*K,w+=n*G,b+=n*B,E+=n*F,I+=n*W,S+=n*Y,P+=n*J,O+=n*Q,n=t[7],p+=n*M,f+=n*D,d+=n*k,g+=n*q,y+=n*U,v+=n*$,m+=n*V,_+=n*H,w+=n*K,b+=n*G,E+=n*B,I+=n*F,S+=n*W,P+=n*Y,O+=n*J,x+=n*Q,n=t[8],f+=n*M,d+=n*D,g+=n*k,y+=n*q,v+=n*U,m+=n*$,_+=n*V,w+=n*H,b+=n*K,E+=n*G,I+=n*B,S+=n*F,P+=n*W,O+=n*Y,x+=n*J,C+=n*Q,n=t[9],d+=n*M,g+=n*D,y+=n*k,v+=n*q,m+=n*U,_+=n*$,w+=n*V,b+=n*H,E+=n*K,I+=n*G,S+=n*B,P+=n*F,O+=n*W,x+=n*Y,C+=n*J,R+=n*Q,n=t[10],g+=n*M,y+=n*D,v+=n*k,m+=n*q,_+=n*U,w+=n*$,b+=n*V,E+=n*H,I+=n*K,S+=n*G,P+=n*B,O+=n*F,x+=n*W,C+=n*Y,R+=n*J,A+=n*Q,n=t[11],y+=n*M,v+=n*D,m+=n*k,_+=n*q,w+=n*U,b+=n*$,E+=n*V,I+=n*H,S+=n*K,P+=n*G,O+=n*B,x+=n*F,C+=n*W,R+=n*Y,A+=n*J,T+=n*Q,n=t[12],v+=n*M,m+=n*D,_+=n*k,w+=n*q,b+=n*U,E+=n*$,I+=n*V,S+=n*H,P+=n*K,O+=n*G,x+=n*B,C+=n*F,R+=n*W,A+=n*Y,T+=n*J,j+=n*Q,n=t[13],m+=n*M,_+=n*D,w+=n*k,b+=n*q,E+=n*U,I+=n*$,S+=n*V,P+=n*H,O+=n*K,x+=n*G,C+=n*B,R+=n*F,A+=n*W,T+=n*Y,j+=n*J,N+=n*Q,n=t[14],_+=n*M,w+=n*D,b+=n*k,E+=n*q,I+=n*U,S+=n*$,P+=n*V,O+=n*H,x+=n*K,C+=n*G,R+=n*B,A+=n*F,T+=n*W,j+=n*Y,N+=n*J,L+=n*Q,n=t[15],w+=n*M,b+=n*D,E+=n*k,I+=n*q,S+=n*U,P+=n*$,O+=n*V,x+=n*H,C+=n*K,R+=n*G,A+=n*B,T+=n*F,j+=n*W,N+=n*Y,L+=n*J,z+=n*Q,s+=38*b,o+=38*E,a+=38*I,c+=38*S,u+=38*P,h+=38*O,l+=38*x,p+=38*C,f+=38*R,d+=38*A,g+=38*T,y+=38*j,v+=38*N,m+=38*L,_+=38*z,i=1,n=s+i+65535,i=Math.floor(n/65536),s=n-65536*i,n=o+i+65535,i=Math.floor(n/65536),o=n-65536*i,n=a+i+65535,i=Math.floor(n/65536),a=n-65536*i,n=c+i+65535,i=Math.floor(n/65536),c=n-65536*i,n=u+i+65535,i=Math.floor(n/65536),u=n-65536*i,n=h+i+65535,i=Math.floor(n/65536),h=n-65536*i,n=l+i+65535,i=Math.floor(n/65536),l=n-65536*i,n=p+i+65535,i=Math.floor(n/65536),p=n-65536*i,n=f+i+65535,i=Math.floor(n/65536),f=n-65536*i,n=d+i+65535,i=Math.floor(n/65536),d=n-65536*i,n=g+i+65535,i=Math.floor(n/65536),g=n-65536*i,n=y+i+65535,i=Math.floor(n/65536),y=n-65536*i,n=v+i+65535,i=Math.floor(n/65536),v=n-65536*i,n=m+i+65535,i=Math.floor(n/65536),m=n-65536*i,n=_+i+65535,i=Math.floor(n/65536),_=n-65536*i,n=w+i+65535,i=Math.floor(n/65536),w=n-65536*i,s+=i-1+37*(i-1),i=1,n=s+i+65535,i=Math.floor(n/65536),s=n-65536*i,n=o+i+65535,i=Math.floor(n/65536),o=n-65536*i,n=a+i+65535,i=Math.floor(n/65536),a=n-65536*i,n=c+i+65535,i=Math.floor(n/65536),c=n-65536*i,n=u+i+65535,i=Math.floor(n/65536),u=n-65536*i,n=h+i+65535,i=Math.floor(n/65536),h=n-65536*i,n=l+i+65535,i=Math.floor(n/65536),l=n-65536*i,n=p+i+65535,i=Math.floor(n/65536),p=n-65536*i,n=f+i+65535,i=Math.floor(n/65536),f=n-65536*i,n=d+i+65535,i=Math.floor(n/65536),d=n-65536*i,n=g+i+65535,i=Math.floor(n/65536),g=n-65536*i,n=y+i+65535,i=Math.floor(n/65536),y=n-65536*i,n=v+i+65535,i=Math.floor(n/65536),v=n-65536*i,n=m+i+65535,i=Math.floor(n/65536),m=n-65536*i,n=_+i+65535,i=Math.floor(n/65536),_=n-65536*i,n=w+i+65535,i=Math.floor(n/65536),w=n-65536*i,s+=i-1+37*(i-1),e[0]=s,e[1]=o,e[2]=a,e[3]=c,e[4]=u,e[5]=h,e[6]=l,e[7]=p,e[8]=f,e[9]=d,e[10]=g,e[11]=y,e[12]=v,e[13]=m,e[14]=_,e[15]=w}function E(e,t){b(e,t,t)}function I(e,t){const r=i();let n;for(n=0;n<16;n++)r[n]=t[n];for(n=253;n>=0;n--)E(r,r),2!==n&&4!==n&&b(r,r,t);for(n=0;n<16;n++)e[n]=r[n]}function S(e,t){const r=i(),n=i(),s=i(),o=i(),a=i(),u=i(),h=i(),l=i(),p=i();w(r,e[1],e[0]),w(p,t[1],t[0]),b(r,r,p),_(n,e[0],e[1]),_(p,t[0],t[1]),b(n,n,p),b(s,e[3],t[3]),b(s,s,c),b(o,e[2],t[2]),_(o,o,o),w(a,n,r),w(u,o,s),_(h,o,s),_(l,n,r),b(e[0],a,u),b(e[1],l,h),b(e[2],h,u),b(e[3],a,l)}function x(e,t,r){for(let n=0;n<4;n++)d(e[n],t[n],r)}function C(e,t){const r=i(),n=i(),s=i();I(s,t[2]),b(r,t[0],s),b(n,t[1],s),g(e,n),e[31]^=m(r)<<7}function R(e,t,r){p(e[0],s),p(e[1],o),p(e[2],o),p(e[3],s);for(let n=255;n>=0;--n){const i=r[n/8|0]>>(7&n)&1;x(e,t,i),S(t,e),S(e,e),x(e,t,i)}}function A(e,t){const r=[i(),i(),i(),i()];p(r[0],u),p(r[1],h),p(r[2],o),b(r[3],u,h),R(e,r,t)}function T(t){if(t.length!==e.SEED_LENGTH)throw new Error(`ed25519: seed must be ${e.SEED_LENGTH} bytes`);const n=(0,r.hash)(t);n[0]&=248,n[31]&=127,n[31]|=64;const s=new Uint8Array(32),o=[i(),i(),i(),i()];A(o,n),C(s,o);const a=new Uint8Array(64);return a.set(t),a.set(s,32),{publicKey:s,secretKey:a}}e.generateKeyPairFromSeed=T,e.generateKeyPair=function(e){const r=(0,t.randomBytes)(32,e),i=T(r);return(0,n.wipe)(r),i},e.extractPublicKeyFromSecretKey=function(t){if(t.length!==e.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${e.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(t.subarray(32))};const j=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function N(e,t){let r,n,i,s;for(n=63;n>=32;--n){for(r=0,i=n-32,s=n-12;i<s;++i)t[i]+=r-16*t[n]*j[i-(n-32)],r=Math.floor((t[i]+128)/256),t[i]-=256*r;t[i]+=r,t[n]=0}for(r=0,i=0;i<32;i++)t[i]+=r-(t[31]>>4)*j[i],r=t[i]>>8,t[i]&=255;for(i=0;i<32;i++)t[i]-=r*j[i];for(n=0;n<32;n++)t[n+1]+=t[n]>>8,e[n]=255&t[n]}function L(e){const t=new Float64Array(64);for(let r=0;r<64;r++)t[r]=e[r];for(let r=0;r<64;r++)e[r]=0;N(e,t)}function z(e,t){const r=i(),n=i(),c=i(),u=i(),h=i(),f=i(),d=i();return p(e[2],o),function(e,t){for(let r=0;r<16;r++)e[r]=t[2*r]+(t[2*r+1]<<8);e[15]&=32767}(e[1],t),E(c,e[1]),b(u,c,a),w(c,c,e[2]),_(u,e[2],u),E(h,u),E(f,h),b(d,f,h),b(r,d,c),b(r,r,u),function(e,t){const r=i();let n;for(n=0;n<16;n++)r[n]=t[n];for(n=250;n>=0;n--)E(r,r),1!==n&&b(r,r,t);for(n=0;n<16;n++)e[n]=r[n]}(r,r),b(r,r,c),b(r,r,u),b(r,r,u),b(e[0],r,u),E(n,e[0]),b(n,n,u),v(n,c)&&b(e[0],e[0],l),E(n,e[0]),b(n,n,u),v(n,c)?-1:(m(e[0])===t[31]>>7&&w(e[0],s,e[0]),b(e[3],e[0],e[1]),0)}e.sign=function(e,t){const n=new Float64Array(64),s=[i(),i(),i(),i()],o=(0,r.hash)(e.subarray(0,32));o[0]&=248,o[31]&=127,o[31]|=64;const a=new Uint8Array(64);a.set(o.subarray(32),32);const c=new r.SHA512;c.update(a.subarray(32)),c.update(t);const u=c.digest();c.clean(),L(u),A(s,u),C(a,s),c.reset(),c.update(a.subarray(0,32)),c.update(e.subarray(32)),c.update(t);const h=c.digest();L(h);for(let r=0;r<32;r++)n[r]=u[r];for(let r=0;r<32;r++)for(let e=0;e<32;e++)n[r+e]+=h[r]*o[e];return N(a.subarray(32),n),a},e.verify=function(t,n,s){const o=new Uint8Array(32),a=[i(),i(),i(),i()],c=[i(),i(),i(),i()];if(s.length!==e.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${e.SIGNATURE_LENGTH} bytes`);if(z(c,t))return!1;const u=new r.SHA512;u.update(s.subarray(0,32)),u.update(t),u.update(n);const h=u.digest();return L(h),R(a,c,h),A(c,s.subarray(32)),S(a,c),C(o,a),!y(s,o)},e.convertPublicKeyToX25519=function(e){let t=[i(),i(),i(),i()];if(z(t,e))throw new Error("Ed25519: invalid public key");let r=i(),n=i(),s=t[1];_(r,o,s),w(n,o,s),I(n,n),b(r,r,n);let a=new Uint8Array(32);return g(a,r),a},e.convertSecretKeyToX25519=function(e){const t=(0,r.hash)(e.subarray(0,32));t[0]&=248,t[31]&=127,t[31]|=64;const i=new Uint8Array(t.subarray(0,32));return(0,n.wipe)(t),i}}(yr);const mr="EdDSA",_r="JWT",wr=".",br="base64url",Er="utf8",Ir="utf8",Sr=":",Pr="did",Or="key",xr="base58btc",Cr="z",Rr="K36",Ar=32;function Tr(e){return C(x(s(e),Er),br)}function jr(e){const t=x(Rr,xr),r=Cr+C(R([t,e]),xr);return[Pr,Or,r].join(Sr)}function Nr(e=O.randomBytes(Ar)){return yr.generateKeyPairFromSeed(e)}async function Lr(e,t,r,n,i=I.fromMiliseconds(Date.now())){const s={alg:mr,typ:_r},o={iss:jr(n.publicKey),sub:e,aud:t,iat:i,exp:i+r},a=x([Tr((c={header:s,payload:o}).header),Tr(c.payload)].join(wr),Ir);var c;return function(e){return[Tr(e.header),Tr(e.payload),(t=e.signature,C(t,br))].join(wr);var t}({header:s,payload:o,signature:yr.sign(n.secretKey,a)})}const zr=e=>e.split("?")[0],Mr="undefined"!=typeof WebSocket?WebSocket:void 0!==o&&void 0!==o.WebSocket?o.WebSocket:"undefined"!=typeof window&&void 0!==window.WebSocket?window.WebSocket:"undefined"!=typeof self&&void 0!==self.WebSocket?self.WebSocket:require("ws");class Dr{constructor(e){if(this.url=e,this.events=new i.EventEmitter,this.registering=!1,!a(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return void 0!==this.socket}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise(((e,t)=>{void 0!==this.socket?(this.socket.onclose=t=>{this.onClose(t),e()},this.socket.close()):t(new Error("Connection already closed"))}))}async send(e,t){void 0===this.socket&&(this.socket=await this.register());try{this.socket.send(s(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!a(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const e=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=e||this.events.listenerCount("open")>=e)&&this.events.setMaxListeners(e+1),new Promise(((e,t)=>{this.events.once("register_error",(e=>{this.resetMaxListeners(),t(e)})),this.events.once("open",(()=>{if(this.resetMaxListeners(),void 0===this.socket)return t(new Error("WebSocket connection is missing or invalid"));e(this.socket)}))}))}return this.url=e,this.registering=!0,new Promise(((t,r)=>{const n=c.isReactNative()?void 0:{rejectUnauthorized:!u(e)},i=new Mr(e,[],n);"undefined"!=typeof WebSocket||void 0!==o&&void 0!==o.WebSocket||"undefined"!=typeof window&&void 0!==window.WebSocket||"undefined"!=typeof self&&void 0!==self.WebSocket?i.onerror=e=>{const t=e;r(this.emitError(t.error))}:i.on("error",(e=>{r(this.emitError(e))})),i.onopen=()=>{this.onOpen(i),t(i)}}))}onOpen(e){e.onmessage=e=>this.onPayload(e),e.onclose=e=>this.onClose(e),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(void 0===e.data)return;const t="string"==typeof e.data?h(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const r=this.parseError(t),n=r.message||r.toString(),i=l(e,n);this.events.emit("payload",i)}parseError(e,t=this.url){return p(e,zr(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>10&&this.events.setMaxListeners(10)}emitError(e){const t=this.parseError(new Error((null==e?void 0:e.message)||`WebSocket connection failed for host: ${zr(this.url)}`));return this.events.emit("register_error",t),t}}var kr={exports:{}};!function(t,r){var n=200,i="__lodash_hash_undefined__",s=1,o=2,a=9007199254740991,c="[object Arguments]",u="[object Array]",h="[object AsyncFunction]",l="[object Boolean]",p="[object Date]",f="[object Error]",d="[object Function]",g="[object GeneratorFunction]",y="[object Map]",v="[object Number]",m="[object Null]",_="[object Object]",w="[object Promise]",b="[object Proxy]",E="[object RegExp]",I="[object Set]",S="[object String]",P="[object Symbol]",O="[object Undefined]",x="[object WeakMap]",C="[object ArrayBuffer]",R="[object DataView]",A=/^\[object .+?Constructor\]$/,T=/^(?:0|[1-9]\d*)$/,j={};j["[object Float32Array]"]=j["[object Float64Array]"]=j["[object Int8Array]"]=j["[object Int16Array]"]=j["[object Int32Array]"]=j["[object Uint8Array]"]=j["[object Uint8ClampedArray]"]=j["[object Uint16Array]"]=j["[object Uint32Array]"]=!0,j[c]=j[u]=j[C]=j[l]=j[R]=j[p]=j[f]=j[d]=j[y]=j[v]=j[_]=j[E]=j[I]=j[S]=j[x]=!1;var N="object"==typeof e&&e&&e.Object===Object&&e,L="object"==typeof self&&self&&self.Object===Object&&self,z=N||L||Function("return this")(),M=r&&!r.nodeType&&r,D=M&&t&&!t.nodeType&&t,k=D&&D.exports===M,q=k&&N.process,U=function(){try{return q&&q.binding&&q.binding("util")}catch(e){}}(),$=U&&U.isTypedArray;function V(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function H(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function K(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var G,B,F,W=Array.prototype,Y=Function.prototype,J=Object.prototype,Q=z["__core-js_shared__"],Z=Y.toString,X=J.hasOwnProperty,ee=(G=/[^.]+$/.exec(Q&&Q.keys&&Q.keys.IE_PROTO||""))?"Symbol(src)_1."+G:"",te=J.toString,re=RegExp("^"+Z.call(X).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ne=k?z.Buffer:void 0,ie=z.Symbol,se=z.Uint8Array,oe=J.propertyIsEnumerable,ae=W.splice,ce=ie?ie.toStringTag:void 0,ue=Object.getOwnPropertySymbols,he=ne?ne.isBuffer:void 0,le=(B=Object.keys,F=Object,function(e){return B(F(e))}),pe=Ue(z,"DataView"),fe=Ue(z,"Map"),de=Ue(z,"Promise"),ge=Ue(z,"Set"),ye=Ue(z,"WeakMap"),ve=Ue(Object,"create"),me=Ke(pe),_e=Ke(fe),we=Ke(de),be=Ke(ge),Ee=Ke(ye),Ie=ie?ie.prototype:void 0,Se=Ie?Ie.valueOf:void 0;function Pe(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Oe(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function xe(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Ce(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new xe;++t<r;)this.add(e[t])}function Re(e){var t=this.__data__=new Oe(e);this.size=t.size}function Ae(e,t){var r=Fe(e),n=!r&&Be(e),i=!r&&!n&&We(e),s=!r&&!n&&!i&&Xe(e),o=r||n||i||s,a=o?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],c=a.length;for(var u in e)!t&&!X.call(e,u)||o&&("length"==u||i&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||He(u,c))||a.push(u);return a}function Te(e,t){for(var r=e.length;r--;)if(Ge(e[r][0],t))return r;return-1}function je(e){return null==e?void 0===e?O:m:ce&&ce in Object(e)?function(e){var t=X.call(e,ce),r=e[ce];try{e[ce]=void 0;var n=!0}catch(s){}var i=te.call(e);n&&(t?e[ce]=r:delete e[ce]);return i}(e):function(e){return te.call(e)}(e)}function Ne(e){return Ze(e)&&je(e)==c}function Le(e,t,r,n,i){return e===t||(null==e||null==t||!Ze(e)&&!Ze(t)?e!=e&&t!=t:function(e,t,r,n,i,a){var h=Fe(e),d=Fe(t),g=h?u:Ve(e),m=d?u:Ve(t),w=(g=g==c?_:g)==_,b=(m=m==c?_:m)==_,O=g==m;if(O&&We(e)){if(!We(t))return!1;h=!0,w=!1}if(O&&!w)return a||(a=new Re),h||Xe(e)?De(e,t,r,n,i,a):function(e,t,r,n,i,a,c){switch(r){case R:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case C:return!(e.byteLength!=t.byteLength||!a(new se(e),new se(t)));case l:case p:case v:return Ge(+e,+t);case f:return e.name==t.name&&e.message==t.message;case E:case S:return e==t+"";case y:var u=H;case I:var h=n&s;if(u||(u=K),e.size!=t.size&&!h)return!1;var d=c.get(e);if(d)return d==t;n|=o,c.set(e,t);var g=De(u(e),u(t),n,i,a,c);return c.delete(e),g;case P:if(Se)return Se.call(e)==Se.call(t)}return!1}(e,t,g,r,n,i,a);if(!(r&s)){var x=w&&X.call(e,"__wrapped__"),A=b&&X.call(t,"__wrapped__");if(x||A){var T=x?e.value():e,j=A?t.value():t;return a||(a=new Re),i(T,j,r,n,a)}}if(!O)return!1;return a||(a=new Re),function(e,t,r,n,i,o){var a=r&s,c=ke(e),u=c.length,h=ke(t),l=h.length;if(u!=l&&!a)return!1;var p=u;for(;p--;){var f=c[p];if(!(a?f in t:X.call(t,f)))return!1}var d=o.get(e);if(d&&o.get(t))return d==t;var g=!0;o.set(e,t),o.set(t,e);var y=a;for(;++p<u;){var v=e[f=c[p]],m=t[f];if(n)var _=a?n(m,v,f,t,e,o):n(v,m,f,e,t,o);if(!(void 0===_?v===m||i(v,m,r,n,o):_)){g=!1;break}y||(y="constructor"==f)}if(g&&!y){var w=e.constructor,b=t.constructor;w==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof w&&w instanceof w&&"function"==typeof b&&b instanceof b||(g=!1)}return o.delete(e),o.delete(t),g}(e,t,r,n,i,a)}(e,t,r,n,Le,i))}function ze(e){return!(!Qe(e)||function(e){return!!ee&&ee in e}(e))&&(Ye(e)?re:A).test(Ke(e))}function Me(e){if(r=(t=e)&&t.constructor,n="function"==typeof r&&r.prototype||J,t!==n)return le(e);var t,r,n,i=[];for(var s in Object(e))X.call(e,s)&&"constructor"!=s&&i.push(s);return i}function De(e,t,r,n,i,a){var c=r&s,u=e.length,h=t.length;if(u!=h&&!(c&&h>u))return!1;var l=a.get(e);if(l&&a.get(t))return l==t;var p=-1,f=!0,d=r&o?new Ce:void 0;for(a.set(e,t),a.set(t,e);++p<u;){var g=e[p],y=t[p];if(n)var v=c?n(y,g,p,t,e,a):n(g,y,p,e,t,a);if(void 0!==v){if(v)continue;f=!1;break}if(d){if(!V(t,(function(e,t){if(s=t,!d.has(s)&&(g===e||i(g,e,r,n,a)))return d.push(t);var s}))){f=!1;break}}else if(g!==y&&!i(g,y,r,n,a)){f=!1;break}}return a.delete(e),a.delete(t),f}function ke(e){return function(e,t,r){var n=t(e);return Fe(e)?n:function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}(n,r(e))}(e,et,$e)}function qe(e,t){var r,n,i=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?i["string"==typeof t?"string":"hash"]:i.map}function Ue(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return ze(r)?r:void 0}Pe.prototype.clear=function(){this.__data__=ve?ve(null):{},this.size=0},Pe.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Pe.prototype.get=function(e){var t=this.__data__;if(ve){var r=t[e];return r===i?void 0:r}return X.call(t,e)?t[e]:void 0},Pe.prototype.has=function(e){var t=this.__data__;return ve?void 0!==t[e]:X.call(t,e)},Pe.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=ve&&void 0===t?i:t,this},Oe.prototype.clear=function(){this.__data__=[],this.size=0},Oe.prototype.delete=function(e){var t=this.__data__,r=Te(t,e);return!(r<0)&&(r==t.length-1?t.pop():ae.call(t,r,1),--this.size,!0)},Oe.prototype.get=function(e){var t=this.__data__,r=Te(t,e);return r<0?void 0:t[r][1]},Oe.prototype.has=function(e){return Te(this.__data__,e)>-1},Oe.prototype.set=function(e,t){var r=this.__data__,n=Te(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this},xe.prototype.clear=function(){this.size=0,this.__data__={hash:new Pe,map:new(fe||Oe),string:new Pe}},xe.prototype.delete=function(e){var t=qe(this,e).delete(e);return this.size-=t?1:0,t},xe.prototype.get=function(e){return qe(this,e).get(e)},xe.prototype.has=function(e){return qe(this,e).has(e)},xe.prototype.set=function(e,t){var r=qe(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this},Ce.prototype.add=Ce.prototype.push=function(e){return this.__data__.set(e,i),this},Ce.prototype.has=function(e){return this.__data__.has(e)},Re.prototype.clear=function(){this.__data__=new Oe,this.size=0},Re.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},Re.prototype.get=function(e){return this.__data__.get(e)},Re.prototype.has=function(e){return this.__data__.has(e)},Re.prototype.set=function(e,t){var r=this.__data__;if(r instanceof Oe){var i=r.__data__;if(!fe||i.length<n-1)return i.push([e,t]),this.size=++r.size,this;r=this.__data__=new xe(i)}return r.set(e,t),this.size=r.size,this};var $e=ue?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var r=-1,n=null==e?0:e.length,i=0,s=[];++r<n;){var o=e[r];t(o,r,e)&&(s[i++]=o)}return s}(ue(e),(function(t){return oe.call(e,t)})))}:function(){return[]},Ve=je;function He(e,t){return!!(t=null==t?a:t)&&("number"==typeof e||T.test(e))&&e>-1&&e%1==0&&e<t}function Ke(e){if(null!=e){try{return Z.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function Ge(e,t){return e===t||e!=e&&t!=t}(pe&&Ve(new pe(new ArrayBuffer(1)))!=R||fe&&Ve(new fe)!=y||de&&Ve(de.resolve())!=w||ge&&Ve(new ge)!=I||ye&&Ve(new ye)!=x)&&(Ve=function(e){var t=je(e),r=t==_?e.constructor:void 0,n=r?Ke(r):"";if(n)switch(n){case me:return R;case _e:return y;case we:return w;case be:return I;case Ee:return x}return t});var Be=Ne(function(){return arguments}())?Ne:function(e){return Ze(e)&&X.call(e,"callee")&&!oe.call(e,"callee")},Fe=Array.isArray;var We=he||function(){return!1};function Ye(e){if(!Qe(e))return!1;var t=je(e);return t==d||t==g||t==h||t==b}function Je(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=a}function Qe(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Ze(e){return null!=e&&"object"==typeof e}var Xe=$?function(e){return function(t){return e(t)}}($):function(e){return Ze(e)&&Je(e.length)&&!!j[je(e)]};function et(e){return null!=(t=e)&&Je(t.length)&&!Ye(t)?Ae(e):Me(e);var t}t.exports=function(e,t){return Le(e,t)}}(kr,kr.exports);const qr=r(kr.exports);var Ur=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var l=0,p=s-1;(0!==h||l<i)&&-1!==p;p--,l++)h+=a*o[p]>>>0,o[p]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var d=new Uint8Array(n+(s-f)),g=n;f!==s;)d[g++]=o[f++];return d}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var l=t[i],p=0,f=o-1;(0!==l||p<n)&&-1!==f;f--,p++)l+=256*u[f]>>>0,u[f]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=p,i++}for(var d=o-n;d!==o&&0===u[d];)d++;for(var g=c.repeat(r);d<o;++d)g+=e.charAt(u[d]);return g},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}},$r=Ur;const Vr=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class Hr{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Kr{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return Br(this,e)}}class Gr{constructor(e){this.decoders=e}or(e){return Br(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Br=(e,t)=>new Gr({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class Fr{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new Hr(e,t,r),this.decoder=new Kr(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Wr=({name:e,prefix:t,encode:r,decode:n})=>new Fr(e,t,r,n),Yr=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=$r(r,t);return Wr({prefix:e,name:t,encode:n,decode:e=>Vr(i(e))})},Jr=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>Wr({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let h=0;h<t.length;++h)i[t[h]]=h;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let h=0;h<s;++h){const t=i[e[h]];if(void 0===t)throw new SyntaxError(`Non-${n} character`);c=c<<r|t,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),Qr=Wr({prefix:"\0",name:"identity",encode:e=>(e=>(new TextDecoder).decode(e))(e),decode:e=>(e=>(new TextEncoder).encode(e))(e)});var Zr=Object.freeze({__proto__:null,identity:Qr});const Xr=Jr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var en=Object.freeze({__proto__:null,base2:Xr});const tn=Jr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var rn=Object.freeze({__proto__:null,base8:tn});const nn=Yr({prefix:"9",name:"base10",alphabet:"0123456789"});var sn=Object.freeze({__proto__:null,base10:nn});const on=Jr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),an=Jr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var cn=Object.freeze({__proto__:null,base16:on,base16upper:an});const un=Jr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),hn=Jr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ln=Jr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),pn=Jr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),fn=Jr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),dn=Jr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),gn=Jr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),yn=Jr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),vn=Jr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var mn=Object.freeze({__proto__:null,base32:un,base32upper:hn,base32pad:ln,base32padupper:pn,base32hex:fn,base32hexupper:dn,base32hexpad:gn,base32hexpadupper:yn,base32z:vn});const _n=Yr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),wn=Yr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var bn=Object.freeze({__proto__:null,base36:_n,base36upper:wn});const En=Yr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),In=Yr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Sn=Object.freeze({__proto__:null,base58btc:En,base58flickr:In});const Pn=Jr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),On=Jr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),xn=Jr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Cn=Jr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Rn=Object.freeze({__proto__:null,base64:Pn,base64pad:On,base64url:xn,base64urlpad:Cn});const An=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Tn=An.reduce(((e,t,r)=>(e[r]=t,e)),[]),jn=An.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const Nn=Wr({prefix:"🚀",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=Tn[t]),"")},decode:function(e){const t=[];for(const r of e){const e=jn[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}});var Ln=Object.freeze({__proto__:null,base256emoji:Nn}),zn=function e(t,r,n){r=r||[];for(var i=n=n||0;t>=kn;)r[n++]=255&t|Mn,t/=128;for(;t&Dn;)r[n++]=255&t|Mn,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},Mn=128,Dn=-128,kn=Math.pow(2,31);var qn=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&$n)<<s:(n&$n)*Math.pow(2,s),s+=7}while(n>=Un);return e.bytes=o-r,i},Un=128,$n=127;var Vn=Math.pow(2,7),Hn=Math.pow(2,14),Kn=Math.pow(2,21),Gn=Math.pow(2,28),Bn=Math.pow(2,35),Fn=Math.pow(2,42),Wn=Math.pow(2,49),Yn=Math.pow(2,56),Jn=Math.pow(2,63),Qn={encode:zn,decode:qn,encodingLength:function(e){return e<Vn?1:e<Hn?2:e<Kn?3:e<Gn?4:e<Bn?5:e<Fn?6:e<Wn?7:e<Yn?8:e<Jn?9:10}};const Zn=(e,t,r=0)=>(Qn.encode(e,t,r),t),Xn=e=>Qn.encodingLength(e),ei=(e,t)=>{const r=t.byteLength,n=Xn(e),i=n+Xn(r),s=new Uint8Array(i+r);return Zn(e,s,0),Zn(r,s,n),s.set(t,i),new ti(e,r,t,s)};class ti{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const ri=({name:e,code:t,encode:r})=>new ni(e,t,r);class ni{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?ei(this.code,t):t.then((e=>ei(this.code,e)))}throw Error("Unknown type, must be binary type")}}const ii=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),si=ri({name:"sha2-256",code:18,encode:ii("SHA-256")}),oi=ri({name:"sha2-512",code:19,encode:ii("SHA-512")});Object.freeze({__proto__:null,sha256:si,sha512:oi});const ai=Vr,ci={code:0,name:"identity",encode:ai,digest:e=>ei(0,ai(e))};Object.freeze({__proto__:null,identity:ci});new TextEncoder,new TextDecoder;const ui={...Zr,...en,...rn,...sn,...cn,...mn,...bn,...Sn,...Rn,...Ln};function hi(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function li(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const pi=li("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),fi=li("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=function(e=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?hi(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t})),di={utf8:pi,"utf-8":pi,hex:ui.base16,latin1:fi,ascii:fi,binary:fi,...ui};const gi="core",yi=`wc@2:${gi}:`,vi="error",mi={database:":memory:"},_i="client_ed25519_seed",wi=I.ONE_DAY,bi=I.SIX_HOURS,Ei="wss://relay.walletconnect.com",Ii="wss://relay.walletconnect.org",Si="relayer_message",Pi="relayer_message_ack",Oi="relayer_connect",xi="relayer_disconnect",Ci="relayer_error",Ri="relayer_connection_stalled",Ai="relayer_transport_closed",Ti="relayer_publish",ji="payload",Ni="connect",Li="disconnect",zi="error",Mi=I.ONE_SECOND/2,Di="subscription_created",ki="subscription_deleted",qi="subscription_sync",Ui="subscription_resubscribed",$i=1e3*I.FIVE_SECONDS,Vi={wc_pairingDelete:{req:{ttl:I.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:I.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:I.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:I.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:I.ONE_DAY,prompt:!1,tag:0},res:{ttl:I.ONE_DAY,prompt:!1,tag:0}}},Hi="history_created",Ki="history_updated",Gi="history_deleted",Bi="history_sync",Fi="expirer_created",Wi="expirer_deleted",Yi="expirer_expired",Ji="expirer_sync",Qi="verify-api",Zi="https://verify.walletconnect.com";class Xi{constructor(e,t){this.core=e,this.logger=t,this.keychain=new Map,this.name="keychain",this.version="0.3",this.initialized=!1,this.storagePrefix=yi,this.init=async()=>{if(!this.initialized){const e=await this.getKeyChain();typeof e<"u"&&(this.keychain=e),this.initialized=!0}},this.has=e=>(this.isInitialized(),this.keychain.has(e)),this.set=async(e,t)=>{this.isInitialized(),this.keychain.set(e,t),await this.persist()},this.get=e=>{this.isInitialized();const t=this.keychain.get(e);if(typeof t>"u"){const{message:t}=N("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(t)}return t},this.del=async e=>{this.isInitialized(),this.keychain.delete(e),await this.persist()},this.core=e,this.logger=Bt.generateChildLogger(t,this.name)}get context(){return Bt.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,le(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?pe(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=N("NOT_INITIALIZED",this.name);throw new Error(e)}}}class es{constructor(e,t,r){this.core=e,this.logger=t,this.name="crypto",this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=e=>(this.isInitialized(),this.keychain.has(e)),this.getClientId=async()=>{this.isInitialized();return jr(Nr(await this.getClientSeed()).publicKey)},this.generateKeyPair=()=>{this.isInitialized();const e=L();return this.setPrivateKey(e.publicKey,e.privateKey)},this.signJWT=async e=>{this.isInitialized();const t=Nr(await this.getClientSeed()),r=z(),n=wi;return await Lr(r,e,n,t)},this.generateSharedKey=(e,t,r)=>{this.isInitialized();const n=this.getPrivateKey(e),i=M(n,t);return this.setSymKey(i,r)},this.setSymKey=async(e,t)=>{this.isInitialized();const r=t||D(e);return await this.keychain.set(r,e),r},this.deleteKeyPair=async e=>{this.isInitialized(),await this.keychain.del(e)},this.deleteSymKey=async e=>{this.isInitialized(),await this.keychain.del(e)},this.encode=async(e,t,r)=>{this.isInitialized();const n=k(r),i=s(t);if(q(n)){const t=n.senderPublicKey,r=n.receiverPublicKey;e=await this.generateSharedKey(t,r)}const o=this.getSymKey(e),{type:a,senderPublicKey:c}=n;return U({type:a,symKey:o,message:i,senderPublicKey:c})},this.decode=async(e,t,r)=>{this.isInitialized();const n=$(t,r);if(q(n)){const t=n.receiverPublicKey,r=n.senderPublicKey;e=await this.generateSharedKey(t,r)}try{const r=this.getSymKey(e),n=V({symKey:r,encoded:t});return h(n)}catch(i){this.logger.error(`Failed to decode message from topic: '${e}', clientId: '${await this.getClientId()}'`),this.logger.error(i)}},this.getPayloadType=e=>{const t=H(e);return K(t.type)},this.getPayloadSenderPublicKey=e=>{const t=H(e);return t.senderPublicKey?C(t.senderPublicKey,G):void 0},this.core=e,this.logger=Bt.generateChildLogger(t,this.name),this.keychain=r||new Xi(this.core,this.logger)}get context(){return Bt.getLoggerContext(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(_i)}catch{e=z(),await this.keychain.set(_i,e)}return function(e,t="utf8"){const r=di[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):hi(globalThis.Buffer.from(e,"utf-8"))}(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=N("NOT_INITIALIZED",this.name);throw new Error(e)}}}class ts extends ar{constructor(e,t){super(e,t),this.logger=e,this.core=t,this.messages=new Map,this.name="messages",this.version="0.3",this.initialized=!1,this.storagePrefix=yi,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const e=await this.getRelayerMessages();typeof e<"u"&&(this.messages=e),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}finally{this.initialized=!0}}},this.set=async(e,t)=>{this.isInitialized();const r=fe(t);let n=this.messages.get(e);return typeof n>"u"&&(n={}),typeof n[r]<"u"||(n[r]=t,this.messages.set(e,n),await this.persist()),r},this.get=e=>{this.isInitialized();let t=this.messages.get(e);return typeof t>"u"&&(t={}),t},this.has=(e,t)=>{this.isInitialized();return typeof this.get(e)[fe(t)]<"u"},this.del=async e=>{this.isInitialized(),this.messages.delete(e),await this.persist()},this.logger=Bt.generateChildLogger(e,this.name),this.core=t}get context(){return Bt.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,le(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?pe(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=N("NOT_INITIALIZED",this.name);throw new Error(e)}}}class rs extends cr{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.events=new i.EventEmitter,this.name="publisher",this.queue=new Map,this.publishTimeout=I.toMiliseconds(I.TEN_SECONDS),this.queueTimeout=I.toMiliseconds(I.FIVE_SECONDS),this.needsTransportRestart=!1,this.publish=async(e,t,r)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:e,message:t,opts:r}});try{const n=(null==r?void 0:r.ttl)||bi,i=de(r),s=(null==r?void 0:r.prompt)||!1,o=(null==r?void 0:r.tag)||0,a=(null==r?void 0:r.id)||b().toString(),c={topic:e,message:t,opts:{ttl:n,relay:i,prompt:s,tag:o,id:a}},u=setTimeout((()=>this.queue.set(a,c)),this.queueTimeout);try{await await B(this.rpcPublish(e,t,n,i,s,o,a),this.publishTimeout),clearTimeout(u),this.relayer.events.emit(Ti,c)}catch{return this.logger.debug("Publishing Payload stalled"),void(this.needsTransportRestart=!0)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:e,message:t,opts:r}})}catch(n){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(n),n}},this.on=(e,t)=>{this.events.on(e,t)},this.once=(e,t)=>{this.events.once(e,t)},this.off=(e,t)=>{this.events.off(e,t)},this.removeListener=(e,t)=>{this.events.removeListener(e,t)},this.relayer=e,this.logger=Bt.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return Bt.getLoggerContext(this.logger)}rpcPublish(e,t,r,n,i,s,o){var a,c,u,h;const l={method:ge(n.protocol).publish,params:{topic:e,message:t,ttl:r,prompt:i,tag:s},id:o};return A(null==(a=l.params)?void 0:a.prompt)&&(null==(c=l.params)||delete c.prompt),A(null==(u=l.params)?void 0:u.tag)&&(null==(h=l.params)||delete h.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:l}),this.relayer.request(l)}onPublish(e){this.queue.delete(e)}checkQueue(){this.queue.forEach((async e=>{const{topic:t,message:r,opts:n}=e;await this.publish(t,r,n)}))}registerEventListeners(){this.relayer.core.heartbeat.on(Rt.HEARTBEAT_EVENTS.pulse,(()=>{if(this.needsTransportRestart)return this.needsTransportRestart=!1,void this.relayer.events.emit(Ri);this.checkQueue()})),this.relayer.on(Pi,(e=>{this.onPublish(e.id.toString())}))}}class ns{constructor(){this.map=new Map,this.set=(e,t)=>{const r=this.get(e);this.exists(e,t)||this.map.set(e,[...r,t])},this.get=e=>this.map.get(e)||[],this.exists=(e,t)=>this.get(e).includes(t),this.delete=(e,t)=>{if(typeof t>"u")return void this.map.delete(e);if(!this.map.has(e))return;const r=this.get(e);if(!this.exists(e,t))return;const n=r.filter((e=>e!==t));n.length?this.map.set(e,n):this.map.delete(e)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var is=Object.defineProperty,ss=Object.defineProperties,os=Object.getOwnPropertyDescriptors,as=Object.getOwnPropertySymbols,cs=Object.prototype.hasOwnProperty,us=Object.prototype.propertyIsEnumerable,hs=(e,t,r)=>t in e?is(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ls=(e,t)=>{for(var r in t||(t={}))cs.call(t,r)&&hs(e,r,t[r]);if(as)for(var r of as(t))us.call(t,r)&&hs(e,r,t[r]);return e},ps=(e,t)=>ss(e,os(t));class fs extends lr{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.subscriptions=new Map,this.topicMap=new ns,this.events=new i.EventEmitter,this.name="subscription",this.version="0.3",this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=yi,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(e,t)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:t}});try{const r=de(t),n={topic:e,relay:r};this.pending.set(e,n);const i=await this.rpcSubscribe(e,r);return this.onSubscribe(i,n),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:t}}),i}catch(r){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(r),r}},this.unsubscribe=async(e,t)=>{await this.restartToComplete(),this.isInitialized(),typeof(null==t?void 0:t.id)<"u"?await this.unsubscribeById(e,t.id,t):await this.unsubscribeByTopic(e,t)},this.isSubscribed=async e=>!!this.topics.includes(e)||await new Promise(((t,r)=>{const n=new I.Watch;n.start(this.pendingSubscriptionWatchLabel);const i=setInterval((()=>{!this.pending.has(e)&&this.topics.includes(e)&&(clearInterval(i),n.stop(this.pendingSubscriptionWatchLabel),t(!0)),n.elapsed(this.pendingSubscriptionWatchLabel)>=$i&&(clearInterval(i),n.stop(this.pendingSubscriptionWatchLabel),r(new Error("Subscription resolution timeout")))}),this.pollingInterval)})).catch((()=>!1)),this.on=(e,t)=>{this.events.on(e,t)},this.once=(e,t)=>{this.events.once(e,t)},this.off=(e,t)=>{this.events.off(e,t)},this.removeListener=(e,t)=>{this.events.removeListener(e,t)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=Bt.generateChildLogger(t,this.name),this.clientId=""}get context(){return Bt.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,t){let r=!1;try{r=this.getSubscription(e).topic===t}catch{}return r}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const r=this.topicMap.get(e);await Promise.all(r.map((async r=>await this.unsubscribeById(e,r,t))))}async unsubscribeById(e,t,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}});try{const n=de(r);await this.rpcUnsubscribe(e,t,n);const i=ee("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,i),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}}async rpcSubscribe(e,t){const r={method:ge(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{await await B(this.relayer.request(r),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Ri)}return fe(e+this.clientId)}async rpcBatchSubscribe(e){if(!e.length)return;const t=e[0].relay,r={method:ge(t.protocol).batchSubscribe,params:{topics:e.map((e=>e.topic))}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{return await await B(this.relayer.request(r),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Ri)}}rpcUnsubscribe(e,t,r){const n={method:ge(r.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.request(n)}onSubscribe(e,t){this.setSubscription(e,ps(ls({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach((e=>{this.setSubscription(e.id,ls({},e)),this.pending.delete(e.topic)}))}async onUnsubscribe(e,t,r){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,r),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t))}addSubscription(e,t){this.subscriptions.set(e,ls({},t)),this.topicMap.set(t.topic,e),this.events.emit(Di,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:t}=N("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(t)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(ki,ps(ls({},r),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(qi)}async reset(){if(this.cached.length){const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let t=0;t<e;t++){const e=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(e)}}this.events.emit(Ui)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:e}=N("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(e)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const t=await this.rpcBatchSubscribe(e);ye(t)&&this.onBatchSubscribe(t.map(((t,r)=>ps(ls({},e[r]),{id:t}))))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(this.relayer.transportExplicitlyClosed)return;const e=[];this.pending.forEach((t=>{e.push(t)})),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on(Rt.HEARTBEAT_EVENTS.pulse,(async()=>{await this.checkPending()})),this.relayer.on(Oi,(async()=>{await this.onConnect()})),this.relayer.on(xi,(()=>{this.onDisconnect()})),this.events.on(Di,(async e=>{const t=Di;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()})),this.events.on(ki,(async e=>{const t=ki;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()}))}isInitialized(){if(!this.initialized){const{message:e}=N("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise((e=>{const t=setInterval((()=>{this.restartInProgress||(clearInterval(t),e())}),this.pollingInterval)}))}}var ds=Object.defineProperty,gs=Object.getOwnPropertySymbols,ys=Object.prototype.hasOwnProperty,vs=Object.prototype.propertyIsEnumerable,ms=(e,t,r)=>t in e?ds(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;class _s extends ur{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new i.EventEmitter,this.name="relayer",this.transportExplicitlyClosed=!1,this.initialized=!1,this.reconnecting=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.request=async e=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(e)}catch(t){throw this.logger.debug("Failed to Publish Request"),this.logger.error(t),t}},this.core=e.core,this.logger=typeof e.logger<"u"&&"string"!=typeof e.logger?Bt.generateChildLogger(e.logger,this.name):Bt.pino(Bt.getDefaultLoggerOptions({level:e.logger||"error"})),this.messages=new ts(this.logger,e.core),this.subscriber=new fs(this,this.logger),this.publisher=new rs(this,this.logger),this.relayUrl=(null==e?void 0:e.relayUrl)||Ei,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Ii}...`),await this.restartTransport(Ii)}this.registerEventListeners(),this.initialized=!0,setTimeout((async()=>{0===this.subscriber.topics.length&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)}),1e4)}get context(){return Bt.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,t,r){this.isInitialized(),await this.publisher.publish(e,t,r),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now()})}async subscribe(e,t){var r;this.isInitialized();let n=(null==(r=this.subscriber.topicMap.get(e))?void 0:r[0])||"";return n||(await Promise.all([new Promise((t=>{this.subscriber.once(Di,(r=>{r.topic===e&&t()}))})),new Promise((async r=>{n=await this.subscriber.subscribe(e,t),r()}))]),n)}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(Ai))}async transportOpen(e){if(this.transportExplicitlyClosed=!1,!this.reconnecting){this.relayUrl=e||this.relayUrl,this.reconnecting=!0;try{await Promise.all([new Promise((e=>{this.initialized||e(),this.subscriber.once(Ui,(()=>{e()}))})),await Promise.race([new Promise((async(e,t)=>{await B(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`).catch((e=>t(e))).then((()=>e())).finally((()=>this.removeListener(Ai,this.rejectTransportOpen)))})),new Promise((e=>this.once(Ai,this.rejectTransportOpen)))])])}catch(t){this.logger.error(t);const e=t;if(!this.isConnectionStalled(e.message))throw t;this.events.emit(Ai)}finally{this.reconnecting=!1}}}async restartTransport(e){this.transportExplicitlyClosed||this.reconnecting||(this.relayUrl=e||this.relayUrl,this.connected&&await Promise.all([new Promise((e=>{this.provider.once(Li,(()=>{e()}))})),this.transportClose()]),await this.createProvider(),await this.transportOpen())}isConnectionStalled(e){return this.staleConnectionErrors.some((t=>e.includes(t)))}rejectTransportOpen(){throw new Error("Attempt to connect to relay via `transportOpen` has stalled. Retrying...")}async createProvider(){const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new f(new Dr(F({sdkVersion:"2.9.2",protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:t,message:r}=e;await this.messages.set(t,r)}async shouldIgnoreMessageEvent(e){const{topic:t,message:r}=e;if(!r||0===r.length)return this.logger.debug(`Ignoring invalid/empty message: ${r}`),!0;if(!(await this.subscriber.isSubscribed(t)))return this.logger.debug(`Ignoring message for non-subscribed topic ${t}`),!0;const n=this.messages.has(t,r);return n&&this.logger.debug(`Ignoring duplicate message: ${r}`),n}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),d(e)){if(!e.method.endsWith("_subscription"))return;const t=e.params,{topic:r,message:n,publishedAt:i}=t.data,s={topic:r,message:n,publishedAt:i};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(((e,t)=>{for(var r in t||(t={}))ys.call(t,r)&&ms(e,r,t[r]);if(gs)for(var r of gs(t))vs.call(t,r)&&ms(e,r,t[r]);return e})({type:"event",event:t.id},s)),this.events.emit(t.id,s),await this.acknowledgePayload(e),await this.onMessageEvent(s)}else g(e)&&this.events.emit(Pi,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(Si,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const t=y(e.id,!0);await this.provider.connection.send(t)}registerProviderListeners(){this.provider.on(ji,(e=>this.onProviderPayload(e))),this.provider.on(Ni,(()=>{this.events.emit(Oi)})),this.provider.on(Li,(()=>{this.onProviderDisconnect()})),this.provider.on(zi,(e=>{this.logger.error(e),this.events.emit(Ci,e)}))}registerEventListeners(){this.events.on(Ri,(async()=>{await this.restartTransport()}))}onProviderDisconnect(){this.events.emit(xi),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout((async()=>{await this.restartTransport()}),I.toMiliseconds(Mi))}isInitialized(){if(!this.initialized){const{message:e}=N("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(!this.connected){if(this.connecting)return await new Promise((e=>{const t=setInterval((()=>{this.connected&&(clearInterval(t),e())}),this.connectionStatusPollingInterval)}));await this.restartTransport()}}}var ws=Object.defineProperty,bs=Object.getOwnPropertySymbols,Es=Object.prototype.hasOwnProperty,Is=Object.prototype.propertyIsEnumerable,Ss=(e,t,r)=>t in e?ws(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ps=(e,t)=>{for(var r in t||(t={}))Es.call(t,r)&&Ss(e,r,t[r]);if(bs)for(var r of bs(t))Is.call(t,r)&&Ss(e,r,t[r]);return e};class Os extends hr{constructor(e,t,r,n=yi,i=undefined){super(e,t,r,n),this.core=e,this.logger=t,this.name=r,this.map=new Map,this.version="0.3",this.cached=[],this.initialized=!1,this.storagePrefix=yi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach((e=>{this.getKey&&null!==e&&!A(e)?this.map.set(this.getKey(e),e):T(e)?this.map.set(e.id,e):j(e)&&this.map.set(e.topic,e)})),this.cached=[],this.initialized=!0)},this.set=async(e,t)=>{this.isInitialized(),this.map.has(e)?await this.update(e,t):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:e,value:t}),this.map.set(e,t),await this.persist())},this.get=e=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:e}),this.getData(e)),this.getAll=e=>(this.isInitialized(),e?this.values.filter((t=>Object.keys(e).every((r=>qr(t[r],e[r]))))):this.values),this.update=async(e,t)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:e,update:t});const r=Ps(Ps({},this.getData(e)),t);this.map.set(e,r),await this.persist()},this.delete=async(e,t)=>{this.isInitialized(),this.map.has(e)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:e,reason:t}),this.map.delete(e),await this.persist())},this.logger=Bt.generateChildLogger(t,this.name),this.storagePrefix=n,this.getKey=i}get context(){return Bt.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){const{message:t}=N("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(t),new Error(t)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:e}=N("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),new Error(e)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=N("NOT_INITIALIZED",this.name);throw new Error(e)}}}class xs{constructor(e,t){this.core=e,this.logger=t,this.name="pairing",this.version="0.3",this.events=new v,this.initialized=!1,this.storagePrefix=yi,this.ignoredPayloadTypes=[W],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:e})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...e])]},this.create=async()=>{this.isInitialized();const e=z(),t=await this.core.crypto.setSymKey(e),r=Y(I.FIVE_MINUTES),n={protocol:"irn"},i={topic:t,expiry:r,relay:n,active:!1},s=J({protocol:this.core.protocol,version:this.core.version,topic:t,symKey:e,relay:n});return await this.pairings.set(t,i),await this.core.relayer.subscribe(t),this.core.expirer.set(t,r),{topic:t,uri:s}},this.pair=async e=>{this.isInitialized(),this.isValidPair(e);const{topic:t,symKey:r,relay:n}=Q(e.uri);if(this.pairings.keys.includes(t))throw new Error(`Pairing already exists: ${t}`);if(this.core.crypto.hasKeys(t))throw new Error(`Keychain already exists: ${t}`);const i=Y(I.FIVE_MINUTES),s={topic:t,relay:n,expiry:i,active:!1};return await this.pairings.set(t,s),await this.core.crypto.setSymKey(r,t),await this.core.relayer.subscribe(t,{relay:n}),this.core.expirer.set(t,i),e.activatePairing&&await this.activate({topic:t}),s},this.activate=async({topic:e})=>{this.isInitialized();const t=Y(I.THIRTY_DAYS);await this.pairings.update(e,{active:!0,expiry:t}),this.core.expirer.set(e,t)},this.ping=async e=>{this.isInitialized(),await this.isValidPing(e);const{topic:t}=e;if(this.pairings.keys.includes(t)){const e=await this.sendRequest(t,"wc_pairingPing",{}),{done:r,resolve:n,reject:i}=Z();this.events.once(X("pairing_ping",e),(({error:e})=>{e?i(e):n()})),await r()}},this.updateExpiry=async({topic:e,expiry:t})=>{this.isInitialized(),await this.pairings.update(e,{expiry:t})},this.updateMetadata=async({topic:e,metadata:t})=>{this.isInitialized(),await this.pairings.update(e,{peerMetadata:t})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async e=>{this.isInitialized(),await this.isValidDisconnect(e);const{topic:t}=e;this.pairings.keys.includes(t)&&(await this.sendRequest(t,"wc_pairingDelete",ee("USER_DISCONNECTED")),await this.deletePairing(t))},this.sendRequest=async(e,t,r)=>{const n=w(t,r),i=await this.core.crypto.encode(e,n),s=Vi[t].req;return this.core.history.set(e,n),this.core.relayer.publish(e,i,s),n.id},this.sendResult=async(e,t,r)=>{const n=y(e,r),i=await this.core.crypto.encode(t,n),s=await this.core.history.get(t,e),o=Vi[s.request.method].res;await this.core.relayer.publish(t,i,o),await this.core.history.resolve(n)},this.sendError=async(e,t,r)=>{const n=l(e,r),i=await this.core.crypto.encode(t,n),s=await this.core.history.get(t,e),o=Vi[s.request.method]?Vi[s.request.method].res:Vi.unregistered_method.res;await this.core.relayer.publish(t,i,o),await this.core.history.resolve(n)},this.deletePairing=async(e,t)=>{await this.core.relayer.unsubscribe(e),await Promise.all([this.pairings.delete(e,ee("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(e),t?Promise.resolve():this.core.expirer.del(e)])},this.cleanup=async()=>{const e=this.pairings.getAll().filter((e=>te(e.expiry)));await Promise.all(e.map((e=>this.deletePairing(e.topic))))},this.onRelayEventRequest=e=>{const{topic:t,payload:r}=e;switch(r.method){case"wc_pairingPing":return this.onPairingPingRequest(t,r);case"wc_pairingDelete":return this.onPairingDeleteRequest(t,r);default:return this.onUnknownRpcMethodRequest(t,r)}},this.onRelayEventResponse=async e=>{const{topic:t,payload:r}=e,n=(await this.core.history.get(t,r.id)).request.method;return"wc_pairingPing"===n?this.onPairingPingResponse(t,r):this.onUnknownRpcMethodResponse(n)},this.onPairingPingRequest=async(e,t)=>{const{id:r}=t;try{this.isValidPing({topic:e}),await this.sendResult(r,e,!0),this.events.emit("pairing_ping",{id:r,topic:e})}catch(n){await this.sendError(r,e,n),this.logger.error(n)}},this.onPairingPingResponse=(e,t)=>{const{id:r}=t;setTimeout((()=>{m(t)?this.events.emit(X("pairing_ping",r),{}):_(t)&&this.events.emit(X("pairing_ping",r),{error:t.error})}),500)},this.onPairingDeleteRequest=async(e,t)=>{const{id:r}=t;try{this.isValidDisconnect({topic:e}),await this.deletePairing(e),this.events.emit("pairing_delete",{id:r,topic:e})}catch(n){await this.sendError(r,e,n),this.logger.error(n)}},this.onUnknownRpcMethodRequest=async(e,t)=>{const{id:r,method:n}=t;try{if(this.registeredMethods.includes(n))return;const t=ee("WC_METHOD_UNSUPPORTED",n);await this.sendError(r,e,t),this.logger.error(t)}catch(i){await this.sendError(r,e,i),this.logger.error(i)}},this.onUnknownRpcMethodResponse=e=>{this.registeredMethods.includes(e)||this.logger.error(ee("WC_METHOD_UNSUPPORTED",e))},this.isValidPair=e=>{if(!re(e)){const{message:t}=N("MISSING_OR_INVALID",`pair() params: ${e}`);throw new Error(t)}if(!ne(e.uri)){const{message:t}=N("MISSING_OR_INVALID",`pair() uri: ${e.uri}`);throw new Error(t)}},this.isValidPing=async e=>{if(!re(e)){const{message:t}=N("MISSING_OR_INVALID",`ping() params: ${e}`);throw new Error(t)}const{topic:t}=e;await this.isValidPairingTopic(t)},this.isValidDisconnect=async e=>{if(!re(e)){const{message:t}=N("MISSING_OR_INVALID",`disconnect() params: ${e}`);throw new Error(t)}const{topic:t}=e;await this.isValidPairingTopic(t)},this.isValidPairingTopic=async e=>{if(!ie(e,!1)){const{message:t}=N("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.pairings.keys.includes(e)){const{message:t}=N("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(te(this.pairings.get(e).expiry)){await this.deletePairing(e);const{message:t}=N("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}},this.core=e,this.logger=Bt.generateChildLogger(t,this.name),this.pairings=new Os(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Bt.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=N("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Si,(async e=>{const{topic:t,message:r}=e;if(!this.pairings.keys.includes(t)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))return;const n=await this.core.crypto.decode(t,r);try{d(n)?(this.core.history.set(t,n),this.onRelayEventRequest({topic:t,payload:n})):g(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:t,payload:n}),this.core.history.delete(t,n.id))}catch(i){this.logger.error(i)}}))}registerExpirerEvents(){this.core.expirer.on(Yi,(async e=>{const{topic:t}=se(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit("pairing_expire",{topic:t}))}))}}class Cs extends or{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.records=new Map,this.events=new i.EventEmitter,this.name="history",this.version="0.3",this.cached=[],this.initialized=!1,this.storagePrefix=yi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach((e=>this.records.set(e.id,e))),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(e,t,r)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:e,request:t,chainId:r}),this.records.has(t.id))return;const n={id:t.id,topic:e,request:{method:t.method,params:t.params||null},chainId:r,expiry:Y(I.THIRTY_DAYS)};this.records.set(n.id,n),this.events.emit(Hi,n)},this.resolve=async e=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:e}),!this.records.has(e.id))return;const t=await this.getRecord(e.id);typeof t.response>"u"&&(t.response=_(e)?{error:e.error}:{result:e.result},this.records.set(t.id,t),this.events.emit(Ki,t))},this.get=async(e,t)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:e,id:t}),await this.getRecord(t)),this.delete=(e,t)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:t}),this.values.forEach((r=>{if(r.topic===e){if(typeof t<"u"&&r.id!==t)return;this.records.delete(r.id),this.events.emit(Gi,r)}}))},this.exists=async(e,t)=>(this.isInitialized(),!!this.records.has(t)&&(await this.getRecord(t)).topic===e),this.on=(e,t)=>{this.events.on(e,t)},this.once=(e,t)=>{this.events.once(e,t)},this.off=(e,t)=>{this.events.off(e,t)},this.removeListener=(e,t)=>{this.events.removeListener(e,t)},this.logger=Bt.generateChildLogger(t,this.name)}get context(){return Bt.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach((t=>{if(typeof t.response<"u")return;const r={topic:t.topic,request:w(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(r)})),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:t}=N("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(t)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Bi)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:e}=N("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),new Error(e)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Hi,(e=>{const t=Hi;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()})),this.events.on(Ki,(e=>{const t=Ki;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()})),this.events.on(Gi,(e=>{const t=Gi;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()})),this.core.heartbeat.on(Rt.HEARTBEAT_EVENTS.pulse,(()=>{this.cleanup()}))}cleanup(){try{this.records.forEach((e=>{I.toMiliseconds(e.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${e.id}`),this.delete(e.topic,e.id))}))}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=N("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Rs extends pr{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.expirations=new Map,this.events=new i.EventEmitter,this.name="expirer",this.version="0.3",this.cached=[],this.initialized=!1,this.storagePrefix=yi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach((e=>this.expirations.set(e.target,e))),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=e=>{try{const t=this.formatTarget(e);return typeof this.getExpiration(t)<"u"}catch{return!1}},this.set=(e,t)=>{this.isInitialized();const r=this.formatTarget(e),n={target:r,expiry:t};this.expirations.set(r,n),this.checkExpiry(r,n),this.events.emit(Fi,{target:r,expiration:n})},this.get=e=>{this.isInitialized();const t=this.formatTarget(e);return this.getExpiration(t)},this.del=e=>{if(this.isInitialized(),this.has(e)){const t=this.formatTarget(e),r=this.getExpiration(t);this.expirations.delete(t),this.events.emit(Wi,{target:t,expiration:r})}},this.on=(e,t)=>{this.events.on(e,t)},this.once=(e,t)=>{this.events.once(e,t)},this.off=(e,t)=>{this.events.off(e,t)},this.removeListener=(e,t)=>{this.events.removeListener(e,t)},this.logger=Bt.generateChildLogger(t,this.name)}get context(){return Bt.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if("string"==typeof e)return oe(e);if("number"==typeof e)return ae(e);const{message:t}=N("UNKNOWN_TYPE","Target type: "+typeof e);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Ji)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:e}=N("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),new Error(e)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:t}=N("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(t),new Error(t)}return t}checkExpiry(e,t){const{expiry:r}=t;I.toMiliseconds(r)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(Yi,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach(((e,t)=>this.checkExpiry(t,e)))}registerEventListeners(){this.core.heartbeat.on(Rt.HEARTBEAT_EVENTS.pulse,(()=>this.checkExpirations())),this.events.on(Fi,(e=>{const t=Fi;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})),this.events.on(Yi,(e=>{const t=Yi;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})),this.events.on(Wi,(e=>{const t=Wi;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}))}isInitialized(){if(!this.initialized){const{message:e}=N("NOT_INITIALIZED",this.name);throw new Error(e)}}}class As extends fr{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,this.name=Qi,this.initialized=!1,this.init=async e=>{ce()||!ue()||(this.verifyUrl=(null==e?void 0:e.verifyUrl)||Zi,await this.createIframe())},this.register=async e=>{var t;if(this.initialized||await this.init(),this.iframe)try{null==(t=this.iframe.contentWindow)||t.postMessage(e.attestationId,this.verifyUrl),this.logger.info(`postMessage sent: ${e.attestationId} ${this.verifyUrl}`)}catch{}},this.resolve=async e=>{var t;if(this.isDevEnv)return"";this.logger.info(`resolving attestation: ${e.attestationId}`);const r=this.startAbortTimer(I.FIVE_SECONDS),n=await fetch(`${this.verifyUrl}/attestation/${e.attestationId}`,{signal:this.abortController.signal});return clearTimeout(r),200===n.status?null==(t=await n.json())?void 0:t.origin:""},this.createIframe=async()=>{try{await Promise.race([new Promise(((e,t)=>{if(document.getElementById(Qi))return e();const r=document.createElement("iframe");r.setAttribute("id",Qi),r.setAttribute("src",`${this.verifyUrl}/${this.projectId}`),r.style.display="none",r.addEventListener("load",(()=>{this.initialized=!0,e()})),r.addEventListener("error",(e=>{t(e)})),document.body.append(r),this.iframe=r})),new Promise((e=>{setTimeout((()=>e("iframe load timeout")),I.toMiliseconds(I.ONE_SECOND/2))}))])}catch(e){this.logger.error(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.error(e)}},this.logger=Bt.generateChildLogger(t,this.name),this.verifyUrl=Zi,this.abortController=new AbortController,this.isDevEnv=he()&&{MANPATH:"/opt/homebrew/share/man:/usr/share/man:/usr/local/share/man:/opt/homebrew/share/man::",TERM_PROGRAM:"vscode",NODE:"/opt/homebrew/Cellar/node@16/16.20.0/bin/node",INIT_CWD:"/Users/leirunze/work/kiloex/kilo-web",GEM_HOME:"/Users/leirunze/.gem",ANDROID_HOME:"/Users/leirunze/Library/Android/sdk",TERM:"xterm-256color",SHELL:"/bin/zsh",npm_config_metrics_registry:"https://registry.npmjs.org/",HOMEBREW_REPOSITORY:"/opt/homebrew",TMPDIR:"/var/folders/pz/bnz_p0ms2cq2jyswp6325gqr0000gn/T/",npm_config_global_prefix:"/opt/homebrew",TERM_PROGRAM_VERSION:"1.81.1",ZDOTDIR:"/Users/leirunze",ORIGINAL_XDG_CURRENT_DESKTOP:"undefined",MallocNanoZone:"0",COLOR:"1",npm_config_noproxy:"",npm_config_local_prefix:"/Users/leirunze/work/kiloex/kilo-web",ZSH:"/Users/leirunze/.oh-my-zsh",USER:"leirunze",COMMAND_MODE:"unix2003",npm_config_globalconfig:"/opt/homebrew/etc/npmrc",SSH_AUTH_SOCK:"/private/tmp/com.apple.launchd.7G6hiHTVIw/Listeners",PUB_HOSTED_URL:"https://pub.flutter-io.cn",__CF_USER_TEXT_ENCODING:"0x1F5:0x19:0x34",npm_execpath:"/opt/homebrew/Cellar/node@16/16.20.0/lib/node_modules/npm/bin/npm-cli.js",PAGER:"less",LSCOLORS:"Gxfxcxdxbxegedabagacad",PATH:"/Users/leirunze/work/kiloex/kilo-web/node_modules/.bin:/Users/leirunze/work/kiloex/node_modules/.bin:/Users/leirunze/work/node_modules/.bin:/Users/leirunze/node_modules/.bin:/Users/node_modules/.bin:/node_modules/.bin:/opt/homebrew/Cellar/node@16/16.20.0/lib/node_modules/npm/node_modules/@npmcli/run-script/lib/node-gyp-bin:/Users/leirunze/.gem/bin:/Users/leirunze/.rbenv/bin:/Users/leirunze/.rbenv/shims:/Library/Frameworks/Python.framework/Versions/3.10/bin:/opt/homebrew/bin:/opt/homebrew/sbin:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/Library/Apple/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin:/Users/leirunze/.gem/bin:/Users/leirunze/.rbenv/bin:/Users/leirunze/.rbenv/shims:/Library/Frameworks/Python.framework/Versions/3.10/bin:/opt/homebrew/bin:/opt/homebrew/sbin:/Users/leirunze/work/flutter/flutter/bin:/Users/leirunze/Library/Android/sdk/tools:/Users/leirunze/Library/Android/sdk/platform-tools:/Users/leirunze/work/flutter/flutter/bin:/Users/leirunze/Library/Android/sdk/tools:/Users/leirunze/Library/Android/sdk/platform-tools",npm_package_json:"/Users/leirunze/work/kiloex/kilo-web/package.json",_:"/Users/leirunze/work/kiloex/kilo-web/node_modules/.bin/vite",npm_config_userconfig:"/Users/leirunze/.npmrc",npm_config_init_module:"/Users/leirunze/.npm-init.js",USER_ZDOTDIR:"/Users/leirunze",__CFBundleIdentifier:"com.microsoft.VSCode",npm_command:"run-script",PWD:"/Users/leirunze/work/kiloex/kilo-web",JAVA_HOME:"/Library/Java/JavaVirtualMachines/jdk-18.0.2.1.jdk/Contents/Home",FLUTTER_STORAGE_BASE_URL:"https://storage.flutter-io.cn",npm_lifecycle_event:"build:app",EDITOR:"vi",npm_package_name:"kiloex-web",LANG:"zh_CN.UTF-8",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"--ms-enable-electron-run-as-node",XPC_FLAGS:"0x0",npm_config_node_gyp:"/opt/homebrew/Cellar/node@16/16.20.0/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js",RBENV_SHELL:"zsh",npm_package_version:"0.0.0",XPC_SERVICE_NAME:"0",VSCODE_INJECTION:"1",SHLVL:"2",HOME:"/Users/leirunze",VSCODE_GIT_ASKPASS_MAIN:"/Applications/Visual Studio Code.app/Contents/Resources/app/extensions/git/dist/askpass-main.js",HOMEBREW_PREFIX:"/opt/homebrew",npm_config_cache:"/Users/leirunze/.npm",LESS:"-R",LOGNAME:"leirunze",npm_lifecycle_script:"vite build --mode app",VSCODE_GIT_IPC_HANDLE:"/var/folders/pz/bnz_p0ms2cq2jyswp6325gqr0000gn/T/vscode-git-dcec91c9fa.sock",npm_config_user_agent:"npm/8.19.4 node/v16.20.0 darwin arm64 workspaces/false",VSCODE_GIT_ASKPASS_NODE:"/Applications/Visual Studio Code.app/Contents/Frameworks/Code Helper (Plugin).app/Contents/MacOS/Code Helper (Plugin)",GIT_ASKPASS:"/Applications/Visual Studio Code.app/Contents/Resources/app/extensions/git/dist/askpass.sh",INFOPATH:"/opt/homebrew/share/info:/opt/homebrew/share/info:",HOMEBREW_CELLAR:"/opt/homebrew/Cellar",npm_node_execpath:"/opt/homebrew/Cellar/node@16/16.20.0/bin/node",npm_config_prefix:"/opt/homebrew",COLORTERM:"truecolor",NODE_ENV:"production",VITE_APP_WALLET_CONNECT_PROJECT_ID:"627605290754659e26321401af0b0ad5",VITE_APP_ALCHEMY_API_KEY:"TzyBOTHzIklUp4EQsN0Zg2DF3x32bocx",VITE_APP_INFURA_API_KEY:"",VITE_APP_PARTICLE_API_KEY:"c9Rz9lVfY2GUTonCgaj6YiopUiDrOcdWfHYipY42",VITE_APP_PARTICLE_UUID:"0bdae8d8-e869-42c8-8177-3be3e8f05731",VITE_APP_NODEREAL_KEY:"30ddb24c00be4be29d4613c7272175c7",VITE_APP_MODE:"app",VITE_GA_ID:"G-08B5QJVMQ6",VITE_GA_URL:"https://www.googletagmanager.com/gtag/js?id=G-08B5QJVMQ6",VITE_GTAG_ID:"GTM-MCX2JX2",VITE_GTAG_URL:"https://www.googletagmanager.com/ns.html?id=GTM-MCX2JX2"}.IS_VITEST}get context(){return Bt.getLoggerContext(this.logger)}startAbortTimer(e){return setTimeout((()=>this.abortController.abort()),I.toMiliseconds(e))}}var Ts=Object.defineProperty,js=Object.getOwnPropertySymbols,Ns=Object.prototype.hasOwnProperty,Ls=Object.prototype.propertyIsEnumerable,zs=(e,t,r)=>t in e?Ts(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ms=(e,t)=>{for(var r in t||(t={}))Ns.call(t,r)&&zs(e,r,t[r]);if(js)for(var r of js(t))Ls.call(t,r)&&zs(e,r,t[r]);return e};class Ds extends sr{constructor(e){super(e),this.protocol="wc",this.version=2,this.name=gi,this.events=new i.EventEmitter,this.initialized=!1,this.on=(e,t)=>this.events.on(e,t),this.once=(e,t)=>this.events.once(e,t),this.off=(e,t)=>this.events.off(e,t),this.removeListener=(e,t)=>this.events.removeListener(e,t),this.projectId=null==e?void 0:e.projectId,this.relayUrl=(null==e?void 0:e.relayUrl)||Ei;const t=typeof(null==e?void 0:e.logger)<"u"&&"string"!=typeof(null==e?void 0:e.logger)?e.logger:Bt.pino(Bt.getDefaultLoggerOptions({level:(null==e?void 0:e.logger)||vi}));this.logger=Bt.generateChildLogger(t,this.name),this.heartbeat=new Rt.HeartBeat,this.crypto=new es(this,this.logger,null==e?void 0:e.keychain),this.history=new Cs(this,this.logger),this.expirer=new Rs(this,this.logger),this.storage=null!=e&&e.storage?e.storage:new Ct(Ms(Ms({},mi),null==e?void 0:e.storageOptions)),this.relayer=new _s({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new xs(this,this.logger),this.verify=new As(this.projectId||"",this.logger)}static async init(e){const t=new Ds(e);await t.initialize();const r=await t.crypto.getClientId();return await t.storage.setItem("WALLETCONNECT_CLIENT_ID",r),t}get context(){return Bt.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const ks=Ds,qs="client",Us=`wc@2:${qs}:`,$s=qs,Vs="error",Hs="WALLETCONNECT_DEEPLINK_CHOICE",Ks="Proposal expired",Gs=I.SEVEN_DAYS,Bs={wc_sessionPropose:{req:{ttl:I.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:I.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:I.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:I.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:I.ONE_DAY,prompt:!1,tag:1104},res:{ttl:I.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:I.ONE_DAY,prompt:!1,tag:1106},res:{ttl:I.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:I.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:I.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:I.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:I.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:I.ONE_DAY,prompt:!1,tag:1112},res:{ttl:I.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:I.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:I.THIRTY_SECONDS,prompt:!1,tag:1115}}},Fs={min:I.FIVE_MINUTES,max:I.SEVEN_DAYS},Ws="idle",Ys="active",Js=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var Qs=Object.defineProperty,Zs=Object.defineProperties,Xs=Object.getOwnPropertyDescriptors,eo=Object.getOwnPropertySymbols,to=Object.prototype.hasOwnProperty,ro=Object.prototype.propertyIsEnumerable,no=(e,t,r)=>t in e?Qs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,io=(e,t)=>{for(var r in t||(t={}))to.call(t,r)&&no(e,r,t[r]);if(eo)for(var r of eo(t))ro.call(t,r)&&no(e,r,t[r]);return e},so=(e,t)=>Zs(e,Xs(t));class oo extends gr{constructor(e){super(e),this.name="engine",this.events=new v,this.initialized=!1,this.ignoredPayloadTypes=[W],this.requestQueue={state:Ws,requests:[]},this.requestQueueDelay=I.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(Bs)}),this.initialized=!0,setTimeout((()=>{this.requestQueue.requests=this.getPendingSessionRequests(),this.processRequestQueue()}),I.toMiliseconds(this.requestQueueDelay)))},this.connect=async e=>{this.isInitialized();const t=so(io({},e),{requiredNamespaces:e.requiredNamespaces||{},optionalNamespaces:e.optionalNamespaces||{}});await this.isValidConnect(t);const{pairingTopic:r,requiredNamespaces:n,optionalNamespaces:i,sessionProperties:s,relays:o}=t;let a,c=r,u=!1;if(c&&(u=this.client.core.pairing.pairings.get(c).active),!c||!u){const{topic:e,uri:t}=await this.client.core.pairing.create();c=e,a=t}const h=await this.client.core.crypto.generateKeyPair(),l=io({requiredNamespaces:n,optionalNamespaces:i,relays:o??[{protocol:"irn"}],proposer:{publicKey:h,metadata:this.client.metadata}},s&&{sessionProperties:s}),{reject:p,resolve:f,done:d}=Z(I.FIVE_MINUTES,Ks);if(this.events.once(X("session_connect"),(async({error:e,session:t})=>{if(e)p(e);else if(t){t.self.publicKey=h;const e=so(io({},t),{requiredNamespaces:t.requiredNamespaces,optionalNamespaces:t.optionalNamespaces});await this.client.session.set(t.topic,e),await this.setExpiry(t.topic,t.expiry),c&&await this.client.core.pairing.updateMetadata({topic:c,metadata:t.peer.metadata}),f(e)}})),!c){const{message:e}=N("NO_MATCHING_KEY",`connect() pairing topic: ${c}`);throw new Error(e)}const g=await this.sendRequest(c,"wc_sessionPropose",l),y=Y(I.FIVE_MINUTES);return await this.setProposal(g,io({id:g,expiry:y},l)),{uri:a,approval:d}},this.pair=async e=>(this.isInitialized(),await this.client.core.pairing.pair(e)),this.approve=async e=>{this.isInitialized(),await this.isValidApprove(e);const{id:t,relayProtocol:r,namespaces:n,sessionProperties:i}=e,s=this.client.proposal.get(t);let{pairingTopic:o,proposer:a,requiredNamespaces:c,optionalNamespaces:u}=s;o=o||"",me(c)||(c=_e(n,"approve()"));const h=await this.client.core.crypto.generateKeyPair(),l=a.publicKey,p=await this.client.core.crypto.generateSharedKey(h,l);o&&t&&(await this.client.core.pairing.updateMetadata({topic:o,metadata:a.metadata}),await this.sendResult(t,o,{relay:{protocol:r??"irn"},responderPublicKey:h}),await this.client.proposal.delete(t,ee("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:o}));const f=io({relay:{protocol:r??"irn"},namespaces:n,requiredNamespaces:c,optionalNamespaces:u,pairingTopic:o,controller:{publicKey:h,metadata:this.client.metadata},expiry:Y(Gs)},i&&{sessionProperties:i});await this.client.core.relayer.subscribe(p),await this.sendRequest(p,"wc_sessionSettle",f);const d=so(io({},f),{topic:p,pairingTopic:o,acknowledged:!1,self:f.controller,peer:{publicKey:a.publicKey,metadata:a.metadata},controller:h});return await this.client.session.set(p,d),await this.setExpiry(p,Y(Gs)),{topic:p,acknowledged:()=>new Promise((e=>setTimeout((()=>e(this.client.session.get(p))),500)))}},this.reject=async e=>{this.isInitialized(),await this.isValidReject(e);const{id:t,reason:r}=e,{pairingTopic:n}=this.client.proposal.get(t);n&&(await this.sendError(t,n,r),await this.client.proposal.delete(t,ee("USER_DISCONNECTED")))},this.update=async e=>{this.isInitialized(),await this.isValidUpdate(e);const{topic:t,namespaces:r}=e,n=await this.sendRequest(t,"wc_sessionUpdate",{namespaces:r}),{done:i,resolve:s,reject:o}=Z();return this.events.once(X("session_update",n),(({error:e})=>{e?o(e):s()})),await this.client.session.update(t,{namespaces:r}),{acknowledged:i}},this.extend=async e=>{this.isInitialized(),await this.isValidExtend(e);const{topic:t}=e,r=await this.sendRequest(t,"wc_sessionExtend",{}),{done:n,resolve:i,reject:s}=Z();return this.events.once(X("session_extend",r),(({error:e})=>{e?s(e):i()})),await this.setExpiry(t,Y(Gs)),{acknowledged:n}},this.request=async e=>{this.isInitialized(),await this.isValidRequest(e);const{chainId:t,request:r,topic:n,expiry:i}=e,s=await this.sendRequest(n,"wc_sessionRequest",{request:r,chainId:t},i),{done:o,resolve:a,reject:c}=Z(i);this.events.once(X("session_request",s),(({error:e,result:t})=>{e?c(e):a(t)})),this.client.events.emit("session_request_sent",{topic:n,request:r,chainId:t,id:s});const u=await this.client.core.storage.getItem(Hs);return we({id:s,topic:n,wcDeepLink:u}),await o()},this.respond=async e=>{this.isInitialized(),await this.isValidRespond(e);const{topic:t,response:r}=e,{id:n}=r;m(r)?await this.sendResult(n,t,r.result):_(r)&&await this.sendError(n,t,r.error),this.cleanupAfterResponse(e)},this.ping=async e=>{this.isInitialized(),await this.isValidPing(e);const{topic:t}=e;if(this.client.session.keys.includes(t)){const e=await this.sendRequest(t,"wc_sessionPing",{}),{done:r,resolve:n,reject:i}=Z();this.events.once(X("session_ping",e),(({error:e})=>{e?i(e):n()})),await r()}else this.client.core.pairing.pairings.keys.includes(t)&&await this.client.core.pairing.ping({topic:t})},this.emit=async e=>{this.isInitialized(),await this.isValidEmit(e);const{topic:t,event:r,chainId:n}=e;await this.sendRequest(t,"wc_sessionEvent",{event:r,chainId:n})},this.disconnect=async e=>{this.isInitialized(),await this.isValidDisconnect(e);const{topic:t}=e;if(this.client.session.keys.includes(t)){const e=b().toString();let r;const n=t=>{(null==t?void 0:t.id.toString())===e&&(this.client.core.relayer.events.removeListener(Pi,n),r())};await Promise.all([new Promise((e=>{r=e,this.client.core.relayer.on(Pi,n)})),this.sendRequest(t,"wc_sessionDelete",ee("USER_DISCONNECTED"),void 0,e)]),await this.deleteSession(t)}else await this.client.core.pairing.disconnect({topic:t})},this.find=e=>(this.isInitialized(),this.client.session.getAll().filter((t=>be(t,e)))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async e=>{if(e.pairingTopic)try{const t=this.client.core.pairing.pairings.get(e.pairingTopic),r=this.client.core.pairing.pairings.getAll().filter((r=>{var n,i;return(null==(n=r.peerMetadata)?void 0:n.url)&&(null==(i=r.peerMetadata)?void 0:i.url)===e.peer.metadata.url&&r.topic&&r.topic!==t.topic}));if(0===r.length)return;this.client.logger.info(`Cleaning up ${r.length} duplicate pairing(s)`),await Promise.all(r.map((e=>this.client.core.pairing.disconnect({topic:e.topic})))),this.client.logger.info("Duplicate pairings clean up finished")}catch(t){this.client.logger.error(t)}},this.deleteSession=async(e,t)=>{const{self:r}=this.client.session.get(e);await this.client.core.relayer.unsubscribe(e),this.client.session.delete(e,ee("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(r.publicKey)&&await this.client.core.crypto.deleteKeyPair(r.publicKey),this.client.core.crypto.keychain.has(e)&&await this.client.core.crypto.deleteSymKey(e),t||this.client.core.expirer.del(e),this.client.core.storage.removeItem(Hs).catch((e=>this.client.logger.warn(e)))},this.deleteProposal=async(e,t)=>{await Promise.all([this.client.proposal.delete(e,ee("USER_DISCONNECTED")),t?Promise.resolve():this.client.core.expirer.del(e)])},this.deletePendingSessionRequest=async(e,t,r=!1)=>{await Promise.all([this.client.pendingRequest.delete(e,t),r?Promise.resolve():this.client.core.expirer.del(e)]),this.requestQueue.requests=this.requestQueue.requests.filter((t=>t.id!==e)),r&&(this.requestQueue.state=Ws)},this.setExpiry=async(e,t)=>{this.client.session.keys.includes(e)&&await this.client.session.update(e,{expiry:t}),this.client.core.expirer.set(e,t)},this.setProposal=async(e,t)=>{await this.client.proposal.set(e,t),this.client.core.expirer.set(e,t.expiry)},this.setPendingSessionRequest=async e=>{const t=Bs.wc_sessionRequest.req.ttl,{id:r,topic:n,params:i}=e;await this.client.pendingRequest.set(r,{id:r,topic:n,params:i}),t&&this.client.core.expirer.set(r,Y(t))},this.sendRequest=async(e,t,r,n,i)=>{const s=w(t,r);if(ue()&&Js.includes(t)){const e=fe(JSON.stringify(s));await this.client.core.verify.register({attestationId:e})}const o=await this.client.core.crypto.encode(e,s),a=Bs[t].req;return n&&(a.ttl=n),i&&(a.id=i),this.client.core.history.set(e,s),this.client.core.relayer.publish(e,o,a),s.id},this.sendResult=async(e,t,r)=>{const n=y(e,r),i=await this.client.core.crypto.encode(t,n),s=await this.client.core.history.get(t,e),o=Bs[s.request.method].res;this.client.core.relayer.publish(t,i,o),await this.client.core.history.resolve(n)},this.sendError=async(e,t,r)=>{const n=l(e,r),i=await this.client.core.crypto.encode(t,n),s=await this.client.core.history.get(t,e),o=Bs[s.request.method].res;this.client.core.relayer.publish(t,i,o),await this.client.core.history.resolve(n)},this.cleanup=async()=>{const e=[],t=[];this.client.session.getAll().forEach((t=>{te(t.expiry)&&e.push(t.topic)})),this.client.proposal.getAll().forEach((e=>{te(e.expiry)&&t.push(e.id)})),await Promise.all([...e.map((e=>this.deleteSession(e))),...t.map((e=>this.deleteProposal(e)))])},this.onRelayEventRequest=e=>{const{topic:t,payload:r}=e,n=r.method;switch(n){case"wc_sessionPropose":return this.onSessionProposeRequest(t,r);case"wc_sessionSettle":return this.onSessionSettleRequest(t,r);case"wc_sessionUpdate":return this.onSessionUpdateRequest(t,r);case"wc_sessionExtend":return this.onSessionExtendRequest(t,r);case"wc_sessionPing":return this.onSessionPingRequest(t,r);case"wc_sessionDelete":return this.onSessionDeleteRequest(t,r);case"wc_sessionRequest":return this.onSessionRequest(t,r);case"wc_sessionEvent":return this.onSessionEventRequest(t,r);default:return this.client.logger.info(`Unsupported request method ${n}`)}},this.onRelayEventResponse=async e=>{const{topic:t,payload:r}=e,n=(await this.client.core.history.get(t,r.id)).request.method;switch(n){case"wc_sessionPropose":return this.onSessionProposeResponse(t,r);case"wc_sessionSettle":return this.onSessionSettleResponse(t,r);case"wc_sessionUpdate":return this.onSessionUpdateResponse(t,r);case"wc_sessionExtend":return this.onSessionExtendResponse(t,r);case"wc_sessionPing":return this.onSessionPingResponse(t,r);case"wc_sessionRequest":return this.onSessionRequestResponse(t,r);default:return this.client.logger.info(`Unsupported response method ${n}`)}},this.onRelayEventUnknownPayload=e=>{const{topic:t}=e,{message:r}=N("MISSING_OR_INVALID",`Decoded payload on topic ${t} is not identifiable as a JSON-RPC request or a response.`);throw new Error(r)},this.onSessionProposeRequest=async(e,t)=>{const{params:r,id:n}=t;try{this.isValidConnect(io({},t.params));const i=Y(I.FIVE_MINUTES),s=io({id:n,pairingTopic:e,expiry:i},r);await this.setProposal(n,s);const o=fe(JSON.stringify(t)),a=await this.getVerifyContext(o,s.proposer.metadata);this.client.events.emit("session_proposal",{id:n,params:s,verifyContext:a})}catch(i){await this.sendError(n,e,i),this.client.logger.error(i)}},this.onSessionProposeResponse=async(e,t)=>{const{id:r}=t;if(m(t)){const{result:n}=t;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:n});const i=this.client.proposal.get(r);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:i});const s=i.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:s});const o=n.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:o});const a=await this.client.core.crypto.generateSharedKey(s,o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:a});const c=await this.client.core.relayer.subscribe(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:c}),await this.client.core.pairing.activate({topic:e})}else _(t)&&(await this.client.proposal.delete(r,ee("USER_DISCONNECTED")),this.events.emit(X("session_connect"),{error:t.error}))},this.onSessionSettleRequest=async(e,t)=>{const{id:r,params:n}=t;try{this.isValidSessionSettleRequest(n);const{relay:r,controller:i,expiry:s,namespaces:o,requiredNamespaces:a,optionalNamespaces:c,sessionProperties:u,pairingTopic:h}=t.params,l=io({topic:e,relay:r,expiry:s,namespaces:o,acknowledged:!0,pairingTopic:h,requiredNamespaces:a,optionalNamespaces:c,controller:i.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:i.publicKey,metadata:i.metadata}},u&&{sessionProperties:u});await this.sendResult(t.id,e,!0),this.events.emit(X("session_connect"),{session:l}),this.cleanupDuplicatePairings(l)}catch(i){await this.sendError(r,e,i),this.client.logger.error(i)}},this.onSessionSettleResponse=async(e,t)=>{const{id:r}=t;m(t)?(await this.client.session.update(e,{acknowledged:!0}),this.events.emit(X("session_approve",r),{})):_(t)&&(await this.client.session.delete(e,ee("USER_DISCONNECTED")),this.events.emit(X("session_approve",r),{error:t.error}))},this.onSessionUpdateRequest=async(e,t)=>{const{params:r,id:n}=t;try{this.isValidUpdate(io({topic:e},r)),await this.client.session.update(e,{namespaces:r.namespaces}),await this.sendResult(n,e,!0),this.client.events.emit("session_update",{id:n,topic:e,params:r})}catch(i){await this.sendError(n,e,i),this.client.logger.error(i)}},this.onSessionUpdateResponse=(e,t)=>{const{id:r}=t;m(t)?this.events.emit(X("session_update",r),{}):_(t)&&this.events.emit(X("session_update",r),{error:t.error})},this.onSessionExtendRequest=async(e,t)=>{const{id:r}=t;try{this.isValidExtend({topic:e}),await this.setExpiry(e,Y(Gs)),await this.sendResult(r,e,!0),this.client.events.emit("session_extend",{id:r,topic:e})}catch(n){await this.sendError(r,e,n),this.client.logger.error(n)}},this.onSessionExtendResponse=(e,t)=>{const{id:r}=t;m(t)?this.events.emit(X("session_extend",r),{}):_(t)&&this.events.emit(X("session_extend",r),{error:t.error})},this.onSessionPingRequest=async(e,t)=>{const{id:r}=t;try{this.isValidPing({topic:e}),await this.sendResult(r,e,!0),this.client.events.emit("session_ping",{id:r,topic:e})}catch(n){await this.sendError(r,e,n),this.client.logger.error(n)}},this.onSessionPingResponse=(e,t)=>{const{id:r}=t;setTimeout((()=>{m(t)?this.events.emit(X("session_ping",r),{}):_(t)&&this.events.emit(X("session_ping",r),{error:t.error})}),500)},this.onSessionDeleteRequest=async(e,t)=>{const{id:r}=t;try{this.isValidDisconnect({topic:e,reason:t.params}),await Promise.all([new Promise((t=>{this.client.core.relayer.once(Ti,(async()=>{t(await this.deleteSession(e))}))})),this.sendResult(r,e,!0)]),this.client.events.emit("session_delete",{id:r,topic:e})}catch(n){this.client.logger.error(n)}},this.onSessionRequest=async(e,t)=>{const{id:r,params:n}=t;try{this.isValidRequest(io({topic:e},n)),await this.setPendingSessionRequest({id:r,topic:e,params:n}),this.addRequestToQueue({id:r,topic:e,params:n}),await this.processRequestQueue()}catch(i){await this.sendError(r,e,i),this.client.logger.error(i)}},this.onSessionRequestResponse=(e,t)=>{const{id:r}=t;m(t)?this.events.emit(X("session_request",r),{result:t.result}):_(t)&&this.events.emit(X("session_request",r),{error:t.error})},this.onSessionEventRequest=async(e,t)=>{const{id:r,params:n}=t;try{this.isValidEmit(io({topic:e},n)),this.client.events.emit("session_event",{id:r,topic:e,params:n})}catch(i){await this.sendError(r,e,i),this.client.logger.error(i)}},this.addRequestToQueue=e=>{this.requestQueue.requests.push(e)},this.cleanupAfterResponse=e=>{this.deletePendingSessionRequest(e.response.id,{message:"fulfilled",code:0}),setTimeout((()=>{this.requestQueue.state=Ws,this.processRequestQueue()}),I.toMiliseconds(this.requestQueueDelay))},this.processRequestQueue=async()=>{if(this.requestQueue.state===Ys)return void this.client.logger.info("session request queue is already active.");const e=this.requestQueue.requests[0];if(e)try{const{id:t,topic:r,params:n}=e,i=fe(JSON.stringify({id:t,params:n})),s=this.client.session.get(r),o=await this.getVerifyContext(i,s.peer.metadata);this.requestQueue.state=Ys,this.client.events.emit("session_request",{id:t,topic:r,params:n,verifyContext:o})}catch(t){this.client.logger.error(t)}else this.client.logger.info("session request queue is empty.")},this.isValidConnect=async e=>{if(!re(e)){const{message:t}=N("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(e)}`);throw new Error(t)}const{pairingTopic:t,requiredNamespaces:r,optionalNamespaces:n,sessionProperties:i,relays:s}=e;if(A(t)||await this.isValidPairingTopic(t),!Ee(s,!0)){const{message:e}=N("MISSING_OR_INVALID",`connect() relays: ${s}`);throw new Error(e)}!A(r)&&0!==me(r)&&this.validateNamespaces(r,"requiredNamespaces"),!A(n)&&0!==me(n)&&this.validateNamespaces(n,"optionalNamespaces"),A(i)||this.validateSessionProps(i,"sessionProperties")},this.validateNamespaces=(e,t)=>{const r=Ie(e,"connect()",t);if(r)throw new Error(r.message)},this.isValidApprove=async e=>{if(!re(e))throw new Error(N("MISSING_OR_INVALID",`approve() params: ${e}`).message);const{id:t,namespaces:r,relayProtocol:n,sessionProperties:i}=e;await this.isValidProposalId(t);const s=this.client.proposal.get(t),o=Se(r,"approve()");if(o)throw new Error(o.message);const a=Pe(s.requiredNamespaces,r,"approve()");if(a)throw new Error(a.message);if(!ie(n,!0)){const{message:e}=N("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(e)}A(i)||this.validateSessionProps(i,"sessionProperties")},this.isValidReject=async e=>{if(!re(e)){const{message:t}=N("MISSING_OR_INVALID",`reject() params: ${e}`);throw new Error(t)}const{id:t,reason:r}=e;if(await this.isValidProposalId(t),!Oe(r)){const{message:e}=N("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(r)}`);throw new Error(e)}},this.isValidSessionSettleRequest=e=>{if(!re(e)){const{message:t}=N("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${e}`);throw new Error(t)}const{relay:t,controller:r,namespaces:n,expiry:i}=e;if(!xe(t)){const{message:e}=N("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(e)}const s=Ce(r,"onSessionSettleRequest()");if(s)throw new Error(s.message);const o=Se(n,"onSessionSettleRequest()");if(o)throw new Error(o.message);if(te(i)){const{message:e}=N("EXPIRED","onSessionSettleRequest()");throw new Error(e)}},this.isValidUpdate=async e=>{if(!re(e)){const{message:t}=N("MISSING_OR_INVALID",`update() params: ${e}`);throw new Error(t)}const{topic:t,namespaces:r}=e;await this.isValidSessionTopic(t);const n=this.client.session.get(t),i=Se(r,"update()");if(i)throw new Error(i.message);const s=Pe(n.requiredNamespaces,r,"update()");if(s)throw new Error(s.message)},this.isValidExtend=async e=>{if(!re(e)){const{message:t}=N("MISSING_OR_INVALID",`extend() params: ${e}`);throw new Error(t)}const{topic:t}=e;await this.isValidSessionTopic(t)},this.isValidRequest=async e=>{if(!re(e)){const{message:t}=N("MISSING_OR_INVALID",`request() params: ${e}`);throw new Error(t)}const{topic:t,request:r,chainId:n,expiry:i}=e;await this.isValidSessionTopic(t);const{namespaces:s}=this.client.session.get(t);if(!Re(s,n)){const{message:e}=N("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(e)}if(!Ae(r)){const{message:e}=N("MISSING_OR_INVALID",`request() ${JSON.stringify(r)}`);throw new Error(e)}if(!Te(s,n,r.method)){const{message:e}=N("MISSING_OR_INVALID",`request() method: ${r.method}`);throw new Error(e)}if(i&&!je(i,Fs)){const{message:e}=N("MISSING_OR_INVALID",`request() expiry: ${i}. Expiry must be a number (in seconds) between ${Fs.min} and ${Fs.max}`);throw new Error(e)}},this.isValidRespond=async e=>{if(!re(e)){const{message:t}=N("MISSING_OR_INVALID",`respond() params: ${e}`);throw new Error(t)}const{topic:t,response:r}=e;if(await this.isValidSessionTopic(t),!Ne(r)){const{message:e}=N("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(r)}`);throw new Error(e)}},this.isValidPing=async e=>{if(!re(e)){const{message:t}=N("MISSING_OR_INVALID",`ping() params: ${e}`);throw new Error(t)}const{topic:t}=e;await this.isValidSessionOrPairingTopic(t)},this.isValidEmit=async e=>{if(!re(e)){const{message:t}=N("MISSING_OR_INVALID",`emit() params: ${e}`);throw new Error(t)}const{topic:t,event:r,chainId:n}=e;await this.isValidSessionTopic(t);const{namespaces:i}=this.client.session.get(t);if(!Re(i,n)){const{message:e}=N("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(e)}if(!Le(r)){const{message:e}=N("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(r)}`);throw new Error(e)}if(!ze(i,n,r.name)){const{message:e}=N("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(r)}`);throw new Error(e)}},this.isValidDisconnect=async e=>{if(!re(e)){const{message:t}=N("MISSING_OR_INVALID",`disconnect() params: ${e}`);throw new Error(t)}const{topic:t}=e;await this.isValidSessionOrPairingTopic(t)},this.getVerifyContext=async(e,t)=>{const r={verified:{verifyUrl:t.verifyUrl||"",validation:"UNKNOWN",origin:t.url||""}};try{const n=await this.client.core.verify.resolve({attestationId:e,verifyUrl:t.verifyUrl});n&&(r.verified.origin=n,r.verified.validation=n===t.url?"VALID":"INVALID")}catch(n){this.client.logger.error(n)}return this.client.logger.info(`Verify context: ${JSON.stringify(r)}`),r},this.validateSessionProps=(e,t)=>{Object.values(e).forEach((e=>{if(!ie(e,!1)){const{message:r}=N("MISSING_OR_INVALID",`${t} must be in Record<string, string> format. Received: ${JSON.stringify(e)}`);throw new Error(r)}}))}}isInitialized(){if(!this.initialized){const{message:e}=N("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(Si,(async e=>{const{topic:t,message:r}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(r)))return;const n=await this.client.core.crypto.decode(t,r);try{d(n)?(this.client.core.history.set(t,n),this.onRelayEventRequest({topic:t,payload:n})):g(n)?(await this.client.core.history.resolve(n),await this.onRelayEventResponse({topic:t,payload:n}),this.client.core.history.delete(t,n.id)):this.onRelayEventUnknownPayload({topic:t,payload:n})}catch(i){this.client.logger.error(i)}}))}registerExpirerEvents(){this.client.core.expirer.on(Yi,(async e=>{const{topic:t,id:r}=se(e.target);if(r&&this.client.pendingRequest.keys.includes(r))return await this.deletePendingSessionRequest(r,N("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession(t,!0),this.client.events.emit("session_expire",{topic:t})):r&&(await this.deleteProposal(r,!0),this.client.events.emit("proposal_expire",{id:r}))}))}isValidPairingTopic(e){if(!ie(e,!1)){const{message:t}=N("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=N("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(te(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=N("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!ie(e,!1)){const{message:t}=N("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(!this.client.session.keys.includes(e)){const{message:t}=N("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(te(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:t}=N("EXPIRED",`session topic: ${e}`);throw new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else{if(!this.client.core.pairing.pairings.keys.includes(e)){if(ie(e,!1)){const{message:t}=N("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}{const{message:t}=N("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}this.isValidPairingTopic(e)}}async isValidProposalId(e){if(!Me(e)){const{message:t}=N("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=N("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(te(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:t}=N("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}}class ao extends Os{constructor(e,t){super(e,t,"proposal",Us),this.core=e,this.logger=t}}class co extends Os{constructor(e,t){super(e,t,"session",Us),this.core=e,this.logger=t}}class uo extends Os{constructor(e,t){super(e,t,"request",Us,(e=>e.id)),this.core=e,this.logger=t}}let ho=class e extends dr{constructor(e){super(e),this.protocol="wc",this.version=2,this.name=$s,this.events=new i.EventEmitter,this.on=(e,t)=>this.events.on(e,t),this.once=(e,t)=>this.events.once(e,t),this.off=(e,t)=>this.events.off(e,t),this.removeListener=(e,t)=>this.events.removeListener(e,t),this.removeAllListeners=e=>this.events.removeAllListeners(e),this.connect=async e=>{try{return await this.engine.connect(e)}catch(t){throw this.logger.error(t.message),t}},this.pair=async e=>{try{return await this.engine.pair(e)}catch(t){throw this.logger.error(t.message),t}},this.approve=async e=>{try{return await this.engine.approve(e)}catch(t){throw this.logger.error(t.message),t}},this.reject=async e=>{try{return await this.engine.reject(e)}catch(t){throw this.logger.error(t.message),t}},this.update=async e=>{try{return await this.engine.update(e)}catch(t){throw this.logger.error(t.message),t}},this.extend=async e=>{try{return await this.engine.extend(e)}catch(t){throw this.logger.error(t.message),t}},this.request=async e=>{try{return await this.engine.request(e)}catch(t){throw this.logger.error(t.message),t}},this.respond=async e=>{try{return await this.engine.respond(e)}catch(t){throw this.logger.error(t.message),t}},this.ping=async e=>{try{return await this.engine.ping(e)}catch(t){throw this.logger.error(t.message),t}},this.emit=async e=>{try{return await this.engine.emit(e)}catch(t){throw this.logger.error(t.message),t}},this.disconnect=async e=>{try{return await this.engine.disconnect(e)}catch(t){throw this.logger.error(t.message),t}},this.find=e=>{try{return this.engine.find(e)}catch(t){throw this.logger.error(t.message),t}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(e){throw this.logger.error(e.message),e}},this.name=(null==e?void 0:e.name)||$s,this.metadata=(null==e?void 0:e.metadata)||ve();const t=typeof(null==e?void 0:e.logger)<"u"&&"string"!=typeof(null==e?void 0:e.logger)?e.logger:Bt.pino(Bt.getDefaultLoggerOptions({level:(null==e?void 0:e.logger)||Vs}));this.core=(null==e?void 0:e.core)||new ks(e),this.logger=Bt.generateChildLogger(t,this.name),this.session=new co(this.core,this.logger),this.proposal=new ao(this.core,this.logger),this.pendingRequest=new uo(this.core,this.logger),this.engine=new oo(this)}static async init(t){const r=new e(t);return await r.initialize(),r}get context(){return Bt.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};const lo="error",po="wc@2:universal_provider:",fo="https://rpc.walletconnect.com/v1",go="default_chain_changed";var yo,vo,mo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof o<"u"?o:typeof self<"u"?self:{},_o={exports:{}};
/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/yo=_o,vo=_o.exports,function(){var e,t=200,r="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",n="Expected a function",i="Invalid `variable` option passed into `_.template`",s="__lodash_hash_undefined__",o=500,a="__lodash_placeholder__",c=1,u=2,h=4,l=1,p=2,f=1,d=2,g=4,y=8,v=16,m=32,_=64,w=128,b=256,E=512,I=30,S="...",P=800,O=16,x=1,C=2,R=1/0,A=9007199254740991,T=17976931348623157e292,j=NaN,N=4294967295,L=N-1,z=N>>>1,M=[["ary",w],["bind",f],["bindKey",d],["curry",y],["curryRight",v],["flip",E],["partial",m],["partialRight",_],["rearg",b]],D="[object Arguments]",k="[object Array]",q="[object AsyncFunction]",U="[object Boolean]",$="[object Date]",V="[object DOMException]",H="[object Error]",K="[object Function]",G="[object GeneratorFunction]",B="[object Map]",F="[object Number]",W="[object Null]",Y="[object Object]",J="[object Promise]",Q="[object Proxy]",Z="[object RegExp]",X="[object Set]",ee="[object String]",te="[object Symbol]",re="[object Undefined]",ne="[object WeakMap]",ie="[object WeakSet]",se="[object ArrayBuffer]",oe="[object DataView]",ae="[object Float32Array]",ce="[object Float64Array]",ue="[object Int8Array]",he="[object Int16Array]",le="[object Int32Array]",pe="[object Uint8Array]",fe="[object Uint8ClampedArray]",de="[object Uint16Array]",ge="[object Uint32Array]",ye=/\b__p \+= '';/g,ve=/\b(__p \+=) '' \+/g,me=/(__e\(.*?\)|\b__t\)) \+\n'';/g,_e=/&(?:amp|lt|gt|quot|#39);/g,we=/[&<>"']/g,be=RegExp(_e.source),Ee=RegExp(we.source),Ie=/<%-([\s\S]+?)%>/g,Se=/<%([\s\S]+?)%>/g,Pe=/<%=([\s\S]+?)%>/g,Oe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,xe=/^\w*$/,Ce=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Re=/[\\^$.*+?()[\]{}|]/g,Ae=RegExp(Re.source),Te=/^\s+/,je=/\s/,Ne=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Le=/\{\n\/\* \[wrapped with (.+)\] \*/,ze=/,? & /,Me=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,De=/[()=,{}\[\]\/\s]/,ke=/\\(\\)?/g,qe=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ue=/\w*$/,$e=/^[-+]0x[0-9a-f]+$/i,Ve=/^0b[01]+$/i,He=/^\[object .+?Constructor\]$/,Ke=/^0o[0-7]+$/i,Ge=/^(?:0|[1-9]\d*)$/,Be=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Fe=/($^)/,We=/['\n\r\u2028\u2029\\]/g,Ye="\\ud800-\\udfff",Je="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Qe="\\u2700-\\u27bf",Ze="a-z\\xdf-\\xf6\\xf8-\\xff",Xe="A-Z\\xc0-\\xd6\\xd8-\\xde",et="\\ufe0e\\ufe0f",tt="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",rt="['’]",nt="["+Ye+"]",it="["+tt+"]",st="["+Je+"]",ot="\\d+",at="["+Qe+"]",ct="["+Ze+"]",ut="[^"+Ye+tt+ot+Qe+Ze+Xe+"]",ht="\\ud83c[\\udffb-\\udfff]",lt="[^"+Ye+"]",pt="(?:\\ud83c[\\udde6-\\uddff]){2}",ft="[\\ud800-\\udbff][\\udc00-\\udfff]",dt="["+Xe+"]",gt="\\u200d",yt="(?:"+ct+"|"+ut+")",vt="(?:"+dt+"|"+ut+")",mt="(?:['’](?:d|ll|m|re|s|t|ve))?",_t="(?:['’](?:D|LL|M|RE|S|T|VE))?",wt="(?:"+st+"|"+ht+")?",bt="["+et+"]?",Et=bt+wt+"(?:"+gt+"(?:"+[lt,pt,ft].join("|")+")"+bt+wt+")*",It="(?:"+[at,pt,ft].join("|")+")"+Et,St="(?:"+[lt+st+"?",st,pt,ft,nt].join("|")+")",Pt=RegExp(rt,"g"),Ot=RegExp(st,"g"),xt=RegExp(ht+"(?="+ht+")|"+St+Et,"g"),Ct=RegExp([dt+"?"+ct+"+"+mt+"(?="+[it,dt,"$"].join("|")+")",vt+"+"+_t+"(?="+[it,dt+yt,"$"].join("|")+")",dt+"?"+yt+"+"+mt,dt+"+"+_t,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ot,It].join("|"),"g"),Rt=RegExp("["+gt+Ye+Je+et+"]"),At=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Tt=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],jt=-1,Nt={};Nt[ae]=Nt[ce]=Nt[ue]=Nt[he]=Nt[le]=Nt[pe]=Nt[fe]=Nt[de]=Nt[ge]=!0,Nt[D]=Nt[k]=Nt[se]=Nt[U]=Nt[oe]=Nt[$]=Nt[H]=Nt[K]=Nt[B]=Nt[F]=Nt[Y]=Nt[Z]=Nt[X]=Nt[ee]=Nt[ne]=!1;var Lt={};Lt[D]=Lt[k]=Lt[se]=Lt[oe]=Lt[U]=Lt[$]=Lt[ae]=Lt[ce]=Lt[ue]=Lt[he]=Lt[le]=Lt[B]=Lt[F]=Lt[Y]=Lt[Z]=Lt[X]=Lt[ee]=Lt[te]=Lt[pe]=Lt[fe]=Lt[de]=Lt[ge]=!0,Lt[H]=Lt[K]=Lt[ne]=!1;var zt={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Mt=parseFloat,Dt=parseInt,kt="object"==typeof mo&&mo&&mo.Object===Object&&mo,qt="object"==typeof self&&self&&self.Object===Object&&self,Ut=kt||qt||Function("return this")(),$t=vo&&!vo.nodeType&&vo,Vt=$t&&yo&&!yo.nodeType&&yo,Ht=Vt&&Vt.exports===$t,Kt=Ht&&kt.process,Gt=function(){try{return Vt&&Vt.require&&Vt.require("util").types||Kt&&Kt.binding&&Kt.binding("util")}catch{}}(),Bt=Gt&&Gt.isArrayBuffer,Ft=Gt&&Gt.isDate,Wt=Gt&&Gt.isMap,Yt=Gt&&Gt.isRegExp,Jt=Gt&&Gt.isSet,Qt=Gt&&Gt.isTypedArray;function Zt(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function Xt(e,t,r,n){for(var i=-1,s=null==e?0:e.length;++i<s;){var o=e[i];t(n,o,r(o),e)}return n}function er(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}function tr(e,t){for(var r=null==e?0:e.length;r--&&!1!==t(e[r],r,e););return e}function rr(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}function nr(e,t){for(var r=-1,n=null==e?0:e.length,i=0,s=[];++r<n;){var o=e[r];t(o,r,e)&&(s[i++]=o)}return s}function ir(e,t){return!(null==e||!e.length)&&dr(e,t,0)>-1}function sr(e,t,r){for(var n=-1,i=null==e?0:e.length;++n<i;)if(r(t,e[n]))return!0;return!1}function or(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}function ar(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}function cr(e,t,r,n){var i=-1,s=null==e?0:e.length;for(n&&s&&(r=e[++i]);++i<s;)r=t(r,e[i],i,e);return r}function ur(e,t,r,n){var i=null==e?0:e.length;for(n&&i&&(r=e[--i]);i--;)r=t(r,e[i],i,e);return r}function hr(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var lr=mr("length");function pr(e,t,r){var n;return r(e,(function(e,r,i){if(t(e,r,i))return n=r,!1})),n}function fr(e,t,r,n){for(var i=e.length,s=r+(n?1:-1);n?s--:++s<i;)if(t(e[s],s,e))return s;return-1}function dr(e,t,r){return t==t?function(e,t,r){for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1}(e,t,r):fr(e,yr,r)}function gr(e,t,r,n){for(var i=r-1,s=e.length;++i<s;)if(n(e[i],t))return i;return-1}function yr(e){return e!=e}function vr(e,t){var r=null==e?0:e.length;return r?br(e,t)/r:j}function mr(t){return function(r){return null==r?e:r[t]}}function _r(t){return function(r){return null==t?e:t[r]}}function wr(e,t,r,n,i){return i(e,(function(e,i,s){r=n?(n=!1,e):t(r,e,i,s)})),r}function br(t,r){for(var n,i=-1,s=t.length;++i<s;){var o=r(t[i]);o!==e&&(n=n===e?o:n+o)}return n}function Er(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function Ir(e){return e&&e.slice(0,qr(e)+1).replace(Te,"")}function Sr(e){return function(t){return e(t)}}function Pr(e,t){return or(t,(function(t){return e[t]}))}function Or(e,t){return e.has(t)}function xr(e,t){for(var r=-1,n=e.length;++r<n&&dr(t,e[r],0)>-1;);return r}function Cr(e,t){for(var r=e.length;r--&&dr(t,e[r],0)>-1;);return r}var Rr=_r({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),Ar=_r({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function Tr(e){return"\\"+zt[e]}function jr(e){return Rt.test(e)}function Nr(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function Lr(e,t){return function(r){return e(t(r))}}function zr(e,t){for(var r=-1,n=e.length,i=0,s=[];++r<n;){var o=e[r];(o===t||o===a)&&(e[r]=a,s[i++]=r)}return s}function Mr(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}function Dr(e){return jr(e)?function(e){for(var t=xt.lastIndex=0;xt.test(e);)++t;return t}(e):lr(e)}function kr(e){return jr(e)?function(e){return e.match(xt)||[]}(e):function(e){return e.split("")}(e)}function qr(e){for(var t=e.length;t--&&je.test(e.charAt(t)););return t}var Ur=_r({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),$r=function je(Ye){var Je,Qe=(Ye=null==Ye?Ut:$r.defaults(Ut.Object(),Ye,$r.pick(Ut,Tt))).Array,Ze=Ye.Date,Xe=Ye.Error,et=Ye.Function,tt=Ye.Math,rt=Ye.Object,nt=Ye.RegExp,it=Ye.String,st=Ye.TypeError,ot=Qe.prototype,at=et.prototype,ct=rt.prototype,ut=Ye["__core-js_shared__"],ht=at.toString,lt=ct.hasOwnProperty,pt=0,ft=(Je=/[^.]+$/.exec(ut&&ut.keys&&ut.keys.IE_PROTO||""))?"Symbol(src)_1."+Je:"",dt=ct.toString,gt=ht.call(rt),yt=Ut._,vt=nt("^"+ht.call(lt).replace(Re,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),mt=Ht?Ye.Buffer:e,_t=Ye.Symbol,wt=Ye.Uint8Array,bt=mt?mt.allocUnsafe:e,Et=Lr(rt.getPrototypeOf,rt),It=rt.create,St=ct.propertyIsEnumerable,xt=ot.splice,Rt=_t?_t.isConcatSpreadable:e,zt=_t?_t.iterator:e,kt=_t?_t.toStringTag:e,qt=function(){try{var e=Us(rt,"defineProperty");return e({},"",{}),e}catch{}}(),$t=Ye.clearTimeout!==Ut.clearTimeout&&Ye.clearTimeout,Vt=Ze&&Ze.now!==Ut.Date.now&&Ze.now,Kt=Ye.setTimeout!==Ut.setTimeout&&Ye.setTimeout,Gt=tt.ceil,lr=tt.floor,_r=rt.getOwnPropertySymbols,Vr=mt?mt.isBuffer:e,Hr=Ye.isFinite,Kr=ot.join,Gr=Lr(rt.keys,rt),Br=tt.max,Fr=tt.min,Wr=Ze.now,Yr=Ye.parseInt,Jr=tt.random,Qr=ot.reverse,Zr=Us(Ye,"DataView"),Xr=Us(Ye,"Map"),en=Us(Ye,"Promise"),tn=Us(Ye,"Set"),rn=Us(Ye,"WeakMap"),nn=Us(rt,"create"),sn=rn&&new rn,on={},an=po(Zr),cn=po(Xr),un=po(en),hn=po(tn),ln=po(rn),pn=_t?_t.prototype:e,fn=pn?pn.valueOf:e,dn=pn?pn.toString:e;function gn(e){if(Aa(e)&&!_a(e)&&!(e instanceof _n)){if(e instanceof mn)return e;if(lt.call(e,"__wrapped__"))return fo(e)}return new mn(e)}var yn=function(){function t(){}return function(r){if(!Ra(r))return{};if(It)return It(r);t.prototype=r;var n=new t;return t.prototype=e,n}}();function vn(){}function mn(t,r){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!r,this.__index__=0,this.__values__=e}function _n(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=N,this.__views__=[]}function wn(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function bn(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function En(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function In(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new En;++t<r;)this.add(e[t])}function Sn(e){var t=this.__data__=new bn(e);this.size=t.size}function Pn(e,t){var r=_a(e),n=!r&&ma(e),i=!r&&!n&&Ia(e),s=!r&&!n&&!i&&ka(e),o=r||n||i||s,a=o?Er(e.length,it):[],c=a.length;for(var u in e)(t||lt.call(e,u))&&(!o||!("length"==u||i&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Fs(u,c)))&&a.push(u);return a}function On(t){var r=t.length;return r?t[Ii(0,r-1)]:e}function xn(e,t){return uo(is(e),Mn(t,0,e.length))}function Cn(e){return uo(is(e))}function Rn(t,r,n){(n!==e&&!ga(t[r],n)||n===e&&!(r in t))&&Ln(t,r,n)}function An(t,r,n){var i=t[r];(!lt.call(t,r)||!ga(i,n)||n===e&&!(r in t))&&Ln(t,r,n)}function Tn(e,t){for(var r=e.length;r--;)if(ga(e[r][0],t))return r;return-1}function jn(e,t,r,n){return $n(e,(function(e,i,s){t(n,e,r(e),s)})),n}function Nn(e,t){return e&&ss(t,oc(t),e)}function Ln(e,t,r){"__proto__"==t&&qt?qt(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function zn(t,r){for(var n=-1,i=r.length,s=Qe(i),o=null==t;++n<i;)s[n]=o?e:tc(t,r[n]);return s}function Mn(t,r,n){return t==t&&(n!==e&&(t=t<=n?t:n),r!==e&&(t=t>=r?t:r)),t}function Dn(t,r,n,i,s,o){var a,l=r&c,p=r&u,f=r&h;if(n&&(a=s?n(t,i,s,o):n(t)),a!==e)return a;if(!Ra(t))return t;var d=_a(t);if(d){if(a=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&lt.call(e,"index")&&(r.index=e.index,r.input=e.input),r}(t),!l)return is(t,a)}else{var g=Hs(t),y=g==K||g==G;if(Ia(t))return Zi(t,l);if(g==Y||g==D||y&&!s){if(a=p||y?{}:Gs(t),!l)return p?function(e,t){return ss(e,Vs(e),t)}(t,function(e,t){return e&&ss(t,ac(t),e)}(a,t)):function(e,t){return ss(e,$s(e),t)}(t,Nn(a,t))}else{if(!Lt[g])return s?t:{};a=function(e,t,r){var n=e.constructor;switch(t){case se:return Xi(e);case U:case $:return new n(+e);case oe:return function(e,t){var r=t?Xi(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,r);case ae:case ce:case ue:case he:case le:case pe:case fe:case de:case ge:return es(e,r);case B:return new n;case F:case ee:return new n(e);case Z:return function(e){var t=new e.constructor(e.source,Ue.exec(e));return t.lastIndex=e.lastIndex,t}(e);case X:return new n;case te:return function(e){return fn?rt(fn.call(e)):{}}(e)}}(t,g,l)}}o||(o=new Sn);var v=o.get(t);if(v)return v;o.set(t,a),za(t)?t.forEach((function(e){a.add(Dn(e,r,n,e,t,o))})):Ta(t)&&t.forEach((function(e,i){a.set(i,Dn(e,r,n,i,t,o))}));var m=d?e:(f?p?Ns:js:p?ac:oc)(t);return er(m||t,(function(e,i){m&&(e=t[i=e]),An(a,i,Dn(e,r,n,i,t,o))})),a}function kn(t,r,n){var i=n.length;if(null==t)return!i;for(t=rt(t);i--;){var s=n[i],o=r[s],a=t[s];if(a===e&&!(s in t)||!o(a))return!1}return!0}function qn(t,r,i){if("function"!=typeof t)throw new st(n);return so((function(){t.apply(e,i)}),r)}function Un(e,r,n,i){var s=-1,o=ir,a=!0,c=e.length,u=[],h=r.length;if(!c)return u;n&&(r=or(r,Sr(n))),i?(o=sr,a=!1):r.length>=t&&(o=Or,a=!1,r=new In(r));e:for(;++s<c;){var l=e[s],p=null==n?l:n(l);if(l=i||0!==l?l:0,a&&p==p){for(var f=h;f--;)if(r[f]===p)continue e;u.push(l)}else o(r,p,i)||u.push(l)}return u}gn.templateSettings={escape:Ie,evaluate:Se,interpolate:Pe,variable:"",imports:{_:gn}},gn.prototype=vn.prototype,gn.prototype.constructor=gn,mn.prototype=yn(vn.prototype),mn.prototype.constructor=mn,_n.prototype=yn(vn.prototype),_n.prototype.constructor=_n,wn.prototype.clear=function(){this.__data__=nn?nn(null):{},this.size=0},wn.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},wn.prototype.get=function(t){var r=this.__data__;if(nn){var n=r[t];return n===s?e:n}return lt.call(r,t)?r[t]:e},wn.prototype.has=function(t){var r=this.__data__;return nn?r[t]!==e:lt.call(r,t)},wn.prototype.set=function(t,r){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=nn&&r===e?s:r,this},bn.prototype.clear=function(){this.__data__=[],this.size=0},bn.prototype.delete=function(e){var t=this.__data__,r=Tn(t,e);return!(r<0||(r==t.length-1?t.pop():xt.call(t,r,1),--this.size,0))},bn.prototype.get=function(t){var r=this.__data__,n=Tn(r,t);return n<0?e:r[n][1]},bn.prototype.has=function(e){return Tn(this.__data__,e)>-1},bn.prototype.set=function(e,t){var r=this.__data__,n=Tn(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this},En.prototype.clear=function(){this.size=0,this.__data__={hash:new wn,map:new(Xr||bn),string:new wn}},En.prototype.delete=function(e){var t=ks(this,e).delete(e);return this.size-=t?1:0,t},En.prototype.get=function(e){return ks(this,e).get(e)},En.prototype.has=function(e){return ks(this,e).has(e)},En.prototype.set=function(e,t){var r=ks(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this},In.prototype.add=In.prototype.push=function(e){return this.__data__.set(e,s),this},In.prototype.has=function(e){return this.__data__.has(e)},Sn.prototype.clear=function(){this.__data__=new bn,this.size=0},Sn.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},Sn.prototype.get=function(e){return this.__data__.get(e)},Sn.prototype.has=function(e){return this.__data__.has(e)},Sn.prototype.set=function(e,r){var n=this.__data__;if(n instanceof bn){var i=n.__data__;if(!Xr||i.length<t-1)return i.push([e,r]),this.size=++n.size,this;n=this.__data__=new En(i)}return n.set(e,r),this.size=n.size,this};var $n=cs(Yn),Vn=cs(Jn,!0);function Hn(e,t){var r=!0;return $n(e,(function(e,n,i){return r=!!t(e,n,i)})),r}function Kn(t,r,n){for(var i=-1,s=t.length;++i<s;){var o=t[i],a=r(o);if(null!=a&&(c===e?a==a&&!Da(a):n(a,c)))var c=a,u=o}return u}function Gn(e,t){var r=[];return $n(e,(function(e,n,i){t(e,n,i)&&r.push(e)})),r}function Bn(e,t,r,n,i){var s=-1,o=e.length;for(r||(r=Bs),i||(i=[]);++s<o;){var a=e[s];t>0&&r(a)?t>1?Bn(a,t-1,r,n,i):ar(i,a):n||(i[i.length]=a)}return i}var Fn=us(),Wn=us(!0);function Yn(e,t){return e&&Fn(e,t,oc)}function Jn(e,t){return e&&Wn(e,t,oc)}function Qn(e,t){return nr(t,(function(t){return Oa(e[t])}))}function Zn(t,r){for(var n=0,i=(r=Wi(r,t)).length;null!=t&&n<i;)t=t[lo(r[n++])];return n&&n==i?t:e}function Xn(e,t,r){var n=t(e);return _a(e)?n:ar(n,r(e))}function ei(t){return null==t?t===e?re:W:kt&&kt in rt(t)?function(t){var r=lt.call(t,kt),n=t[kt];try{t[kt]=e;var i=!0}catch{}var s=dt.call(t);return i&&(r?t[kt]=n:delete t[kt]),s}(t):function(e){return dt.call(e)}(t)}function ti(e,t){return e>t}function ri(e,t){return null!=e&&lt.call(e,t)}function ni(e,t){return null!=e&&t in rt(e)}function ii(t,r,n){for(var i=n?sr:ir,s=t[0].length,o=t.length,a=o,c=Qe(o),u=1/0,h=[];a--;){var l=t[a];a&&r&&(l=or(l,Sr(r))),u=Fr(l.length,u),c[a]=!n&&(r||s>=120&&l.length>=120)?new In(a&&l):e}l=t[0];var p=-1,f=c[0];e:for(;++p<s&&h.length<u;){var d=l[p],g=r?r(d):d;if(d=n||0!==d?d:0,!(f?Or(f,g):i(h,g,n))){for(a=o;--a;){var y=c[a];if(!(y?Or(y,g):i(t[a],g,n)))continue e}f&&f.push(g),h.push(d)}}return h}function si(t,r,n){var i=null==(t=ro(t,r=Wi(r,t)))?t:t[lo(Po(r))];return null==i?e:Zt(i,t,n)}function oi(e){return Aa(e)&&ei(e)==D}function ai(t,r,n,i,s){return t===r||(null==t||null==r||!Aa(t)&&!Aa(r)?t!=t&&r!=r:function(t,r,n,i,s,o){var a=_a(t),c=_a(r),u=a?k:Hs(t),h=c?k:Hs(r),f=(u=u==D?Y:u)==Y,d=(h=h==D?Y:h)==Y,g=u==h;if(g&&Ia(t)){if(!Ia(r))return!1;a=!0,f=!1}if(g&&!f)return o||(o=new Sn),a||ka(t)?As(t,r,n,i,s,o):function(e,t,r,n,i,s,o){switch(r){case oe:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case se:return!(e.byteLength!=t.byteLength||!s(new wt(e),new wt(t)));case U:case $:case F:return ga(+e,+t);case H:return e.name==t.name&&e.message==t.message;case Z:case ee:return e==t+"";case B:var a=Nr;case X:var c=n&l;if(a||(a=Mr),e.size!=t.size&&!c)return!1;var u=o.get(e);if(u)return u==t;n|=p,o.set(e,t);var h=As(a(e),a(t),n,i,s,o);return o.delete(e),h;case te:if(fn)return fn.call(e)==fn.call(t)}return!1}(t,r,u,n,i,s,o);if(!(n&l)){var y=f&&lt.call(t,"__wrapped__"),v=d&&lt.call(r,"__wrapped__");if(y||v){var m=y?t.value():t,_=v?r.value():r;return o||(o=new Sn),s(m,_,n,i,o)}}return!!g&&(o||(o=new Sn),function(t,r,n,i,s,o){var a=n&l,c=js(t),u=c.length,h=js(r),p=h.length;if(u!=p&&!a)return!1;for(var f=u;f--;){var d=c[f];if(!(a?d in r:lt.call(r,d)))return!1}var g=o.get(t),y=o.get(r);if(g&&y)return g==r&&y==t;var v=!0;o.set(t,r),o.set(r,t);for(var m=a;++f<u;){var _=t[d=c[f]],w=r[d];if(i)var b=a?i(w,_,d,r,t,o):i(_,w,d,t,r,o);if(!(b===e?_===w||s(_,w,n,i,o):b)){v=!1;break}m||(m="constructor"==d)}if(v&&!m){var E=t.constructor,I=r.constructor;E!=I&&"constructor"in t&&"constructor"in r&&!("function"==typeof E&&E instanceof E&&"function"==typeof I&&I instanceof I)&&(v=!1)}return o.delete(t),o.delete(r),v}(t,r,n,i,s,o))}(t,r,n,i,ai,s))}function ci(t,r,n,i){var s=n.length,o=s,a=!i;if(null==t)return!o;for(t=rt(t);s--;){var c=n[s];if(a&&c[2]?c[1]!==t[c[0]]:!(c[0]in t))return!1}for(;++s<o;){var u=(c=n[s])[0],h=t[u],f=c[1];if(a&&c[2]){if(h===e&&!(u in t))return!1}else{var d=new Sn;if(i)var g=i(h,f,u,t,r,d);if(!(g===e?ai(f,h,l|p,i,d):g))return!1}}return!0}function ui(e){return!(!Ra(e)||function(e){return!!ft&&ft in e}(e))&&(Oa(e)?vt:He).test(po(e))}function hi(e){return"function"==typeof e?e:null==e?jc:"object"==typeof e?_a(e)?yi(e[0],e[1]):gi(e):$c(e)}function li(e){if(!Zs(e))return Gr(e);var t=[];for(var r in rt(e))lt.call(e,r)&&"constructor"!=r&&t.push(r);return t}function pi(e){if(!Ra(e))return function(e){var t=[];if(null!=e)for(var r in rt(e))t.push(r);return t}(e);var t=Zs(e),r=[];for(var n in e)"constructor"==n&&(t||!lt.call(e,n))||r.push(n);return r}function fi(e,t){return e<t}function di(e,t){var r=-1,n=ba(e)?Qe(e.length):[];return $n(e,(function(e,i,s){n[++r]=t(e,i,s)})),n}function gi(e){var t=qs(e);return 1==t.length&&t[0][2]?eo(t[0][0],t[0][1]):function(r){return r===e||ci(r,e,t)}}function yi(t,r){return Ys(t)&&Xs(r)?eo(lo(t),r):function(n){var i=tc(n,t);return i===e&&i===r?rc(n,t):ai(r,i,l|p)}}function vi(t,r,n,i,s){t!==r&&Fn(r,(function(o,a){if(s||(s=new Sn),Ra(o))!function(t,r,n,i,s,o,a){var c=no(t,n),u=no(r,n),h=a.get(u);if(h)Rn(t,n,h);else{var l=o?o(c,u,n+"",t,r,a):e,p=l===e;if(p){var f=_a(u),d=!f&&Ia(u),g=!f&&!d&&ka(u);l=u,f||d||g?_a(c)?l=c:Ea(c)?l=is(c):d?(p=!1,l=Zi(u,!0)):g?(p=!1,l=es(u,!0)):l=[]:Na(u)||ma(u)?(l=c,ma(c)?l=Ba(c):(!Ra(c)||Oa(c))&&(l=Gs(u))):p=!1}p&&(a.set(u,l),s(l,u,i,o,a),a.delete(u)),Rn(t,n,l)}}(t,r,a,n,vi,i,s);else{var c=i?i(no(t,a),o,a+"",t,r,s):e;c===e&&(c=o),Rn(t,a,c)}}),ac)}function mi(t,r){var n=t.length;if(n)return Fs(r+=r<0?n:0,n)?t[r]:e}function _i(e,t,r){t=t.length?or(t,(function(e){return _a(e)?function(t){return Zn(t,1===e.length?e[0]:e)}:e})):[jc];var n=-1;return t=or(t,Sr(Ds())),function(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}(di(e,(function(e,r,i){return{criteria:or(t,(function(t){return t(e)})),index:++n,value:e}})),(function(e,t){return function(e,t,r){for(var n=-1,i=e.criteria,s=t.criteria,o=i.length,a=r.length;++n<o;){var c=ts(i[n],s[n]);if(c)return n>=a?c:c*("desc"==r[n]?-1:1)}return e.index-t.index}(e,t,r)}))}function wi(e,t,r){for(var n=-1,i=t.length,s={};++n<i;){var o=t[n],a=Zn(e,o);r(a,o)&&Ci(s,Wi(o,e),a)}return s}function bi(e,t,r,n){var i=n?gr:dr,s=-1,o=t.length,a=e;for(e===t&&(t=is(t)),r&&(a=or(e,Sr(r)));++s<o;)for(var c=0,u=t[s],h=r?r(u):u;(c=i(a,h,c,n))>-1;)a!==e&&xt.call(a,c,1),xt.call(e,c,1);return e}function Ei(e,t){for(var r=e?t.length:0,n=r-1;r--;){var i=t[r];if(r==n||i!==s){var s=i;Fs(i)?xt.call(e,i,1):Ui(e,i)}}return e}function Ii(e,t){return e+lr(Jr()*(t-e+1))}function Si(e,t){var r="";if(!e||t<1||t>A)return r;do{t%2&&(r+=e),(t=lr(t/2))&&(e+=e)}while(t);return r}function Pi(e,t){return oo(to(e,t,jc),e+"")}function Oi(e){return On(gc(e))}function xi(e,t){var r=gc(e);return uo(r,Mn(t,0,r.length))}function Ci(t,r,n,i){if(!Ra(t))return t;for(var s=-1,o=(r=Wi(r,t)).length,a=o-1,c=t;null!=c&&++s<o;){var u=lo(r[s]),h=n;if("__proto__"===u||"constructor"===u||"prototype"===u)return t;if(s!=a){var l=c[u];(h=i?i(l,u,c):e)===e&&(h=Ra(l)?l:Fs(r[s+1])?[]:{})}An(c,u,h),c=c[u]}return t}var Ri=sn?function(e,t){return sn.set(e,t),e}:jc,Ai=qt?function(e,t){return qt(e,"toString",{configurable:!0,enumerable:!1,value:Rc(t),writable:!0})}:jc;function Ti(e){return uo(gc(e))}function ji(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(r=r>i?i:r)<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var s=Qe(i);++n<i;)s[n]=e[n+t];return s}function Ni(e,t){var r;return $n(e,(function(e,n,i){return!(r=t(e,n,i))})),!!r}function Li(e,t,r){var n=0,i=null==e?n:e.length;if("number"==typeof t&&t==t&&i<=z){for(;n<i;){var s=n+i>>>1,o=e[s];null!==o&&!Da(o)&&(r?o<=t:o<t)?n=s+1:i=s}return i}return zi(e,t,jc,r)}function zi(t,r,n,i){var s=0,o=null==t?0:t.length;if(0===o)return 0;for(var a=(r=n(r))!=r,c=null===r,u=Da(r),h=r===e;s<o;){var l=lr((s+o)/2),p=n(t[l]),f=p!==e,d=null===p,g=p==p,y=Da(p);if(a)var v=i||g;else v=h?g&&(i||f):c?g&&f&&(i||!d):u?g&&f&&!d&&(i||!y):!d&&!y&&(i?p<=r:p<r);v?s=l+1:o=l}return Fr(o,L)}function Mi(e,t){for(var r=-1,n=e.length,i=0,s=[];++r<n;){var o=e[r],a=t?t(o):o;if(!r||!ga(a,c)){var c=a;s[i++]=0===o?0:o}}return s}function Di(e){return"number"==typeof e?e:Da(e)?j:+e}function ki(e){if("string"==typeof e)return e;if(_a(e))return or(e,ki)+"";if(Da(e))return dn?dn.call(e):"";var t=e+"";return"0"==t&&1/e==-R?"-0":t}function qi(e,r,n){var i=-1,s=ir,o=e.length,a=!0,c=[],u=c;if(n)a=!1,s=sr;else if(o>=t){var h=r?null:Ss(e);if(h)return Mr(h);a=!1,s=Or,u=new In}else u=r?[]:c;e:for(;++i<o;){var l=e[i],p=r?r(l):l;if(l=n||0!==l?l:0,a&&p==p){for(var f=u.length;f--;)if(u[f]===p)continue e;r&&u.push(p),c.push(l)}else s(u,p,n)||(u!==c&&u.push(p),c.push(l))}return c}function Ui(e,t){return null==(e=ro(e,t=Wi(t,e)))||delete e[lo(Po(t))]}function $i(e,t,r,n){return Ci(e,t,r(Zn(e,t)),n)}function Vi(e,t,r,n){for(var i=e.length,s=n?i:-1;(n?s--:++s<i)&&t(e[s],s,e););return r?ji(e,n?0:s,n?s+1:i):ji(e,n?s+1:0,n?i:s)}function Hi(e,t){var r=e;return r instanceof _n&&(r=r.value()),cr(t,(function(e,t){return t.func.apply(t.thisArg,ar([e],t.args))}),r)}function Ki(e,t,r){var n=e.length;if(n<2)return n?qi(e[0]):[];for(var i=-1,s=Qe(n);++i<n;)for(var o=e[i],a=-1;++a<n;)a!=i&&(s[i]=Un(s[i]||o,e[a],t,r));return qi(Bn(s,1),t,r)}function Gi(t,r,n){for(var i=-1,s=t.length,o=r.length,a={};++i<s;){var c=i<o?r[i]:e;n(a,t[i],c)}return a}function Bi(e){return Ea(e)?e:[]}function Fi(e){return"function"==typeof e?e:jc}function Wi(e,t){return _a(e)?e:Ys(e,t)?[e]:ho(Fa(e))}var Yi=Pi;function Ji(t,r,n){var i=t.length;return n=n===e?i:n,!r&&n>=i?t:ji(t,r,n)}var Qi=$t||function(e){return Ut.clearTimeout(e)};function Zi(e,t){if(t)return e.slice();var r=e.length,n=bt?bt(r):new e.constructor(r);return e.copy(n),n}function Xi(e){var t=new e.constructor(e.byteLength);return new wt(t).set(new wt(e)),t}function es(e,t){var r=t?Xi(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}function ts(t,r){if(t!==r){var n=t!==e,i=null===t,s=t==t,o=Da(t),a=r!==e,c=null===r,u=r==r,h=Da(r);if(!c&&!h&&!o&&t>r||o&&a&&u&&!c&&!h||i&&a&&u||!n&&u||!s)return 1;if(!i&&!o&&!h&&t<r||h&&n&&s&&!i&&!o||c&&n&&s||!a&&s||!u)return-1}return 0}function rs(e,t,r,n){for(var i=-1,s=e.length,o=r.length,a=-1,c=t.length,u=Br(s-o,0),h=Qe(c+u),l=!n;++a<c;)h[a]=t[a];for(;++i<o;)(l||i<s)&&(h[r[i]]=e[i]);for(;u--;)h[a++]=e[i++];return h}function ns(e,t,r,n){for(var i=-1,s=e.length,o=-1,a=r.length,c=-1,u=t.length,h=Br(s-a,0),l=Qe(h+u),p=!n;++i<h;)l[i]=e[i];for(var f=i;++c<u;)l[f+c]=t[c];for(;++o<a;)(p||i<s)&&(l[f+r[o]]=e[i++]);return l}function is(e,t){var r=-1,n=e.length;for(t||(t=Qe(n));++r<n;)t[r]=e[r];return t}function ss(t,r,n,i){var s=!n;n||(n={});for(var o=-1,a=r.length;++o<a;){var c=r[o],u=i?i(n[c],t[c],c,n,t):e;u===e&&(u=t[c]),s?Ln(n,c,u):An(n,c,u)}return n}function os(e,t){return function(r,n){var i=_a(r)?Xt:jn,s=t?t():{};return i(r,e,Ds(n,2),s)}}function as(t){return Pi((function(r,n){var i=-1,s=n.length,o=s>1?n[s-1]:e,a=s>2?n[2]:e;for(o=t.length>3&&"function"==typeof o?(s--,o):e,a&&Ws(n[0],n[1],a)&&(o=s<3?e:o,s=1),r=rt(r);++i<s;){var c=n[i];c&&t(r,c,i,o)}return r}))}function cs(e,t){return function(r,n){if(null==r)return r;if(!ba(r))return e(r,n);for(var i=r.length,s=t?i:-1,o=rt(r);(t?s--:++s<i)&&!1!==n(o[s],s,o););return r}}function us(e){return function(t,r,n){for(var i=-1,s=rt(t),o=n(t),a=o.length;a--;){var c=o[e?a:++i];if(!1===r(s[c],c,s))break}return t}}function hs(t){return function(r){var n=jr(r=Fa(r))?kr(r):e,i=n?n[0]:r.charAt(0),s=n?Ji(n,1).join(""):r.slice(1);return i[t]()+s}}function ls(e){return function(t){return cr(Oc(mc(t).replace(Pt,"")),e,"")}}function ps(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=yn(e.prototype),n=e.apply(r,t);return Ra(n)?n:r}}function fs(t){return function(r,n,i){var s=rt(r);if(!ba(r)){var o=Ds(n,3);r=oc(r),n=function(e){return o(s[e],e,s)}}var a=t(r,n,i);return a>-1?s[o?r[a]:a]:e}}function ds(t){return Ts((function(r){var i=r.length,s=i,o=mn.prototype.thru;for(t&&r.reverse();s--;){var a=r[s];if("function"!=typeof a)throw new st(n);if(o&&!c&&"wrapper"==zs(a))var c=new mn([],!0)}for(s=c?s:i;++s<i;){var u=zs(a=r[s]),h="wrapper"==u?Ls(a):e;c=h&&Js(h[0])&&h[1]==(w|y|m|b)&&!h[4].length&&1==h[9]?c[zs(h[0])].apply(c,h[3]):1==a.length&&Js(a)?c[u]():c.thru(a)}return function(){var e=arguments,t=e[0];if(c&&1==e.length&&_a(t))return c.plant(t).value();for(var n=0,s=i?r[n].apply(this,e):t;++n<i;)s=r[n].call(this,s);return s}}))}function gs(t,r,n,i,s,o,a,c,u,h){var l=r&w,p=r&f,g=r&d,m=r&(y|v),_=r&E,b=g?e:ps(t);return function f(){for(var d=arguments.length,y=Qe(d),v=d;v--;)y[v]=arguments[v];if(m)var w=Ms(f),E=function(e,t){for(var r=e.length,n=0;r--;)e[r]===t&&++n;return n}(y,w);if(i&&(y=rs(y,i,s,m)),o&&(y=ns(y,o,a,m)),d-=E,m&&d<h){var I=zr(y,w);return Es(t,r,gs,f.placeholder,n,y,I,c,u,h-d)}var S=p?n:this,P=g?S[t]:t;return d=y.length,c?y=function(t,r){for(var n=t.length,i=Fr(r.length,n),s=is(t);i--;){var o=r[i];t[i]=Fs(o,n)?s[o]:e}return t}(y,c):_&&d>1&&y.reverse(),l&&u<d&&(y.length=u),this&&this!==Ut&&this instanceof f&&(P=b||ps(P)),P.apply(S,y)}}function ys(e,t){return function(r,n){return function(e,t,r,n){return Yn(e,(function(e,i,s){t(n,r(e),i,s)})),n}(r,e,t(n),{})}}function vs(t,r){return function(n,i){var s;if(n===e&&i===e)return r;if(n!==e&&(s=n),i!==e){if(s===e)return i;"string"==typeof n||"string"==typeof i?(n=ki(n),i=ki(i)):(n=Di(n),i=Di(i)),s=t(n,i)}return s}}function ms(e){return Ts((function(t){return t=or(t,Sr(Ds())),Pi((function(r){var n=this;return e(t,(function(e){return Zt(e,n,r)}))}))}))}function _s(t,r){var n=(r=r===e?" ":ki(r)).length;if(n<2)return n?Si(r,t):r;var i=Si(r,Gt(t/Dr(r)));return jr(r)?Ji(kr(i),0,t).join(""):i.slice(0,t)}function ws(t){return function(r,n,i){return i&&"number"!=typeof i&&Ws(r,n,i)&&(n=i=e),r=Va(r),n===e?(n=r,r=0):n=Va(n),function(e,t,r,n){for(var i=-1,s=Br(Gt((t-e)/(r||1)),0),o=Qe(s);s--;)o[n?s:++i]=e,e+=r;return o}(r,n,i=i===e?r<n?1:-1:Va(i),t)}}function bs(e){return function(t,r){return"string"==typeof t&&"string"==typeof r||(t=Ga(t),r=Ga(r)),e(t,r)}}function Es(t,r,n,i,s,o,a,c,u,h){var l=r&y;r|=l?m:_,(r&=~(l?_:m))&g||(r&=~(f|d));var p=[t,r,s,l?o:e,l?a:e,l?e:o,l?e:a,c,u,h],v=n.apply(e,p);return Js(t)&&io(v,p),v.placeholder=i,ao(v,t,r)}function Is(e){var t=tt[e];return function(e,r){if(e=Ga(e),(r=null==r?0:Fr(Ha(r),292))&&Hr(e)){var n=(Fa(e)+"e").split("e");return+((n=(Fa(t(n[0]+"e"+(+n[1]+r)))+"e").split("e"))[0]+"e"+(+n[1]-r))}return t(e)}}var Ss=tn&&1/Mr(new tn([,-0]))[1]==R?function(e){return new tn(e)}:Dc;function Ps(e){return function(t){var r=Hs(t);return r==B?Nr(t):r==X?function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=[e,e]})),r}(t):function(e,t){return or(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function Os(t,r,i,s,o,c,u,h){var l=r&d;if(!l&&"function"!=typeof t)throw new st(n);var p=s?s.length:0;if(p||(r&=~(m|_),s=o=e),u=u===e?u:Br(Ha(u),0),h=h===e?h:Ha(h),p-=o?o.length:0,r&_){var E=s,I=o;s=o=e}var S=l?e:Ls(t),P=[t,r,i,s,o,E,I,c,u,h];if(S&&function(e,t){var r=e[1],n=t[1],i=r|n,s=i<(f|d|w),o=n==w&&r==y||n==w&&r==b&&e[7].length<=t[8]||n==(w|b)&&t[7].length<=t[8]&&r==y;if(!s&&!o)return e;n&f&&(e[2]=t[2],i|=r&f?0:g);var c=t[3];if(c){var u=e[3];e[3]=u?rs(u,c,t[4]):c,e[4]=u?zr(e[3],a):t[4]}(c=t[5])&&(u=e[5],e[5]=u?ns(u,c,t[6]):c,e[6]=u?zr(e[5],a):t[6]),(c=t[7])&&(e[7]=c),n&w&&(e[8]=null==e[8]?t[8]:Fr(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=i}(P,S),t=P[0],r=P[1],i=P[2],s=P[3],o=P[4],!(h=P[9]=P[9]===e?l?0:t.length:Br(P[9]-p,0))&&r&(y|v)&&(r&=~(y|v)),r&&r!=f)O=r==y||r==v?function(t,r,n){var i=ps(t);return function s(){for(var o=arguments.length,a=Qe(o),c=o,u=Ms(s);c--;)a[c]=arguments[c];var h=o<3&&a[0]!==u&&a[o-1]!==u?[]:zr(a,u);return(o-=h.length)<n?Es(t,r,gs,s.placeholder,e,a,h,e,e,n-o):Zt(this&&this!==Ut&&this instanceof s?i:t,this,a)}}(t,r,h):r!=m&&r!=(f|m)||o.length?gs.apply(e,P):function(e,t,r,n){var i=t&f,s=ps(e);return function t(){for(var o=-1,a=arguments.length,c=-1,u=n.length,h=Qe(u+a),l=this&&this!==Ut&&this instanceof t?s:e;++c<u;)h[c]=n[c];for(;a--;)h[c++]=arguments[++o];return Zt(l,i?r:this,h)}}(t,r,i,s);else var O=function(e,t,r){var n=t&f,i=ps(e);return function t(){return(this&&this!==Ut&&this instanceof t?i:e).apply(n?r:this,arguments)}}(t,r,i);return ao((S?Ri:io)(O,P),t,r)}function xs(t,r,n,i){return t===e||ga(t,ct[n])&&!lt.call(i,n)?r:t}function Cs(t,r,n,i,s,o){return Ra(t)&&Ra(r)&&(o.set(r,t),vi(t,r,e,Cs,o),o.delete(r)),t}function Rs(t){return Na(t)?e:t}function As(t,r,n,i,s,o){var a=n&l,c=t.length,u=r.length;if(c!=u&&!(a&&u>c))return!1;var h=o.get(t),f=o.get(r);if(h&&f)return h==r&&f==t;var d=-1,g=!0,y=n&p?new In:e;for(o.set(t,r),o.set(r,t);++d<c;){var v=t[d],m=r[d];if(i)var _=a?i(m,v,d,r,t,o):i(v,m,d,t,r,o);if(_!==e){if(_)continue;g=!1;break}if(y){if(!hr(r,(function(e,t){if(!Or(y,t)&&(v===e||s(v,e,n,i,o)))return y.push(t)}))){g=!1;break}}else if(v!==m&&!s(v,m,n,i,o)){g=!1;break}}return o.delete(t),o.delete(r),g}function Ts(t){return oo(to(t,e,wo),t+"")}function js(e){return Xn(e,oc,$s)}function Ns(e){return Xn(e,ac,Vs)}var Ls=sn?function(e){return sn.get(e)}:Dc;function zs(e){for(var t=e.name+"",r=on[t],n=lt.call(on,t)?r.length:0;n--;){var i=r[n],s=i.func;if(null==s||s==e)return i.name}return t}function Ms(e){return(lt.call(gn,"placeholder")?gn:e).placeholder}function Ds(){var e=gn.iteratee||Nc;return e=e===Nc?hi:e,arguments.length?e(arguments[0],arguments[1]):e}function ks(e,t){var r=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?r["string"==typeof t?"string":"hash"]:r.map}function qs(e){for(var t=oc(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,Xs(i)]}return t}function Us(t,r){var n=function(t,r){return null==t?e:t[r]}(t,r);return ui(n)?n:e}var $s=_r?function(e){return null==e?[]:(e=rt(e),nr(_r(e),(function(t){return St.call(e,t)})))}:Kc,Vs=_r?function(e){for(var t=[];e;)ar(t,$s(e)),e=Et(e);return t}:Kc,Hs=ei;function Ks(e,t,r){for(var n=-1,i=(t=Wi(t,e)).length,s=!1;++n<i;){var o=lo(t[n]);if(!(s=null!=e&&r(e,o)))break;e=e[o]}return s||++n!=i?s:!!(i=null==e?0:e.length)&&Ca(i)&&Fs(o,i)&&(_a(e)||ma(e))}function Gs(e){return"function"!=typeof e.constructor||Zs(e)?{}:yn(Et(e))}function Bs(e){return _a(e)||ma(e)||!!(Rt&&e&&e[Rt])}function Fs(e,t){var r=typeof e;return!!(t=t??A)&&("number"==r||"symbol"!=r&&Ge.test(e))&&e>-1&&e%1==0&&e<t}function Ws(e,t,r){if(!Ra(r))return!1;var n=typeof t;return!!("number"==n?ba(r)&&Fs(t,r.length):"string"==n&&t in r)&&ga(r[t],e)}function Ys(e,t){if(_a(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!Da(e))||xe.test(e)||!Oe.test(e)||null!=t&&e in rt(t)}function Js(e){var t=zs(e),r=gn[t];if("function"!=typeof r||!(t in _n.prototype))return!1;if(e===r)return!0;var n=Ls(r);return!!n&&e===n[0]}(Zr&&Hs(new Zr(new ArrayBuffer(1)))!=oe||Xr&&Hs(new Xr)!=B||en&&Hs(en.resolve())!=J||tn&&Hs(new tn)!=X||rn&&Hs(new rn)!=ne)&&(Hs=function(t){var r=ei(t),n=r==Y?t.constructor:e,i=n?po(n):"";if(i)switch(i){case an:return oe;case cn:return B;case un:return J;case hn:return X;case ln:return ne}return r});var Qs=ut?Oa:Gc;function Zs(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||ct)}function Xs(e){return e==e&&!Ra(e)}function eo(t,r){return function(n){return null!=n&&n[t]===r&&(r!==e||t in rt(n))}}function to(t,r,n){return r=Br(r===e?t.length-1:r,0),function(){for(var e=arguments,i=-1,s=Br(e.length-r,0),o=Qe(s);++i<s;)o[i]=e[r+i];i=-1;for(var a=Qe(r+1);++i<r;)a[i]=e[i];return a[r]=n(o),Zt(t,this,a)}}function ro(e,t){return t.length<2?e:Zn(e,ji(t,0,-1))}function no(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var io=co(Ri),so=Kt||function(e,t){return Ut.setTimeout(e,t)},oo=co(Ai);function ao(e,t,r){var n=t+"";return oo(e,function(e,t){var r=t.length;if(!r)return e;var n=r-1;return t[n]=(r>1?"& ":"")+t[n],t=t.join(r>2?", ":" "),e.replace(Ne,"{\n/* [wrapped with "+t+"] */\n")}(n,function(e,t){return er(M,(function(r){var n="_."+r[0];t&r[1]&&!ir(e,n)&&e.push(n)})),e.sort()}(function(e){var t=e.match(Le);return t?t[1].split(ze):[]}(n),r)))}function co(t){var r=0,n=0;return function(){var i=Wr(),s=O-(i-n);if(n=i,s>0){if(++r>=P)return arguments[0]}else r=0;return t.apply(e,arguments)}}function uo(t,r){var n=-1,i=t.length,s=i-1;for(r=r===e?i:r;++n<r;){var o=Ii(n,s),a=t[o];t[o]=t[n],t[n]=a}return t.length=r,t}var ho=function(e){var t=ua(e,(function(e){return r.size===o&&r.clear(),e})),r=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Ce,(function(e,r,n,i){t.push(n?i.replace(ke,"$1"):r||e)})),t}));function lo(e){if("string"==typeof e||Da(e))return e;var t=e+"";return"0"==t&&1/e==-R?"-0":t}function po(e){if(null!=e){try{return ht.call(e)}catch{}try{return e+""}catch{}}return""}function fo(e){if(e instanceof _n)return e.clone();var t=new mn(e.__wrapped__,e.__chain__);return t.__actions__=is(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var go=Pi((function(e,t){return Ea(e)?Un(e,Bn(t,1,Ea,!0)):[]})),yo=Pi((function(t,r){var n=Po(r);return Ea(n)&&(n=e),Ea(t)?Un(t,Bn(r,1,Ea,!0),Ds(n,2)):[]})),vo=Pi((function(t,r){var n=Po(r);return Ea(n)&&(n=e),Ea(t)?Un(t,Bn(r,1,Ea,!0),e,n):[]}));function mo(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=null==r?0:Ha(r);return i<0&&(i=Br(n+i,0)),fr(e,Ds(t,3),i)}function _o(t,r,n){var i=null==t?0:t.length;if(!i)return-1;var s=i-1;return n!==e&&(s=Ha(n),s=n<0?Br(i+s,0):Fr(s,i-1)),fr(t,Ds(r,3),s,!0)}function wo(e){return null!=e&&e.length?Bn(e,1):[]}function bo(t){return t&&t.length?t[0]:e}var Eo=Pi((function(e){var t=or(e,Bi);return t.length&&t[0]===e[0]?ii(t):[]})),Io=Pi((function(t){var r=Po(t),n=or(t,Bi);return r===Po(n)?r=e:n.pop(),n.length&&n[0]===t[0]?ii(n,Ds(r,2)):[]})),So=Pi((function(t){var r=Po(t),n=or(t,Bi);return(r="function"==typeof r?r:e)&&n.pop(),n.length&&n[0]===t[0]?ii(n,e,r):[]}));function Po(t){var r=null==t?0:t.length;return r?t[r-1]:e}var Oo=Pi(xo);function xo(e,t){return e&&e.length&&t&&t.length?bi(e,t):e}var Co=Ts((function(e,t){var r=null==e?0:e.length,n=zn(e,t);return Ei(e,or(t,(function(e){return Fs(e,r)?+e:e})).sort(ts)),n}));function Ro(e){return null==e?e:Qr.call(e)}var Ao=Pi((function(e){return qi(Bn(e,1,Ea,!0))})),To=Pi((function(t){var r=Po(t);return Ea(r)&&(r=e),qi(Bn(t,1,Ea,!0),Ds(r,2))})),jo=Pi((function(t){var r=Po(t);return r="function"==typeof r?r:e,qi(Bn(t,1,Ea,!0),e,r)}));function No(e){if(!e||!e.length)return[];var t=0;return e=nr(e,(function(e){if(Ea(e))return t=Br(e.length,t),!0})),Er(t,(function(t){return or(e,mr(t))}))}function Lo(t,r){if(!t||!t.length)return[];var n=No(t);return null==r?n:or(n,(function(t){return Zt(r,e,t)}))}var zo=Pi((function(e,t){return Ea(e)?Un(e,t):[]})),Mo=Pi((function(e){return Ki(nr(e,Ea))})),Do=Pi((function(t){var r=Po(t);return Ea(r)&&(r=e),Ki(nr(t,Ea),Ds(r,2))})),ko=Pi((function(t){var r=Po(t);return r="function"==typeof r?r:e,Ki(nr(t,Ea),e,r)})),qo=Pi(No),Uo=Pi((function(t){var r=t.length,n=r>1?t[r-1]:e;return n="function"==typeof n?(t.pop(),n):e,Lo(t,n)}));function $o(e){var t=gn(e);return t.__chain__=!0,t}function Vo(e,t){return t(e)}var Ho=Ts((function(t){var r=t.length,n=r?t[0]:0,i=this.__wrapped__,s=function(e){return zn(e,t)};return!(r>1||this.__actions__.length)&&i instanceof _n&&Fs(n)?((i=i.slice(n,+n+(r?1:0))).__actions__.push({func:Vo,args:[s],thisArg:e}),new mn(i,this.__chain__).thru((function(t){return r&&!t.length&&t.push(e),t}))):this.thru(s)})),Ko=os((function(e,t,r){lt.call(e,r)?++e[r]:Ln(e,r,1)})),Go=fs(mo),Bo=fs(_o);function Fo(e,t){return(_a(e)?er:$n)(e,Ds(t,3))}function Wo(e,t){return(_a(e)?tr:Vn)(e,Ds(t,3))}var Yo=os((function(e,t,r){lt.call(e,r)?e[r].push(t):Ln(e,r,[t])})),Jo=Pi((function(e,t,r){var n=-1,i="function"==typeof t,s=ba(e)?Qe(e.length):[];return $n(e,(function(e){s[++n]=i?Zt(t,e,r):si(e,t,r)})),s})),Qo=os((function(e,t,r){Ln(e,r,t)}));function Zo(e,t){return(_a(e)?or:di)(e,Ds(t,3))}var Xo=os((function(e,t,r){e[r?0:1].push(t)}),(function(){return[[],[]]})),ea=Pi((function(e,t){if(null==e)return[];var r=t.length;return r>1&&Ws(e,t[0],t[1])?t=[]:r>2&&Ws(t[0],t[1],t[2])&&(t=[t[0]]),_i(e,Bn(t,1),[])})),ta=Vt||function(){return Ut.Date.now()};function ra(t,r,n){return r=n?e:r,r=t&&null==r?t.length:r,Os(t,w,e,e,e,e,r)}function na(t,r){var i;if("function"!=typeof r)throw new st(n);return t=Ha(t),function(){return--t>0&&(i=r.apply(this,arguments)),t<=1&&(r=e),i}}var ia=Pi((function(e,t,r){var n=f;if(r.length){var i=zr(r,Ms(ia));n|=m}return Os(e,n,t,r,i)})),sa=Pi((function(e,t,r){var n=f|d;if(r.length){var i=zr(r,Ms(sa));n|=m}return Os(t,n,e,r,i)}));function oa(t,r,i){var s,o,a,c,u,h,l=0,p=!1,f=!1,d=!0;if("function"!=typeof t)throw new st(n);function g(r){var n=s,i=o;return s=o=e,l=r,c=t.apply(i,n)}function y(t){var n=t-h;return h===e||n>=r||n<0||f&&t-l>=a}function v(){var e=ta();if(y(e))return m(e);u=so(v,function(e){var t=r-(e-h);return f?Fr(t,a-(e-l)):t}(e))}function m(t){return u=e,d&&s?g(t):(s=o=e,c)}function _(){var t=ta(),n=y(t);if(s=arguments,o=this,h=t,n){if(u===e)return function(e){return l=e,u=so(v,r),p?g(e):c}(h);if(f)return Qi(u),u=so(v,r),g(h)}return u===e&&(u=so(v,r)),c}return r=Ga(r)||0,Ra(i)&&(p=!!i.leading,a=(f="maxWait"in i)?Br(Ga(i.maxWait)||0,r):a,d="trailing"in i?!!i.trailing:d),_.cancel=function(){u!==e&&Qi(u),l=0,s=h=o=u=e},_.flush=function(){return u===e?c:m(ta())},_}var aa=Pi((function(e,t){return qn(e,1,t)})),ca=Pi((function(e,t,r){return qn(e,Ga(t)||0,r)}));function ua(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new st(n);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=e.apply(this,n);return r.cache=s.set(i,o)||s,o};return r.cache=new(ua.Cache||En),r}function ha(e){if("function"!=typeof e)throw new st(n);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}ua.Cache=En;var la=Yi((function(e,t){var r=(t=1==t.length&&_a(t[0])?or(t[0],Sr(Ds())):or(Bn(t,1),Sr(Ds()))).length;return Pi((function(n){for(var i=-1,s=Fr(n.length,r);++i<s;)n[i]=t[i].call(this,n[i]);return Zt(e,this,n)}))})),pa=Pi((function(t,r){var n=zr(r,Ms(pa));return Os(t,m,e,r,n)})),fa=Pi((function(t,r){var n=zr(r,Ms(fa));return Os(t,_,e,r,n)})),da=Ts((function(t,r){return Os(t,b,e,e,e,r)}));function ga(e,t){return e===t||e!=e&&t!=t}var ya=bs(ti),va=bs((function(e,t){return e>=t})),ma=oi(function(){return arguments}())?oi:function(e){return Aa(e)&&lt.call(e,"callee")&&!St.call(e,"callee")},_a=Qe.isArray,wa=Bt?Sr(Bt):function(e){return Aa(e)&&ei(e)==se};function ba(e){return null!=e&&Ca(e.length)&&!Oa(e)}function Ea(e){return Aa(e)&&ba(e)}var Ia=Vr||Gc,Sa=Ft?Sr(Ft):function(e){return Aa(e)&&ei(e)==$};function Pa(e){if(!Aa(e))return!1;var t=ei(e);return t==H||t==V||"string"==typeof e.message&&"string"==typeof e.name&&!Na(e)}function Oa(e){if(!Ra(e))return!1;var t=ei(e);return t==K||t==G||t==q||t==Q}function xa(e){return"number"==typeof e&&e==Ha(e)}function Ca(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=A}function Ra(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Aa(e){return null!=e&&"object"==typeof e}var Ta=Wt?Sr(Wt):function(e){return Aa(e)&&Hs(e)==B};function ja(e){return"number"==typeof e||Aa(e)&&ei(e)==F}function Na(e){if(!Aa(e)||ei(e)!=Y)return!1;var t=Et(e);if(null===t)return!0;var r=lt.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&ht.call(r)==gt}var La=Yt?Sr(Yt):function(e){return Aa(e)&&ei(e)==Z},za=Jt?Sr(Jt):function(e){return Aa(e)&&Hs(e)==X};function Ma(e){return"string"==typeof e||!_a(e)&&Aa(e)&&ei(e)==ee}function Da(e){return"symbol"==typeof e||Aa(e)&&ei(e)==te}var ka=Qt?Sr(Qt):function(e){return Aa(e)&&Ca(e.length)&&!!Nt[ei(e)]},qa=bs(fi),Ua=bs((function(e,t){return e<=t}));function $a(e){if(!e)return[];if(ba(e))return Ma(e)?kr(e):is(e);if(zt&&e[zt])return function(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r}(e[zt]());var t=Hs(e);return(t==B?Nr:t==X?Mr:gc)(e)}function Va(e){return e?(e=Ga(e))===R||e===-R?(e<0?-1:1)*T:e==e?e:0:0===e?e:0}function Ha(e){var t=Va(e),r=t%1;return t==t?r?t-r:t:0}function Ka(e){return e?Mn(Ha(e),0,N):0}function Ga(e){if("number"==typeof e)return e;if(Da(e))return j;if(Ra(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Ra(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Ir(e);var r=Ve.test(e);return r||Ke.test(e)?Dt(e.slice(2),r?2:8):$e.test(e)?j:+e}function Ba(e){return ss(e,ac(e))}function Fa(e){return null==e?"":ki(e)}var Wa=as((function(e,t){if(Zs(t)||ba(t))ss(t,oc(t),e);else for(var r in t)lt.call(t,r)&&An(e,r,t[r])})),Ya=as((function(e,t){ss(t,ac(t),e)})),Ja=as((function(e,t,r,n){ss(t,ac(t),e,n)})),Qa=as((function(e,t,r,n){ss(t,oc(t),e,n)})),Za=Ts(zn),Xa=Pi((function(t,r){t=rt(t);var n=-1,i=r.length,s=i>2?r[2]:e;for(s&&Ws(r[0],r[1],s)&&(i=1);++n<i;)for(var o=r[n],a=ac(o),c=-1,u=a.length;++c<u;){var h=a[c],l=t[h];(l===e||ga(l,ct[h])&&!lt.call(t,h))&&(t[h]=o[h])}return t})),ec=Pi((function(t){return t.push(e,Cs),Zt(uc,e,t)}));function tc(t,r,n){var i=null==t?e:Zn(t,r);return i===e?n:i}function rc(e,t){return null!=e&&Ks(e,t,ni)}var nc=ys((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=dt.call(t)),e[t]=r}),Rc(jc)),ic=ys((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=dt.call(t)),lt.call(e,t)?e[t].push(r):e[t]=[r]}),Ds),sc=Pi(si);function oc(e){return ba(e)?Pn(e):li(e)}function ac(e){return ba(e)?Pn(e,!0):pi(e)}var cc=as((function(e,t,r){vi(e,t,r)})),uc=as((function(e,t,r,n){vi(e,t,r,n)})),hc=Ts((function(e,t){var r={};if(null==e)return r;var n=!1;t=or(t,(function(t){return t=Wi(t,e),n||(n=t.length>1),t})),ss(e,Ns(e),r),n&&(r=Dn(r,c|u|h,Rs));for(var i=t.length;i--;)Ui(r,t[i]);return r})),lc=Ts((function(e,t){return null==e?{}:function(e,t){return wi(e,t,(function(t,r){return rc(e,r)}))}(e,t)}));function pc(e,t){if(null==e)return{};var r=or(Ns(e),(function(e){return[e]}));return t=Ds(t),wi(e,r,(function(e,r){return t(e,r[0])}))}var fc=Ps(oc),dc=Ps(ac);function gc(e){return null==e?[]:Pr(e,oc(e))}var yc=ls((function(e,t,r){return t=t.toLowerCase(),e+(r?vc(t):t)}));function vc(e){return Pc(Fa(e).toLowerCase())}function mc(e){return(e=Fa(e))&&e.replace(Be,Rr).replace(Ot,"")}var _c=ls((function(e,t,r){return e+(r?"-":"")+t.toLowerCase()})),wc=ls((function(e,t,r){return e+(r?" ":"")+t.toLowerCase()})),bc=hs("toLowerCase"),Ec=ls((function(e,t,r){return e+(r?"_":"")+t.toLowerCase()})),Ic=ls((function(e,t,r){return e+(r?" ":"")+Pc(t)})),Sc=ls((function(e,t,r){return e+(r?" ":"")+t.toUpperCase()})),Pc=hs("toUpperCase");function Oc(t,r,n){return t=Fa(t),(r=n?e:r)===e?function(e){return At.test(e)}(t)?function(e){return e.match(Ct)||[]}(t):function(e){return e.match(Me)||[]}(t):t.match(r)||[]}var xc=Pi((function(t,r){try{return Zt(t,e,r)}catch(n){return Pa(n)?n:new Xe(n)}})),Cc=Ts((function(e,t){return er(t,(function(t){t=lo(t),Ln(e,t,ia(e[t],e))})),e}));function Rc(e){return function(){return e}}var Ac=ds(),Tc=ds(!0);function jc(e){return e}function Nc(e){return hi("function"==typeof e?e:Dn(e,c))}var Lc=Pi((function(e,t){return function(r){return si(r,e,t)}})),zc=Pi((function(e,t){return function(r){return si(e,r,t)}}));function Mc(e,t,r){var n=oc(t),i=Qn(t,n);null==r&&(!Ra(t)||!i.length&&n.length)&&(r=t,t=e,e=this,i=Qn(t,oc(t)));var s=!(Ra(r)&&"chain"in r&&!r.chain),o=Oa(e);return er(i,(function(r){var n=t[r];e[r]=n,o&&(e.prototype[r]=function(){var t=this.__chain__;if(s||t){var r=e(this.__wrapped__);return(r.__actions__=is(this.__actions__)).push({func:n,args:arguments,thisArg:e}),r.__chain__=t,r}return n.apply(e,ar([this.value()],arguments))})})),e}function Dc(){}var kc=ms(or),qc=ms(rr),Uc=ms(hr);function $c(e){return Ys(e)?mr(lo(e)):function(e){return function(t){return Zn(t,e)}}(e)}var Vc=ws(),Hc=ws(!0);function Kc(){return[]}function Gc(){return!1}var Bc=vs((function(e,t){return e+t}),0),Fc=Is("ceil"),Wc=vs((function(e,t){return e/t}),1),Yc=Is("floor"),Jc=vs((function(e,t){return e*t}),1),Qc=Is("round"),Zc=vs((function(e,t){return e-t}),0);return gn.after=function(e,t){if("function"!=typeof t)throw new st(n);return e=Ha(e),function(){if(--e<1)return t.apply(this,arguments)}},gn.ary=ra,gn.assign=Wa,gn.assignIn=Ya,gn.assignInWith=Ja,gn.assignWith=Qa,gn.at=Za,gn.before=na,gn.bind=ia,gn.bindAll=Cc,gn.bindKey=sa,gn.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return _a(e)?e:[e]},gn.chain=$o,gn.chunk=function(t,r,n){r=(n?Ws(t,r,n):r===e)?1:Br(Ha(r),0);var i=null==t?0:t.length;if(!i||r<1)return[];for(var s=0,o=0,a=Qe(Gt(i/r));s<i;)a[o++]=ji(t,s,s+=r);return a},gn.compact=function(e){for(var t=-1,r=null==e?0:e.length,n=0,i=[];++t<r;){var s=e[t];s&&(i[n++]=s)}return i},gn.concat=function(){var e=arguments.length;if(!e)return[];for(var t=Qe(e-1),r=arguments[0],n=e;n--;)t[n-1]=arguments[n];return ar(_a(r)?is(r):[r],Bn(t,1))},gn.cond=function(e){var t=null==e?0:e.length,r=Ds();return e=t?or(e,(function(e){if("function"!=typeof e[1])throw new st(n);return[r(e[0]),e[1]]})):[],Pi((function(r){for(var n=-1;++n<t;){var i=e[n];if(Zt(i[0],this,r))return Zt(i[1],this,r)}}))},gn.conforms=function(e){return function(e){var t=oc(e);return function(r){return kn(r,e,t)}}(Dn(e,c))},gn.constant=Rc,gn.countBy=Ko,gn.create=function(e,t){var r=yn(e);return null==t?r:Nn(r,t)},gn.curry=function t(r,n,i){var s=Os(r,y,e,e,e,e,e,n=i?e:n);return s.placeholder=t.placeholder,s},gn.curryRight=function t(r,n,i){var s=Os(r,v,e,e,e,e,e,n=i?e:n);return s.placeholder=t.placeholder,s},gn.debounce=oa,gn.defaults=Xa,gn.defaultsDeep=ec,gn.defer=aa,gn.delay=ca,gn.difference=go,gn.differenceBy=yo,gn.differenceWith=vo,gn.drop=function(t,r,n){var i=null==t?0:t.length;return i?ji(t,(r=n||r===e?1:Ha(r))<0?0:r,i):[]},gn.dropRight=function(t,r,n){var i=null==t?0:t.length;return i?ji(t,0,(r=i-(r=n||r===e?1:Ha(r)))<0?0:r):[]},gn.dropRightWhile=function(e,t){return e&&e.length?Vi(e,Ds(t,3),!0,!0):[]},gn.dropWhile=function(e,t){return e&&e.length?Vi(e,Ds(t,3),!0):[]},gn.fill=function(t,r,n,i){var s=null==t?0:t.length;return s?(n&&"number"!=typeof n&&Ws(t,r,n)&&(n=0,i=s),function(t,r,n,i){var s=t.length;for((n=Ha(n))<0&&(n=-n>s?0:s+n),(i=i===e||i>s?s:Ha(i))<0&&(i+=s),i=n>i?0:Ka(i);n<i;)t[n++]=r;return t}(t,r,n,i)):[]},gn.filter=function(e,t){return(_a(e)?nr:Gn)(e,Ds(t,3))},gn.flatMap=function(e,t){return Bn(Zo(e,t),1)},gn.flatMapDeep=function(e,t){return Bn(Zo(e,t),R)},gn.flatMapDepth=function(t,r,n){return n=n===e?1:Ha(n),Bn(Zo(t,r),n)},gn.flatten=wo,gn.flattenDeep=function(e){return null!=e&&e.length?Bn(e,R):[]},gn.flattenDepth=function(t,r){return null!=t&&t.length?Bn(t,r=r===e?1:Ha(r)):[]},gn.flip=function(e){return Os(e,E)},gn.flow=Ac,gn.flowRight=Tc,gn.fromPairs=function(e){for(var t=-1,r=null==e?0:e.length,n={};++t<r;){var i=e[t];n[i[0]]=i[1]}return n},gn.functions=function(e){return null==e?[]:Qn(e,oc(e))},gn.functionsIn=function(e){return null==e?[]:Qn(e,ac(e))},gn.groupBy=Yo,gn.initial=function(e){return null!=e&&e.length?ji(e,0,-1):[]},gn.intersection=Eo,gn.intersectionBy=Io,gn.intersectionWith=So,gn.invert=nc,gn.invertBy=ic,gn.invokeMap=Jo,gn.iteratee=Nc,gn.keyBy=Qo,gn.keys=oc,gn.keysIn=ac,gn.map=Zo,gn.mapKeys=function(e,t){var r={};return t=Ds(t,3),Yn(e,(function(e,n,i){Ln(r,t(e,n,i),e)})),r},gn.mapValues=function(e,t){var r={};return t=Ds(t,3),Yn(e,(function(e,n,i){Ln(r,n,t(e,n,i))})),r},gn.matches=function(e){return gi(Dn(e,c))},gn.matchesProperty=function(e,t){return yi(e,Dn(t,c))},gn.memoize=ua,gn.merge=cc,gn.mergeWith=uc,gn.method=Lc,gn.methodOf=zc,gn.mixin=Mc,gn.negate=ha,gn.nthArg=function(e){return e=Ha(e),Pi((function(t){return mi(t,e)}))},gn.omit=hc,gn.omitBy=function(e,t){return pc(e,ha(Ds(t)))},gn.once=function(e){return na(2,e)},gn.orderBy=function(t,r,n,i){return null==t?[]:(_a(r)||(r=null==r?[]:[r]),_a(n=i?e:n)||(n=null==n?[]:[n]),_i(t,r,n))},gn.over=kc,gn.overArgs=la,gn.overEvery=qc,gn.overSome=Uc,gn.partial=pa,gn.partialRight=fa,gn.partition=Xo,gn.pick=lc,gn.pickBy=pc,gn.property=$c,gn.propertyOf=function(t){return function(r){return null==t?e:Zn(t,r)}},gn.pull=Oo,gn.pullAll=xo,gn.pullAllBy=function(e,t,r){return e&&e.length&&t&&t.length?bi(e,t,Ds(r,2)):e},gn.pullAllWith=function(t,r,n){return t&&t.length&&r&&r.length?bi(t,r,e,n):t},gn.pullAt=Co,gn.range=Vc,gn.rangeRight=Hc,gn.rearg=da,gn.reject=function(e,t){return(_a(e)?nr:Gn)(e,ha(Ds(t,3)))},gn.remove=function(e,t){var r=[];if(!e||!e.length)return r;var n=-1,i=[],s=e.length;for(t=Ds(t,3);++n<s;){var o=e[n];t(o,n,e)&&(r.push(o),i.push(n))}return Ei(e,i),r},gn.rest=function(t,r){if("function"!=typeof t)throw new st(n);return Pi(t,r=r===e?r:Ha(r))},gn.reverse=Ro,gn.sampleSize=function(t,r,n){return r=(n?Ws(t,r,n):r===e)?1:Ha(r),(_a(t)?xn:xi)(t,r)},gn.set=function(e,t,r){return null==e?e:Ci(e,t,r)},gn.setWith=function(t,r,n,i){return i="function"==typeof i?i:e,null==t?t:Ci(t,r,n,i)},gn.shuffle=function(e){return(_a(e)?Cn:Ti)(e)},gn.slice=function(t,r,n){var i=null==t?0:t.length;return i?(n&&"number"!=typeof n&&Ws(t,r,n)?(r=0,n=i):(r=null==r?0:Ha(r),n=n===e?i:Ha(n)),ji(t,r,n)):[]},gn.sortBy=ea,gn.sortedUniq=function(e){return e&&e.length?Mi(e):[]},gn.sortedUniqBy=function(e,t){return e&&e.length?Mi(e,Ds(t,2)):[]},gn.split=function(t,r,n){return n&&"number"!=typeof n&&Ws(t,r,n)&&(r=n=e),(n=n===e?N:n>>>0)?(t=Fa(t))&&("string"==typeof r||null!=r&&!La(r))&&!(r=ki(r))&&jr(t)?Ji(kr(t),0,n):t.split(r,n):[]},gn.spread=function(e,t){if("function"!=typeof e)throw new st(n);return t=null==t?0:Br(Ha(t),0),Pi((function(r){var n=r[t],i=Ji(r,0,t);return n&&ar(i,n),Zt(e,this,i)}))},gn.tail=function(e){var t=null==e?0:e.length;return t?ji(e,1,t):[]},gn.take=function(t,r,n){return t&&t.length?ji(t,0,(r=n||r===e?1:Ha(r))<0?0:r):[]},gn.takeRight=function(t,r,n){var i=null==t?0:t.length;return i?ji(t,(r=i-(r=n||r===e?1:Ha(r)))<0?0:r,i):[]},gn.takeRightWhile=function(e,t){return e&&e.length?Vi(e,Ds(t,3),!1,!0):[]},gn.takeWhile=function(e,t){return e&&e.length?Vi(e,Ds(t,3)):[]},gn.tap=function(e,t){return t(e),e},gn.throttle=function(e,t,r){var i=!0,s=!0;if("function"!=typeof e)throw new st(n);return Ra(r)&&(i="leading"in r?!!r.leading:i,s="trailing"in r?!!r.trailing:s),oa(e,t,{leading:i,maxWait:t,trailing:s})},gn.thru=Vo,gn.toArray=$a,gn.toPairs=fc,gn.toPairsIn=dc,gn.toPath=function(e){return _a(e)?or(e,lo):Da(e)?[e]:is(ho(Fa(e)))},gn.toPlainObject=Ba,gn.transform=function(e,t,r){var n=_a(e),i=n||Ia(e)||ka(e);if(t=Ds(t,4),null==r){var s=e&&e.constructor;r=i?n?new s:[]:Ra(e)&&Oa(s)?yn(Et(e)):{}}return(i?er:Yn)(e,(function(e,n,i){return t(r,e,n,i)})),r},gn.unary=function(e){return ra(e,1)},gn.union=Ao,gn.unionBy=To,gn.unionWith=jo,gn.uniq=function(e){return e&&e.length?qi(e):[]},gn.uniqBy=function(e,t){return e&&e.length?qi(e,Ds(t,2)):[]},gn.uniqWith=function(t,r){return r="function"==typeof r?r:e,t&&t.length?qi(t,e,r):[]},gn.unset=function(e,t){return null==e||Ui(e,t)},gn.unzip=No,gn.unzipWith=Lo,gn.update=function(e,t,r){return null==e?e:$i(e,t,Fi(r))},gn.updateWith=function(t,r,n,i){return i="function"==typeof i?i:e,null==t?t:$i(t,r,Fi(n),i)},gn.values=gc,gn.valuesIn=function(e){return null==e?[]:Pr(e,ac(e))},gn.without=zo,gn.words=Oc,gn.wrap=function(e,t){return pa(Fi(t),e)},gn.xor=Mo,gn.xorBy=Do,gn.xorWith=ko,gn.zip=qo,gn.zipObject=function(e,t){return Gi(e||[],t||[],An)},gn.zipObjectDeep=function(e,t){return Gi(e||[],t||[],Ci)},gn.zipWith=Uo,gn.entries=fc,gn.entriesIn=dc,gn.extend=Ya,gn.extendWith=Ja,Mc(gn,gn),gn.add=Bc,gn.attempt=xc,gn.camelCase=yc,gn.capitalize=vc,gn.ceil=Fc,gn.clamp=function(t,r,n){return n===e&&(n=r,r=e),n!==e&&(n=(n=Ga(n))==n?n:0),r!==e&&(r=(r=Ga(r))==r?r:0),Mn(Ga(t),r,n)},gn.clone=function(e){return Dn(e,h)},gn.cloneDeep=function(e){return Dn(e,c|h)},gn.cloneDeepWith=function(t,r){return Dn(t,c|h,r="function"==typeof r?r:e)},gn.cloneWith=function(t,r){return Dn(t,h,r="function"==typeof r?r:e)},gn.conformsTo=function(e,t){return null==t||kn(e,t,oc(t))},gn.deburr=mc,gn.defaultTo=function(e,t){return null==e||e!=e?t:e},gn.divide=Wc,gn.endsWith=function(t,r,n){t=Fa(t),r=ki(r);var i=t.length,s=n=n===e?i:Mn(Ha(n),0,i);return(n-=r.length)>=0&&t.slice(n,s)==r},gn.eq=ga,gn.escape=function(e){return(e=Fa(e))&&Ee.test(e)?e.replace(we,Ar):e},gn.escapeRegExp=function(e){return(e=Fa(e))&&Ae.test(e)?e.replace(Re,"\\$&"):e},gn.every=function(t,r,n){var i=_a(t)?rr:Hn;return n&&Ws(t,r,n)&&(r=e),i(t,Ds(r,3))},gn.find=Go,gn.findIndex=mo,gn.findKey=function(e,t){return pr(e,Ds(t,3),Yn)},gn.findLast=Bo,gn.findLastIndex=_o,gn.findLastKey=function(e,t){return pr(e,Ds(t,3),Jn)},gn.floor=Yc,gn.forEach=Fo,gn.forEachRight=Wo,gn.forIn=function(e,t){return null==e?e:Fn(e,Ds(t,3),ac)},gn.forInRight=function(e,t){return null==e?e:Wn(e,Ds(t,3),ac)},gn.forOwn=function(e,t){return e&&Yn(e,Ds(t,3))},gn.forOwnRight=function(e,t){return e&&Jn(e,Ds(t,3))},gn.get=tc,gn.gt=ya,gn.gte=va,gn.has=function(e,t){return null!=e&&Ks(e,t,ri)},gn.hasIn=rc,gn.head=bo,gn.identity=jc,gn.includes=function(e,t,r,n){e=ba(e)?e:gc(e),r=r&&!n?Ha(r):0;var i=e.length;return r<0&&(r=Br(i+r,0)),Ma(e)?r<=i&&e.indexOf(t,r)>-1:!!i&&dr(e,t,r)>-1},gn.indexOf=function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=null==r?0:Ha(r);return i<0&&(i=Br(n+i,0)),dr(e,t,i)},gn.inRange=function(t,r,n){return r=Va(r),n===e?(n=r,r=0):n=Va(n),function(e,t,r){return e>=Fr(t,r)&&e<Br(t,r)}(t=Ga(t),r,n)},gn.invoke=sc,gn.isArguments=ma,gn.isArray=_a,gn.isArrayBuffer=wa,gn.isArrayLike=ba,gn.isArrayLikeObject=Ea,gn.isBoolean=function(e){return!0===e||!1===e||Aa(e)&&ei(e)==U},gn.isBuffer=Ia,gn.isDate=Sa,gn.isElement=function(e){return Aa(e)&&1===e.nodeType&&!Na(e)},gn.isEmpty=function(e){if(null==e)return!0;if(ba(e)&&(_a(e)||"string"==typeof e||"function"==typeof e.splice||Ia(e)||ka(e)||ma(e)))return!e.length;var t=Hs(e);if(t==B||t==X)return!e.size;if(Zs(e))return!li(e).length;for(var r in e)if(lt.call(e,r))return!1;return!0},gn.isEqual=function(e,t){return ai(e,t)},gn.isEqualWith=function(t,r,n){var i=(n="function"==typeof n?n:e)?n(t,r):e;return i===e?ai(t,r,e,n):!!i},gn.isError=Pa,gn.isFinite=function(e){return"number"==typeof e&&Hr(e)},gn.isFunction=Oa,gn.isInteger=xa,gn.isLength=Ca,gn.isMap=Ta,gn.isMatch=function(e,t){return e===t||ci(e,t,qs(t))},gn.isMatchWith=function(t,r,n){return n="function"==typeof n?n:e,ci(t,r,qs(r),n)},gn.isNaN=function(e){return ja(e)&&e!=+e},gn.isNative=function(e){if(Qs(e))throw new Xe(r);return ui(e)},gn.isNil=function(e){return null==e},gn.isNull=function(e){return null===e},gn.isNumber=ja,gn.isObject=Ra,gn.isObjectLike=Aa,gn.isPlainObject=Na,gn.isRegExp=La,gn.isSafeInteger=function(e){return xa(e)&&e>=-A&&e<=A},gn.isSet=za,gn.isString=Ma,gn.isSymbol=Da,gn.isTypedArray=ka,gn.isUndefined=function(t){return t===e},gn.isWeakMap=function(e){return Aa(e)&&Hs(e)==ne},gn.isWeakSet=function(e){return Aa(e)&&ei(e)==ie},gn.join=function(e,t){return null==e?"":Kr.call(e,t)},gn.kebabCase=_c,gn.last=Po,gn.lastIndexOf=function(t,r,n){var i=null==t?0:t.length;if(!i)return-1;var s=i;return n!==e&&(s=(s=Ha(n))<0?Br(i+s,0):Fr(s,i-1)),r==r?function(e,t,r){for(var n=r+1;n--;)if(e[n]===t)return n;return n}(t,r,s):fr(t,yr,s,!0)},gn.lowerCase=wc,gn.lowerFirst=bc,gn.lt=qa,gn.lte=Ua,gn.max=function(t){return t&&t.length?Kn(t,jc,ti):e},gn.maxBy=function(t,r){return t&&t.length?Kn(t,Ds(r,2),ti):e},gn.mean=function(e){return vr(e,jc)},gn.meanBy=function(e,t){return vr(e,Ds(t,2))},gn.min=function(t){return t&&t.length?Kn(t,jc,fi):e},gn.minBy=function(t,r){return t&&t.length?Kn(t,Ds(r,2),fi):e},gn.stubArray=Kc,gn.stubFalse=Gc,gn.stubObject=function(){return{}},gn.stubString=function(){return""},gn.stubTrue=function(){return!0},gn.multiply=Jc,gn.nth=function(t,r){return t&&t.length?mi(t,Ha(r)):e},gn.noConflict=function(){return Ut._===this&&(Ut._=yt),this},gn.noop=Dc,gn.now=ta,gn.pad=function(e,t,r){e=Fa(e);var n=(t=Ha(t))?Dr(e):0;if(!t||n>=t)return e;var i=(t-n)/2;return _s(lr(i),r)+e+_s(Gt(i),r)},gn.padEnd=function(e,t,r){e=Fa(e);var n=(t=Ha(t))?Dr(e):0;return t&&n<t?e+_s(t-n,r):e},gn.padStart=function(e,t,r){e=Fa(e);var n=(t=Ha(t))?Dr(e):0;return t&&n<t?_s(t-n,r)+e:e},gn.parseInt=function(e,t,r){return r||null==t?t=0:t&&(t=+t),Yr(Fa(e).replace(Te,""),t||0)},gn.random=function(t,r,n){if(n&&"boolean"!=typeof n&&Ws(t,r,n)&&(r=n=e),n===e&&("boolean"==typeof r?(n=r,r=e):"boolean"==typeof t&&(n=t,t=e)),t===e&&r===e?(t=0,r=1):(t=Va(t),r===e?(r=t,t=0):r=Va(r)),t>r){var i=t;t=r,r=i}if(n||t%1||r%1){var s=Jr();return Fr(t+s*(r-t+Mt("1e-"+((s+"").length-1))),r)}return Ii(t,r)},gn.reduce=function(e,t,r){var n=_a(e)?cr:wr,i=arguments.length<3;return n(e,Ds(t,4),r,i,$n)},gn.reduceRight=function(e,t,r){var n=_a(e)?ur:wr,i=arguments.length<3;return n(e,Ds(t,4),r,i,Vn)},gn.repeat=function(t,r,n){return r=(n?Ws(t,r,n):r===e)?1:Ha(r),Si(Fa(t),r)},gn.replace=function(){var e=arguments,t=Fa(e[0]);return e.length<3?t:t.replace(e[1],e[2])},gn.result=function(t,r,n){var i=-1,s=(r=Wi(r,t)).length;for(s||(s=1,t=e);++i<s;){var o=null==t?e:t[lo(r[i])];o===e&&(i=s,o=n),t=Oa(o)?o.call(t):o}return t},gn.round=Qc,gn.runInContext=je,gn.sample=function(e){return(_a(e)?On:Oi)(e)},gn.size=function(e){if(null==e)return 0;if(ba(e))return Ma(e)?Dr(e):e.length;var t=Hs(e);return t==B||t==X?e.size:li(e).length},gn.snakeCase=Ec,gn.some=function(t,r,n){var i=_a(t)?hr:Ni;return n&&Ws(t,r,n)&&(r=e),i(t,Ds(r,3))},gn.sortedIndex=function(e,t){return Li(e,t)},gn.sortedIndexBy=function(e,t,r){return zi(e,t,Ds(r,2))},gn.sortedIndexOf=function(e,t){var r=null==e?0:e.length;if(r){var n=Li(e,t);if(n<r&&ga(e[n],t))return n}return-1},gn.sortedLastIndex=function(e,t){return Li(e,t,!0)},gn.sortedLastIndexBy=function(e,t,r){return zi(e,t,Ds(r,2),!0)},gn.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var r=Li(e,t,!0)-1;if(ga(e[r],t))return r}return-1},gn.startCase=Ic,gn.startsWith=function(e,t,r){return e=Fa(e),r=null==r?0:Mn(Ha(r),0,e.length),t=ki(t),e.slice(r,r+t.length)==t},gn.subtract=Zc,gn.sum=function(e){return e&&e.length?br(e,jc):0},gn.sumBy=function(e,t){return e&&e.length?br(e,Ds(t,2)):0},gn.template=function(t,r,n){var s=gn.templateSettings;n&&Ws(t,r,n)&&(r=e),t=Fa(t),r=Ja({},r,s,xs);var o,a,c=Ja({},r.imports,s.imports,xs),u=oc(c),h=Pr(c,u),l=0,p=r.interpolate||Fe,f="__p += '",d=nt((r.escape||Fe).source+"|"+p.source+"|"+(p===Pe?qe:Fe).source+"|"+(r.evaluate||Fe).source+"|$","g"),g="//# sourceURL="+(lt.call(r,"sourceURL")?(r.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++jt+"]")+"\n";t.replace(d,(function(e,r,n,i,s,c){return n||(n=i),f+=t.slice(l,c).replace(We,Tr),r&&(o=!0,f+="' +\n__e("+r+") +\n'"),s&&(a=!0,f+="';\n"+s+";\n__p += '"),n&&(f+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),l=c+e.length,e})),f+="';\n";var y=lt.call(r,"variable")&&r.variable;if(y){if(De.test(y))throw new Xe(i)}else f="with (obj) {\n"+f+"\n}\n";f=(a?f.replace(ye,""):f).replace(ve,"$1").replace(me,"$1;"),f="function("+(y||"obj")+") {\n"+(y?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var v=xc((function(){return et(u,g+"return "+f).apply(e,h)}));if(v.source=f,Pa(v))throw v;return v},gn.times=function(e,t){if((e=Ha(e))<1||e>A)return[];var r=N,n=Fr(e,N);t=Ds(t),e-=N;for(var i=Er(n,t);++r<e;)t(r);return i},gn.toFinite=Va,gn.toInteger=Ha,gn.toLength=Ka,gn.toLower=function(e){return Fa(e).toLowerCase()},gn.toNumber=Ga,gn.toSafeInteger=function(e){return e?Mn(Ha(e),-A,A):0===e?e:0},gn.toString=Fa,gn.toUpper=function(e){return Fa(e).toUpperCase()},gn.trim=function(t,r,n){if((t=Fa(t))&&(n||r===e))return Ir(t);if(!t||!(r=ki(r)))return t;var i=kr(t),s=kr(r);return Ji(i,xr(i,s),Cr(i,s)+1).join("")},gn.trimEnd=function(t,r,n){if((t=Fa(t))&&(n||r===e))return t.slice(0,qr(t)+1);if(!t||!(r=ki(r)))return t;var i=kr(t);return Ji(i,0,Cr(i,kr(r))+1).join("")},gn.trimStart=function(t,r,n){if((t=Fa(t))&&(n||r===e))return t.replace(Te,"");if(!t||!(r=ki(r)))return t;var i=kr(t);return Ji(i,xr(i,kr(r))).join("")},gn.truncate=function(t,r){var n=I,i=S;if(Ra(r)){var s="separator"in r?r.separator:s;n="length"in r?Ha(r.length):n,i="omission"in r?ki(r.omission):i}var o=(t=Fa(t)).length;if(jr(t)){var a=kr(t);o=a.length}if(n>=o)return t;var c=n-Dr(i);if(c<1)return i;var u=a?Ji(a,0,c).join(""):t.slice(0,c);if(s===e)return u+i;if(a&&(c+=u.length-c),La(s)){if(t.slice(c).search(s)){var h,l=u;for(s.global||(s=nt(s.source,Fa(Ue.exec(s))+"g")),s.lastIndex=0;h=s.exec(l);)var p=h.index;u=u.slice(0,p===e?c:p)}}else if(t.indexOf(ki(s),c)!=c){var f=u.lastIndexOf(s);f>-1&&(u=u.slice(0,f))}return u+i},gn.unescape=function(e){return(e=Fa(e))&&be.test(e)?e.replace(_e,Ur):e},gn.uniqueId=function(e){var t=++pt;return Fa(e)+t},gn.upperCase=Sc,gn.upperFirst=Pc,gn.each=Fo,gn.eachRight=Wo,gn.first=bo,Mc(gn,function(){var e={};return Yn(gn,(function(t,r){lt.call(gn.prototype,r)||(e[r]=t)})),e}(),{chain:!1}),gn.VERSION="4.17.21",er(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){gn[e].placeholder=gn})),er(["drop","take"],(function(t,r){_n.prototype[t]=function(n){n=n===e?1:Br(Ha(n),0);var i=this.__filtered__&&!r?new _n(this):this.clone();return i.__filtered__?i.__takeCount__=Fr(n,i.__takeCount__):i.__views__.push({size:Fr(n,N),type:t+(i.__dir__<0?"Right":"")}),i},_n.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),er(["filter","map","takeWhile"],(function(e,t){var r=t+1,n=r==x||3==r;_n.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:Ds(e,3),type:r}),t.__filtered__=t.__filtered__||n,t}})),er(["head","last"],(function(e,t){var r="take"+(t?"Right":"");_n.prototype[e]=function(){return this[r](1).value()[0]}})),er(["initial","tail"],(function(e,t){var r="drop"+(t?"":"Right");_n.prototype[e]=function(){return this.__filtered__?new _n(this):this[r](1)}})),_n.prototype.compact=function(){return this.filter(jc)},_n.prototype.find=function(e){return this.filter(e).head()},_n.prototype.findLast=function(e){return this.reverse().find(e)},_n.prototype.invokeMap=Pi((function(e,t){return"function"==typeof e?new _n(this):this.map((function(r){return si(r,e,t)}))})),_n.prototype.reject=function(e){return this.filter(ha(Ds(e)))},_n.prototype.slice=function(t,r){t=Ha(t);var n=this;return n.__filtered__&&(t>0||r<0)?new _n(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),r!==e&&(n=(r=Ha(r))<0?n.dropRight(-r):n.take(r-t)),n)},_n.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},_n.prototype.toArray=function(){return this.take(N)},Yn(_n.prototype,(function(t,r){var n=/^(?:filter|find|map|reject)|While$/.test(r),i=/^(?:head|last)$/.test(r),s=gn[i?"take"+("last"==r?"Right":""):r],o=i||/^find/.test(r);s&&(gn.prototype[r]=function(){var r=this.__wrapped__,a=i?[1]:arguments,c=r instanceof _n,u=a[0],h=c||_a(r),l=function(e){var t=s.apply(gn,ar([e],a));return i&&p?t[0]:t};h&&n&&"function"==typeof u&&1!=u.length&&(c=h=!1);var p=this.__chain__,f=!!this.__actions__.length,d=o&&!p,g=c&&!f;if(!o&&h){r=g?r:new _n(this);var y=t.apply(r,a);return y.__actions__.push({func:Vo,args:[l],thisArg:e}),new mn(y,p)}return d&&g?t.apply(this,a):(y=this.thru(l),d?i?y.value()[0]:y.value():y)})})),er(["pop","push","shift","sort","splice","unshift"],(function(e){var t=ot[e],r=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",n=/^(?:pop|shift)$/.test(e);gn.prototype[e]=function(){var e=arguments;if(n&&!this.__chain__){var i=this.value();return t.apply(_a(i)?i:[],e)}return this[r]((function(r){return t.apply(_a(r)?r:[],e)}))}})),Yn(_n.prototype,(function(e,t){var r=gn[t];if(r){var n=r.name+"";lt.call(on,n)||(on[n]=[]),on[n].push({name:t,func:r})}})),on[gs(e,d).name]=[{name:"wrapper",func:e}],_n.prototype.clone=function(){var e=new _n(this.__wrapped__);return e.__actions__=is(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=is(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=is(this.__views__),e},_n.prototype.reverse=function(){if(this.__filtered__){var e=new _n(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},_n.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,r=_a(e),n=t<0,i=r?e.length:0,s=function(e,t,r){for(var n=-1,i=r.length;++n<i;){var s=r[n],o=s.size;switch(s.type){case"drop":e+=o;break;case"dropRight":t-=o;break;case"take":t=Fr(t,e+o);break;case"takeRight":e=Br(e,t-o)}}return{start:e,end:t}}(0,i,this.__views__),o=s.start,a=s.end,c=a-o,u=n?a:o-1,h=this.__iteratees__,l=h.length,p=0,f=Fr(c,this.__takeCount__);if(!r||!n&&i==c&&f==c)return Hi(e,this.__actions__);var d=[];e:for(;c--&&p<f;){for(var g=-1,y=e[u+=t];++g<l;){var v=h[g],m=v.iteratee,_=v.type,w=m(y);if(_==C)y=w;else if(!w){if(_==x)continue e;break e}}d[p++]=y}return d},gn.prototype.at=Ho,gn.prototype.chain=function(){return $o(this)},gn.prototype.commit=function(){return new mn(this.value(),this.__chain__)},gn.prototype.next=function(){this.__values__===e&&(this.__values__=$a(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?e:this.__values__[this.__index__++]}},gn.prototype.plant=function(t){for(var r,n=this;n instanceof vn;){var i=fo(n);i.__index__=0,i.__values__=e,r?s.__wrapped__=i:r=i;var s=i;n=n.__wrapped__}return s.__wrapped__=t,r},gn.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof _n){var r=t;return this.__actions__.length&&(r=new _n(this)),(r=r.reverse()).__actions__.push({func:Vo,args:[Ro],thisArg:e}),new mn(r,this.__chain__)}return this.thru(Ro)},gn.prototype.toJSON=gn.prototype.valueOf=gn.prototype.value=function(){return Hi(this.__wrapped__,this.__actions__)},gn.prototype.first=gn.prototype.head,zt&&(gn.prototype[zt]=function(){return this}),gn}();Vt?((Vt.exports=$r)._=$r,$t._=$r):Ut._=$r}.call(mo);var wo=Object.defineProperty,bo=Object.defineProperties,Eo=Object.getOwnPropertyDescriptors,Io=Object.getOwnPropertySymbols,So=Object.prototype.hasOwnProperty,Po=Object.prototype.propertyIsEnumerable,Oo=(e,t,r)=>t in e?wo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,xo=(e,t)=>{for(var r in t||(t={}))So.call(t,r)&&Oo(e,r,t[r]);if(Io)for(var r of Io(t))Po.call(t,r)&&Oo(e,r,t[r]);return e},Co=(e,t)=>bo(e,Eo(t));function Ro(e,t,r){let n;const i=Ao(e);return t.rpcMap&&(n=t.rpcMap[i]),n||(n=`${fo}?chainId=eip155:${i}&projectId=${r}`),n}function Ao(e){return e.includes("eip155")?Number(e.split(":")[1]):Number(e)}function To(e){return e.map((e=>`${e.split(":")[0]}:${e.split(":")[1]}`))}function jo(e){var t,r,n,i;const s={};if(!me(e))return s;for(const[o,a]of Object.entries(e)){const e=ke(o)?[o]:a.chains,c=a.methods||[],u=a.events||[],h=a.rpcMap||{},l=De(o);s[l]=Co(xo(xo({},s[l]),a),{chains:qe(e,null==(t=s[l])?void 0:t.chains),methods:qe(c,null==(r=s[l])?void 0:r.methods),events:qe(u,null==(n=s[l])?void 0:n.events),rpcMap:xo(xo({},h),null==(i=s[l])?void 0:i.rpcMap)})}return s}function No(e){return e.includes(":")?e.split(":")[2]:e}function Lo(e){const t={};for(const[r,n]of Object.entries(e)){const e=n.methods||[],i=n.events||[],s=n.accounts||[],o=ke(r)?[r]:n.chains?n.chains:To(n.accounts);t[r]={chains:o,methods:e,events:i,accounts:s}}return t}const zo={},Mo=e=>zo[e],Do=(e,t)=>{zo[e]=t};class ko{constructor(e){this.name="polkadot",this.namespace=e.namespace,this.events=Mo("events"),this.client=Mo("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const r=t||Ro(`${this.name}:${e}`,this.namespace);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.events.emit(go,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e&&e.filter((e=>e.split(":")[1]===this.chainId.toString())).map((e=>e.split(":")[2]))||[]}createHttpProviders(){const e={};return this.namespace.chains.forEach((t=>{var r;e[t]=this.createHttpProvider(t,null==(r=this.namespace.rpcMap)?void 0:r[t])})),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Ro(e,this.namespace);return typeof r>"u"?void 0:new f(new E(r,Mo("disableProviderPing")))}}class qo{constructor(e){this.name="eip155",this.namespace=e.namespace,this.events=Mo("events"),this.client=Mo("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){const r=Ao(e);if(!this.httpProviders[r]){const e=t||Ro(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!e)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,e)}this.chainId=r,this.events.emit(go,`${this.name}:${r}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const r=t||Ro(`${this.name}:${e}`,this.namespace,this.client.core.projectId);return typeof r>"u"?void 0:new f(new E(r,Mo("disableProviderPing")))}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProviders(){const e={};return this.namespace.chains.forEach((t=>{var r;const n=Ao(t);e[n]=this.createHttpProvider(n,null==(r=this.namespace.rpcMap)?void 0:r[t])})),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter((e=>e.split(":")[1]===this.chainId.toString())).map((e=>e.split(":")[2])))]:[]}getHttpProvider(){const e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}async handleSwitchChain(e){var t,r;let n=e.request.params?null==(t=e.request.params[0])?void 0:t.chainId:"0x0";n=n.startsWith("0x")?n:`0x${n}`;const i=parseInt(n,16);if(this.isChainApproved(i))this.setDefaultChain(`${i}`);else{if(!this.namespace.methods.includes("wallet_switchEthereumChain"))throw new Error(`Failed to switch to chain 'eip155:${i}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:n}]},chainId:null==(r=this.namespace.chains)?void 0:r[0]}),this.setDefaultChain(`${i}`)}return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}}class Uo{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=Mo("events"),this.client=Mo("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const r=t||Ro(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.chainId=e,this.events.emit(go,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter((e=>e.split(":")[1]===this.chainId.toString())).map((e=>e.split(":")[2])))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach((t=>{var r;e[t]=this.createHttpProvider(t,null==(r=this.namespace.rpcMap)?void 0:r[t])})),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Ro(e,this.namespace,this.client.core.projectId);return typeof r>"u"?void 0:new f(new E(r,Mo("disableProviderPing")))}}class $o{constructor(e){this.name="cosmos",this.namespace=e.namespace,this.events=Mo("events"),this.client=Mo("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const r=t||Ro(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.events.emit(go,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter((e=>e.split(":")[1]===this.chainId.toString())).map((e=>e.split(":")[2])))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach((t=>{var r;e[t]=this.createHttpProvider(t,null==(r=this.namespace.rpcMap)?void 0:r[t])})),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Ro(e,this.namespace,this.client.core.projectId);return typeof r>"u"?void 0:new f(new E(r,Mo("disableProviderPing")))}}class Vo{constructor(e){this.name="cip34",this.namespace=e.namespace,this.events=Mo("events"),this.client=Mo("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const r=t||this.getCardanoRPCUrl(e);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.events.emit(go,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter((e=>e.split(":")[1]===this.chainId.toString())).map((e=>e.split(":")[2])))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach((t=>{const r=this.getCardanoRPCUrl(t);e[t]=this.createHttpProvider(t,r)})),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||this.getCardanoRPCUrl(e);return typeof r>"u"?void 0:new f(new E(r,Mo("disableProviderPing")))}}class Ho{constructor(e){this.name="elrond",this.namespace=e.namespace,this.events=Mo("events"),this.client=Mo("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const r=t||Ro(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.chainId=e,this.events.emit(go,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter((e=>e.split(":")[1]===this.chainId.toString())).map((e=>e.split(":")[2])))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach((t=>{var r;e[t]=this.createHttpProvider(t,null==(r=this.namespace.rpcMap)?void 0:r[t])})),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Ro(e,this.namespace,this.client.core.projectId);return typeof r>"u"?void 0:new f(new E(r,Mo("disableProviderPing")))}}class Ko{constructor(e){this.name="multiversx",this.namespace=e.namespace,this.events=Mo("events"),this.client=Mo("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const r=t||Ro(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.chainId=e,this.events.emit(go,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter((e=>e.split(":")[1]===this.chainId.toString())).map((e=>e.split(":")[2])))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach((t=>{var r;e[t]=this.createHttpProvider(t,null==(r=this.namespace.rpcMap)?void 0:r[t])})),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Ro(e,this.namespace,this.client.core.projectId);return typeof r>"u"?void 0:new f(new E(r,Mo("disableProviderPing")))}}var Go=Object.defineProperty,Bo=Object.defineProperties,Fo=Object.getOwnPropertyDescriptors,Wo=Object.getOwnPropertySymbols,Yo=Object.prototype.hasOwnProperty,Jo=Object.prototype.propertyIsEnumerable,Qo=(e,t,r)=>t in e?Go(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Zo=(e,t)=>{for(var r in t||(t={}))Yo.call(t,r)&&Qo(e,r,t[r]);if(Wo)for(var r of Wo(t))Jo.call(t,r)&&Qo(e,r,t[r]);return e},Xo=(e,t)=>Bo(e,Fo(t));class ea{constructor(e){this.events=new v,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=e,this.logger=typeof(null==e?void 0:e.logger)<"u"&&"string"!=typeof(null==e?void 0:e.logger)?e.logger:Bt.pino(Bt.getDefaultLoggerOptions({level:(null==e?void 0:e.logger)||lo})),this.disableProviderPing=(null==e?void 0:e.disableProviderPing)||!1}static async init(e){const t=new ea(e);return await t.initialize(),t}async request(e,t){const[r,n]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(r).request({request:Zo({},e),chainId:`${r}:${n}`,topic:this.session.topic})}sendAsync(e,t,r){this.request(e,r).then((e=>t(null,e))).catch((e=>t(e,void 0)))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:null==(e=this.session)?void 0:e.topic,reason:ee("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){this.shouldAbortPairingAttempt=!1;let t=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(t>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:r,approval:n}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});r&&(this.uri=r,this.events.emit("display_uri",r)),await n().then((e=>{this.session=e,this.namespaces||(this.namespaces=Lo(e.namespaces),this.persist("namespaces",this.namespaces))})).catch((e=>{if(e.message!==Ks)throw e;t++}))}while(!this.session);return this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;const[r,n]=this.validateChain(e);this.getProvider(r).setDefaultChain(n,t)}catch(r){if(!/Please call connect/.test(r.message))throw r}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(ye(t)){for(const r of t)e.deletePairings?this.client.core.expirer.set(r.topic,0):await this.client.core.relayer.subscriber.unsubscribe(r.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await ho.init({logger:this.providerOpts.logger||lo,relayUrl:this.providerOpts.relayUrl||"wss://relay.walletconnect.com",projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map((e=>De(e))))];Do("client",this.client),Do("events",this.events),Do("disableProviderPing",this.disableProviderPing),e.forEach((e=>{if(!this.session)return;const t=function(e,t){const r=Object.keys(t.namespaces).filter((t=>t.includes(e)));if(!r.length)return[];const n=[];return r.forEach((e=>{const r=t.namespaces[e].accounts;n.push(...r)})),n}(e,this.session),r=To(t),n=function(e={},t={}){const r=jo(e),n=jo(t);return _o.exports.merge(r,n)}(this.namespaces,this.optionalNamespaces),i=Xo(Zo({},n[e]),{accounts:t,chains:r});switch(e){case"eip155":this.rpcProviders[e]=new qo({namespace:i});break;case"solana":this.rpcProviders[e]=new Uo({namespace:i});break;case"cosmos":this.rpcProviders[e]=new $o({namespace:i});break;case"polkadot":this.rpcProviders[e]=new ko({namespace:i});break;case"cip34":this.rpcProviders[e]=new Vo({namespace:i});break;case"elrond":this.rpcProviders[e]=new Ho({namespace:i});break;case"multiversx":this.rpcProviders[e]=new Ko({namespace:i})}}))}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",(e=>{this.events.emit("session_ping",e)})),this.client.on("session_event",(e=>{const{params:t}=e,{event:r}=t;if("accountsChanged"===r.name){const e=r.data;e&&ye(e)&&this.events.emit("accountsChanged",e.map(No))}else"chainChanged"===r.name?this.onChainChanged(t.chainId):this.events.emit(r.name,r.data);this.events.emit("session_event",e)})),this.client.on("session_update",(({topic:e,params:t})=>{var r;const{namespaces:n}=t,i=null==(r=this.client)?void 0:r.session.get(e);this.session=Xo(Zo({},i),{namespaces:n}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})})),this.client.on("session_delete",(async e=>{await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",Xo(Zo({},ee("USER_DISCONNECTED")),{data:e.topic}))})),this.on(go,(e=>{this.onChainChanged(e,!0)}))}getProvider(e){if(!this.rpcProviders[e])throw new Error(`Provider not found: ${e}`);return this.rpcProviders[e]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach((e=>{var t;this.getProvider(e).updateNamespace(null==(t=this.session)?void 0:t.namespaces[e])}))}setNamespaces(e){const{namespaces:t,optionalNamespaces:r,sessionProperties:n}=e;t&&Object.keys(t).length&&(this.namespaces=t),r&&Object.keys(r).length&&(this.optionalNamespaces=r),this.sessionProperties=n,this.persist("namespaces",t),this.persist("optionalNamespaces",r)}validateChain(e){const[t,r]=(null==e?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,r];if(t&&!Object.keys(this.namespaces||{}).map((e=>De(e))).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&r)return[t,r];const n=De(Object.keys(this.namespaces)[0]);return[n,this.rpcProviders[n].getDefaultChain()]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,t=!1){var r;if(!this.namespaces)return;const[n,i]=this.validateChain(e);t||this.getProvider(n).setDefaultChain(i),(null!=(r=this.namespaces[n])?r:this.namespaces[`${n}:${i}`]).defaultChain=i,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",i)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(e,t){this.client.core.storage.setItem(`${po}/${e}`,t)}async getFromStore(e){return await this.client.core.storage.getItem(`${po}/${e}`)}}const ta=ea,ra=["eth_sendTransaction","personal_sign"],na=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],ia=["chainChanged","accountsChanged"],sa=["message","disconnect","connect"];var oa=Object.defineProperty,aa=Object.defineProperties,ca=Object.getOwnPropertyDescriptors,ua=Object.getOwnPropertySymbols,ha=Object.prototype.hasOwnProperty,la=Object.prototype.propertyIsEnumerable,pa=(e,t,r)=>t in e?oa(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,fa=(e,t)=>{for(var r in t||(t={}))ha.call(t,r)&&pa(e,r,t[r]);if(ua)for(var r of ua(t))la.call(t,r)&&pa(e,r,t[r]);return e},da=(e,t)=>aa(e,ca(t));function ga(e){return Number(e[0].split(":")[1])}function ya(e){return`0x${e.toString(16)}`}class va{constructor(){this.events=new i.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY="wc@2:ethereum_provider:",this.on=(e,t)=>(this.events.on(e,t),this),this.once=(e,t)=>(this.events.once(e,t),this),this.removeListener=(e,t)=>(this.events.removeListener(e,t),this),this.off=(e,t)=>(this.events.off(e,t),this),this.parseAccount=e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e,this.signer={},this.rpc={}}static async init(e){const t=new va;return await t.initialize(e),t}async request(e){return await this.signer.request(e,this.formatChainId(this.chainId))}sendAsync(e,t){this.signer.sendAsync(e,t,this.formatChainId(this.chainId))}get connected(){return!!this.signer.client&&this.signer.client.core.relayer.connected}get connecting(){return!!this.signer.client&&this.signer.client.core.relayer.connecting}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:t,optional:r}=function(e){const{chains:t,optionalChains:r,methods:n,optionalMethods:i,events:s,optionalEvents:o,rpcMap:a}=e;if(!ye(t))throw new Error("Invalid chains");const c={chains:t,methods:n||ra,events:s||ia,rpcMap:fa({},t.length?{[ga(t)]:a[ga(t)]}:{})},u=null==s?void 0:s.filter((e=>!ia.includes(e))),h=null==n?void 0:n.filter((e=>!ra.includes(e)));if(!(r||o||i||null!=u&&u.length||null!=h&&h.length))return{required:t.length?c:void 0};const l=(null==u?void 0:u.length)&&(null==h?void 0:h.length)||!r,p={chains:[...new Set(l?c.chains.concat(r||[]):r)],methods:[...new Set(c.methods.concat(null!=i&&i.length?i:na))],events:[...new Set(c.events.concat(o||sa))],rpcMap:a};return{required:t.length?c:void 0,optional:r.length?p:void 0}}(this.rpc);try{const n=await new Promise((async(n,i)=>{var s;this.rpc.showQrModal&&(null==(s=this.modal)||s.subscribeModal((e=>{!e.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),i(new Error("Connection request reset. Please try again.")))}))),await this.signer.connect(da(fa({namespaces:fa({},t&&{[this.namespace]:t})},r&&{optionalNamespaces:{[this.namespace]:r}}),{pairingTopic:null==e?void 0:e.pairingTopic})).then((e=>{n(e)})).catch((e=>{i(new Error(e.message))}))}));if(!n)return;this.setChainIds(this.rpc.chains);const i=Ue(n.namespaces,[this.namespace]);this.setAccounts(i),this.events.emit("connect",{chainId:ya(this.chainId)})}catch(n){throw this.signer.logger.error(n),n}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",(e=>{const{params:t}=e,{event:r}=t;"accountsChanged"===r.name?(this.accounts=this.parseAccounts(r.data),this.events.emit("accountsChanged",this.accounts)):"chainChanged"===r.name?this.setChainId(this.formatChainId(r.data)):this.events.emit(r.name,r.data),this.events.emit("session_event",e)})),this.signer.on("chainChanged",(e=>{const t=parseInt(e);this.chainId=t,this.events.emit("chainChanged",ya(this.chainId)),this.persist()})),this.signer.on("session_update",(e=>{this.events.emit("session_update",e)})),this.signer.on("session_delete",(e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",da(fa({},ee("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))})),this.signer.on("display_uri",(e=>{var t,r;this.rpc.showQrModal&&(null==(t=this.modal)||t.closeModal(),null==(r=this.modal)||r.openModal({uri:e})),this.events.emit("display_uri",e)}))}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return"string"==typeof e&&e.startsWith(`${this.namespace}:`)}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const t=e.filter((e=>this.isCompatibleChainId(e))).map((e=>this.parseChainId(e)));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",ya(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const t=this.parseChainId(e);this.chainId=t,this.switchEthereumChain(t)}}parseAccountId(e){const[t,r,n]=e.split(":");return{chainId:`${t}:${r}`,address:n}}setAccounts(e){this.accounts=e.filter((e=>this.parseChainId(this.parseAccountId(e).chainId)===this.chainId)).map((e=>this.parseAccountId(e).address)),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var t,r;const n=null!=(t=null==e?void 0:e.chains)?t:[],i=null!=(r=null==e?void 0:e.optionalChains)?r:[],s=n.concat(i);if(!s.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const o=n.length?(null==e?void 0:e.methods)||ra:[],a=n.length?(null==e?void 0:e.events)||ia:[],c=(null==e?void 0:e.optionalMethods)||[],u=(null==e?void 0:e.optionalEvents)||[],h=(null==e?void 0:e.rpcMap)||this.buildRpcMap(s,e.projectId),l=(null==e?void 0:e.qrModalOptions)||void 0;return{chains:null==n?void 0:n.map((e=>this.formatChainId(e))),optionalChains:i.map((e=>this.formatChainId(e))),methods:o,events:a,optionalMethods:c,optionalEvents:u,rpcMap:h,showQrModal:!(null==e||!e.showQrModal),qrModalOptions:l,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,t){const r={};return e.forEach((e=>{r[e]=this.getRpcUrl(e,t)})),r}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?ga(this.rpc.chains):ga(this.rpc.optionalChains),this.signer=await ta.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storageOptions:e.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let e;try{const{WalletConnectModal:t}=await n((()=>import("./aea00842.js").then((e=>e.i))),["static/js/aea00842.js","static/js/9b9cf7db.js","static/js/35bc27a3.js","static/js/5bdea638.js","static/js/1e98e625.js","static/css/9fad23f1.css","static/js/ee7ce8fe.js","static/js/2b425f2d.js","static/js/c229d341.js","static/js/9737f36b.js","static/css/3b16c8c0.css"]);e=t}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(e)try{this.modal=new e(fa({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(t){throw this.signer.logger.error(t),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:t,optionalChains:r,rpcMap:n}=e;t&&ye(t)&&(this.rpc.chains=t.map((e=>this.formatChainId(e))),t.forEach((e=>{this.rpc.rpcMap[e]=(null==n?void 0:n[e])||this.getRpcUrl(e)}))),r&&ye(r)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=null==r?void 0:r.map((e=>this.formatChainId(e))),r.forEach((e=>{this.rpc.rpcMap[e]=(null==n?void 0:n[e])||this.getRpcUrl(e)})))}getRpcUrl(e,t){var r;return(null==(r=this.rpc.rpcMap)?void 0:r[e])||`https://rpc.walletconnect.com/v1/?chainId=eip155:${e}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),t=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:null==t?void 0:t.accounts),this.setAccounts(null==t?void 0:t.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return"string"==typeof e||e instanceof String?[this.parseAccount(e)]:e.map((e=>this.parseAccount(e)))}}const ma=va;export{ma as EthereumProvider,sa as OPTIONAL_EVENTS,na as OPTIONAL_METHODS,ia as REQUIRED_EVENTS,ra as REQUIRED_METHODS,va as default};
