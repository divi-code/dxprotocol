import{_ as e,a,b as l,u as r,c as i,R as s,x as t,e as d}from"./35bc27a3.js";import{s as o}from"./ee7ce8fe.js";import{r as u,a4 as n,i as v}from"./9b9cf7db.js";import{B as c}from"./1e98e625.js";import{g as m,r as f,w as p,G as b,q as g,x as y,y as k,O as h,L as C,I as x,J as w,H as I,N as _}from"./5bdea638.js";import"./2b425f2d.js";import"./c229d341.js";import"./9737f36b.js";const z={class:"bind-code-template"},$={class:"bind-code kilo-inner-model"},j={class:"title"},T={class:"content"},N={key:0},R={key:0,class:"kilo-error-input"},B={class:"enjoy"},q={key:1},A={class:"validate-code"},F={class:"text"},S=e({__name:"BindCode",props:{visible:{type:Boolean,default:!1}},emits:["update:visible","callback"],setup(e,{emit:S}){const V=a(),M=l(),{root:O}=m(),U=r(),{walletInfo:D,inviteInfo:G}=o(U),{operateReferral:H,getContractAddress:J}=d(),L=f(!1),{t:P}=i(),E=f(""),K=f(""),Q=f({trade:0,recommend:0}),W=f(!1),X=f(!1),Y=async e=>{if(!E.value&&!e)return void(W.value=!0);const{referralStorageManagerAddr:a,chainId:l}=J();return await u({address:a,abi:s.abi,functionName:"codeOwners",chainId:l,args:[n(e||E.value,{size:32})]})},Z=async e=>{var a,l,r,i,d,o,n,m,f,p;const{referralStorageManagerAddr:b,chainId:g}=J(),y=await u({address:b,abi:s.abi,functionName:"getReferrerTier",chainId:g,args:[e]}),k=await v({contracts:[{address:b,abi:s.abi,functionName:"tiers",chainId:g,args:[y]},{address:b,abi:s.abi,functionName:"referrerDiscountShares",chainId:g,args:[e]}]});k&&((null==(a=k[0])?void 0:a.result[2])&&(null==(l=k[1])?void 0:l.result)>0?(Q.value.trade=t(null==(r=k[0])?void 0:r.result[0],4).times(t(null==(i=k[1])?void 0:i.result,4)).times(100).toFixed(2),Q.value.recommend=t(null==(d=k[0])?void 0:d.result[0],4).times(new c(1).minus(t(null==(o=k[1])?void 0:o.result,4))).times(100).toFixed(2)):(Q.value.trade=t(null==(n=k[0])?void 0:n.result[0],4).times(t(null==(m=k[0])?void 0:m.result[1],4)).times(100).toFixed(2),Q.value.recommend=t(null==(f=k[0])?void 0:f.result[0],4).times(new c(1).minus(t(null==(p=k[0])?void 0:p.result[1],4))).times(100).toFixed(2)))},ee=async e=>{var a,l;if(e&&(E.value=e,W.value=!1),W.value)return;if(!E.value)return void(W.value=!0);L.value=!0;const r=await Y();if("0x0000000000000000000000000000000000000000"==r)return W.value=!0,K.value="referral.noRegiste",void(L.value=!1);if(X.value=!0,L.value=!1,(null==(a=G.value)?void 0:a.address)||U.$patch({inviteInfo:{code:E.value,address:""}}),null==(l=V.query)?void 0:l.sCode){const e={...V.query};M.replace({query:{...e,sCode:E.value}})}Z(r)},ae=async()=>{L.value=!0;const e=await H([n(E.value,{size:32})],"setTraderReferralCodeByUser",P("referral.bindCodeTitle"));L.value=!1,O.exposed.getInviteCode(),e&&(S("callback"),le())},le=()=>{K.value="",W.value=!1,E.value="",S("update:visible",!1)},re=/^[a-z0-9]{1,20}$/;return p((()=>G.value),(async()=>{var e,a,l,r,i;if((null==(e=G.value)?void 0:e.code)&&!(null==(a=G.value)?void 0:a.address)){const e=await Y(null==(l=G.value)?void 0:l.code);"0x0000000000000000000000000000000000000000"==e?(K.value="referral.noRegiste",E.value=null==(r=G.value)?void 0:r.code):(E.value=null==(i=G.value)?void 0:i.code,X.value=!0,Z(e))}}),{immediate:!0,deep:!0}),p((()=>E.value),(()=>{!re.test(E.value)&&E.value?(W.value=!0,K.value="referral.createTips1"):(W.value=!1,K.value="")})),(e,a)=>{var l;const r=b("a-input"),i=b("i18n-t"),s=b("icon-check-circle-fill"),t=b("a-button"),d=b("a-space");return g(),y("div",z,[k("div",$,[k("div",j,h(e.$t("referral.bindCodeTitle1",{a:X.value?((null==(l=Q.value)?void 0:l.trade)||5)+"%":"5% ~ 20%"})),1),k("div",T,[k("div",null,[C(d,{direction:"vertical",size:[0,20],fill:""},{default:x((()=>[X.value?(g(),y("div",q,[k("div",A,[C(s,{size:"24"}),k("span",F,h(E.value),1),k("span",{class:"edit",onClick:a[3]||(a[3]=e=>X.value=!1)},h(e.$t("public.edit")),1)])])):(g(),y("div",N,[C(r,{class:"kilo-input-order",modelValue:E.value,"onUpdate:modelValue":a[0]||(a[0]=e=>E.value=e),error:W.value,"max-length":20,placeholder:e.$t("referral.codePlaceholder"),size:"large",onBlur:a[1]||(a[1]=()=>{W.value=!1,K.value=""})},null,8,["modelValue","error","placeholder"]),K.value?(g(),y("div",R,h(e.$t(K.value,{a:E.value})),1)):w("",!0),k("div",B,[C(i,{keypath:"referral.bindCodeTips"},{a:x((()=>[k("span",{class:"params",onClick:a[2]||(a[2]=e=>ee("kiloex"))},h(e.$t("referral.bindCodeTipsA")),1)])),_:1})])])),X.value?(g(),I(d,{key:3,direction:"vertical",size:[0,20],fill:""},{default:x((()=>[C(t,{type:"primary",size:"large",long:"",href:"/#/trade",class:"to-trade-btn"},{default:x((()=>[_(h(e.$t("referral.toTrade")),1)])),_:1}),C(t,{type:"outline",size:"large",long:"",onClick:ae,loading:L.value,disabled:L.value,class:"to-trade-btn"},{default:x((()=>[_(h(e.$t("referral.bindNow")),1)])),_:1},8,["loading","disabled"])])),_:1})):(g(),I(t,{key:2,type:"primary",size:"large",long:"",onClick:a[4]||(a[4]=e=>ee()),loading:L.value,disabled:L.value},{default:x((()=>[_(h(e.$t("public.confirm")),1)])),_:1},8,["loading","disabled"]))])),_:1})])])])])}}},[["__scopeId","data-v-30b3413b"]]);export{S as default};
